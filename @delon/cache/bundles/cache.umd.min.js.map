{"version":3,"sources":["../../../../node_modules/tslib/tslib.es6.js","ng://@delon/cache/src/local-storage-cache.service.ts","ng://@delon/cache/src/cache.service.ts","ng://@delon/cache/src/cache.module.ts"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","DC_STORE_STORAGE_TOKEN","InjectionToken","providedIn","factory","DC_STORE_STORAGE_TOKEN_FACTORY","LocalStorageCacheService","get","key","JSON","parse","localStorage","getItem","set","value","setItem","stringify","remove","removeItem","CacheService","cogSrv","store","http","memory","Map","notifyBuffer","meta","Set","freqTick","cog","merge","mode","reName","prefix","meta_key","loadMeta","startExpireNotify","deepGet","obj","path","defaultValue","checkObj","reduce","o","k","pushMeta","has","add","saveMeta","removeMeta","delete","_this","ret","v","forEach","metaData","push","e","getMeta","data","options","_a","type","expire","addSeconds","Date","valueOf","Observable","pipe","tap","save","runNotify","isPromise","map","of","getNone","tryGet","_remove","needNotify","clear","_v","defineProperty","Math","max","abortExpireNotify","checkExpireNotify","runExpireNotify","freqTime","setTimeout","removed","clearTimeout","next","notify","change$","BehaviorSubject","asObservable","cancelNotify","unsubscribe","hasNotify","clearNotify","ngOnDestroy","Injectable","args","AlainConfigService","Inject","HttpClient","DelonCacheModule","NgModule"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { InjectionToken } from '@angular/core';\nimport { ICache, ICacheStore } from './interface';\n\nexport const DC_STORE_STORAGE_TOKEN = new InjectionToken<ICacheStore>('DC_STORE_STORAGE_TOKEN', {\n  providedIn: 'root',\n  factory: DC_STORE_STORAGE_TOKEN_FACTORY,\n});\n\nexport function DC_STORE_STORAGE_TOKEN_FACTORY() {\n  return new LocalStorageCacheService();\n}\n\nexport class LocalStorageCacheService implements ICacheStore {\n  get(key: string): ICache {\n    return JSON.parse(localStorage.getItem(key) || 'null') || null;\n  }\n\n  set(key: string, value: ICache): boolean {\n    localStorage.setItem(key, JSON.stringify(value));\n    return true;\n  }\n\n  remove(key: string) {\n    localStorage.removeItem(key);\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Inject, Injectable, OnDestroy } from '@angular/core';\nimport { AlainCacheConfig, AlainConfigService } from '@delon/util';\nimport addSeconds from 'date-fns/addSeconds';\nimport { NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { map, tap } from 'rxjs/operators';\nimport { CacheNotifyResult, CacheNotifyType, ICache, ICacheStore } from './interface';\nimport { DC_STORE_STORAGE_TOKEN } from './local-storage-cache.service';\n\n@Injectable({ providedIn: 'root' })\nexport class CacheService implements OnDestroy {\n  private readonly memory: Map<string, ICache> = new Map<string, ICache>();\n  private readonly notifyBuffer: Map<string, BehaviorSubject<CacheNotifyResult>> = new Map<string, BehaviorSubject<CacheNotifyResult>>();\n  private meta: Set<string> = new Set<string>();\n  private freqTick = 3000;\n  private freqTime: NzSafeAny;\n  private cog: AlainCacheConfig;\n\n  constructor(cogSrv: AlainConfigService, @Inject(DC_STORE_STORAGE_TOKEN) private store: ICacheStore, private http: HttpClient) {\n    this.cog = cogSrv.merge<AlainCacheConfig, 'cache'>('cache', {\n      mode: 'promise',\n      reName: '',\n      prefix: '',\n      meta_key: '__cache_meta',\n    });\n    this.loadMeta();\n    this.startExpireNotify();\n  }\n\n  private deepGet(obj: NzSafeAny, path: string[], defaultValue?: NzSafeAny) {\n    if (!obj) return defaultValue;\n    if (path.length <= 1) {\n      const checkObj = path.length ? obj[path[0]] : obj;\n      return typeof checkObj === 'undefined' ? defaultValue : checkObj;\n    }\n    return path.reduce((o, k) => o[k], obj) || defaultValue;\n  }\n\n  // #region meta\n\n  private pushMeta(key: string) {\n    if (this.meta.has(key)) return;\n    this.meta.add(key);\n    this.saveMeta();\n  }\n\n  private removeMeta(key: string) {\n    if (!this.meta.has(key)) return;\n    this.meta.delete(key);\n    this.saveMeta();\n  }\n\n  private loadMeta() {\n    const ret = this.store.get(this.cog.meta_key!);\n    if (ret && ret.v) {\n      (ret.v as string[]).forEach(key => this.meta.add(key));\n    }\n  }\n\n  private saveMeta() {\n    const metaData: string[] = [];\n    this.meta.forEach(key => metaData.push(key));\n    this.store.set(this.cog.meta_key!, { v: metaData, e: 0 });\n  }\n\n  getMeta() {\n    return this.meta;\n  }\n\n  // #endregion\n\n  // #region set\n\n  /**\n   * Persistent cached `Observable` object, for example:\n   * - `set('data/1', this.http.get('data/1')).subscribe()`\n   * - `set('data/1', this.http.get('data/1'), { expire: 10 }).subscribe()`\n   */\n  set<T>(key: string, data: Observable<T>, options?: { type?: 's'; expire?: number }): Observable<T>;\n  /**\n   * Persistent cached `Observable` object, for example:\n   * - `set('data/1', this.http.get('data/1')).subscribe()`\n   * - `set('data/1', this.http.get('data/1'), { expire: 10 }).subscribe()`\n   */\n  set(key: string, data: Observable<NzSafeAny>, options?: { type?: 's'; expire?: number }): Observable<NzSafeAny>;\n  /**\n   * Persistent cached simple object, for example:\n   * - `set('data/1', 1)`\n   * - `set('data/1', 1, { expire: 10 })`\n   */\n  set(key: string, data: {}, options?: { type?: 's'; expire?: number }): void;\n  /**\n   * Persistent cached simple object and specify storage type, for example caching in memory:\n   * - `set('data/1', 1, { type: 'm' })`\n   * - `set('data/1', 1, { type: 'm', expire: 10 })`\n   */\n  set(key: string, data: {}, options: { type: 'm' | 's'; expire?: number }): void;\n  /**\n   * 缓存对象\n   */\n  set(\n    key: string,\n    data: NzSafeAny | Observable<NzSafeAny>,\n    options: {\n      /** 存储类型，'m' 表示内存，'s' 表示持久 */\n      type?: 'm' | 's';\n      /**\n       * 过期时间，单位 `秒`\n       */\n      expire?: number;\n    } = {},\n  ): NzSafeAny {\n    let e = 0;\n    const { type, expire } = this.cog;\n    options = {\n      type,\n      expire,\n      ...options,\n    };\n    if (options.expire) {\n      e = addSeconds(new Date(), options.expire).valueOf();\n    }\n    if (!(data instanceof Observable)) {\n      this.save(options.type!, key, { v: data, e });\n      return;\n    }\n    return data.pipe(\n      tap((v: NzSafeAny) => {\n        this.save(options.type!, key, { v, e });\n      }),\n    );\n  }\n\n  private save(type: 'm' | 's', key: string, value: ICache) {\n    if (type === 'm') {\n      this.memory.set(key, value);\n    } else {\n      this.store.set(this.cog.prefix + key, value);\n      this.pushMeta(key);\n    }\n    this.runNotify(key, 'set');\n  }\n\n  // #endregion\n\n  // #region get\n\n  /** 获取缓存数据，若 `key` 不存在则 `key` 作为HTTP请求缓存后返回 */\n  get<T>(\n    key: string,\n    options?: {\n      mode: 'promise';\n      type?: 'm' | 's';\n      expire?: number;\n    },\n  ): Observable<T>;\n  /** 获取缓存数据，若 `key` 不存在则 `key` 作为HTTP请求缓存后返回 */\n  get(\n    key: string,\n    options?: {\n      mode: 'promise';\n      type?: 'm' | 's';\n      expire?: number;\n    },\n  ): Observable<NzSafeAny>;\n  /** 获取缓存数据，若 `key` 不存在或已过期则返回 null */\n  get(\n    key: string,\n    options: {\n      mode: 'none';\n      type?: 'm' | 's';\n      expire?: number;\n    },\n  ): NzSafeAny;\n  get(\n    key: string,\n    options: {\n      mode?: 'promise' | 'none';\n      type?: 'm' | 's';\n      expire?: number;\n    } = {},\n  ): Observable<NzSafeAny> | NzSafeAny {\n    const isPromise = options.mode !== 'none' && this.cog.mode === 'promise';\n    const value: ICache = this.memory.has(key) ? (this.memory.get(key) as ICache) : this.store.get(this.cog.prefix + key);\n    if (!value || (value.e && value.e > 0 && value.e < new Date().valueOf())) {\n      if (isPromise) {\n        return this.http.get(key).pipe(\n          map((ret: NzSafeAny) => this.deepGet(ret, this.cog.reName as string[], null)),\n          tap(v => this.set(key, v, { type: options.type as NzSafeAny, expire: options.expire })),\n        );\n      }\n      return null;\n    }\n\n    return isPromise ? of(value.v) : value.v;\n  }\n\n  /** 获取缓存数据，若 `key` 不存在或已过期则返回 null */\n  getNone<T>(key: string): T;\n  /** 获取缓存数据，若 `key` 不存在或已过期则返回 null */\n  getNone(key: string): NzSafeAny {\n    return this.get(key, { mode: 'none' });\n  }\n\n  /**\n   * 获取缓存，若不存在则设置持久化缓存 `Observable` 对象\n   */\n  tryGet<T>(key: string, data: Observable<T>, options?: { type?: 's'; expire?: number }): Observable<T>;\n  /**\n   * 获取缓存，若不存在则设置持久化缓存 `Observable` 对象\n   */\n  tryGet(key: string, data: Observable<NzSafeAny>, options?: { type?: 's'; expire?: number }): Observable<NzSafeAny>;\n  /**\n   * 获取缓存，若不存在则设置持久化缓存基础对象\n   */\n  tryGet(key: string, data: {}, options?: { type?: 's'; expire?: number }): NzSafeAny;\n  /**\n   * 获取缓存，若不存在则设置指定缓存类型进行缓存对象\n   */\n  tryGet(key: string, data: {}, options: { type: 'm' | 's'; expire?: number }): NzSafeAny;\n\n  /**\n   * 获取缓存，若不存在则设置缓存对象\n   */\n  tryGet(\n    key: string,\n    data: NzSafeAny | Observable<NzSafeAny>,\n    options: {\n      /** 存储类型，'m' 表示内存，'s' 表示持久 */\n      type?: 'm' | 's';\n      /**\n       * 过期时间，单位 `秒`\n       */\n      expire?: number;\n    } = {},\n  ): NzSafeAny {\n    const ret = this.getNone(key);\n    if (ret === null) {\n      if (!(data instanceof Observable)) {\n        this.set(key, data, options as NzSafeAny);\n        return data;\n      }\n\n      return this.set(key, data as Observable<NzSafeAny>, options as NzSafeAny);\n    }\n    return of(ret);\n  }\n\n  // #endregion\n\n  // #region has\n\n  /** 是否缓存 `key` */\n  has(key: string): boolean {\n    return this.memory.has(key) || this.meta.has(key);\n  }\n\n  // #endregion\n\n  // #region remove\n\n  private _remove(key: string, needNotify: boolean) {\n    if (needNotify) this.runNotify(key, 'remove');\n    if (this.memory.has(key)) {\n      this.memory.delete(key);\n      return;\n    }\n    this.store.remove(this.cog.prefix + key);\n    this.removeMeta(key);\n  }\n\n  /** 移除缓存 */\n  remove(key: string) {\n    this._remove(key, true);\n  }\n\n  /** 清空所有缓存 */\n  clear() {\n    this.notifyBuffer.forEach((_v, k) => this.runNotify(k, 'remove'));\n    this.memory.clear();\n    this.meta.forEach(key => this.store.remove(this.cog.prefix + key));\n  }\n\n  // #endregion\n\n  // #region notify\n\n  /**\n   * 设置监听频率，单位：毫秒且最低 `20ms`，默认：`3000ms`\n   */\n  set freq(value: number) {\n    this.freqTick = Math.max(20, value);\n    this.abortExpireNotify();\n    this.startExpireNotify();\n  }\n\n  private startExpireNotify() {\n    this.checkExpireNotify();\n    this.runExpireNotify();\n  }\n\n  private runExpireNotify() {\n    this.freqTime = setTimeout(() => {\n      this.checkExpireNotify();\n      this.runExpireNotify();\n    }, this.freqTick);\n  }\n\n  private checkExpireNotify() {\n    const removed: string[] = [];\n    this.notifyBuffer.forEach((_v, key) => {\n      if (this.has(key) && this.getNone(key) === null) removed.push(key);\n    });\n    removed.forEach(key => {\n      this.runNotify(key, 'expire');\n      this._remove(key, false);\n    });\n  }\n\n  private abortExpireNotify() {\n    clearTimeout(this.freqTime);\n  }\n\n  private runNotify(key: string, type: CacheNotifyType) {\n    if (!this.notifyBuffer.has(key)) return;\n    this.notifyBuffer.get(key)!.next({ type, value: this.getNone(key) });\n  }\n\n  /**\n   * `key` 监听，当 `key` 变更、过期、移除时通知，注意以下若干细节：\n   *\n   * - 调用后除再次调用 `cancelNotify` 否则永远不过期\n   * - 监听器每 `freq` (默认：3秒) 执行一次过期检查\n   */\n  notify(key: string): Observable<CacheNotifyResult> {\n    if (!this.notifyBuffer.has(key)) {\n      const change$ = new BehaviorSubject<CacheNotifyResult>(this.getNone(key));\n      this.notifyBuffer.set(key, change$);\n    }\n    return this.notifyBuffer.get(key)!.asObservable();\n  }\n\n  /**\n   * 取消 `key` 监听\n   */\n  cancelNotify(key: string): void {\n    if (!this.notifyBuffer.has(key)) return;\n    this.notifyBuffer.get(key)!.unsubscribe();\n    this.notifyBuffer.delete(key);\n  }\n\n  /** `key` 是否已经监听 */\n  hasNotify(key: string): boolean {\n    return this.notifyBuffer.has(key);\n  }\n\n  /** 清空所有 `key` 的监听 */\n  clearNotify(): void {\n    this.notifyBuffer.forEach(v => v.unsubscribe());\n    this.notifyBuffer.clear();\n  }\n\n  // #endregion\n\n  ngOnDestroy(): void {\n    this.memory.clear();\n    this.abortExpireNotify();\n    this.clearNotify();\n  }\n}\n","import { NgModule } from '@angular/core';\n\n@NgModule({})\nexport class DelonCacheModule {}\n"]}
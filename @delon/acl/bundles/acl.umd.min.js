/**
 * @license ng-alain(cipchk@qq.com) v7.2.0
 * (c) 2019 cipchk https://ng-alain.com/
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/router"),require("@angular/common")):"function"==typeof define&&define.amd?define("@delon/acl",["exports","@angular/core","rxjs","rxjs/operators","@angular/router","@angular/common"],t):t(((e=e||self).delon=e.delon||{},e.delon.acl={}),e.ng.core,e.rxjs,e.rxjs.operators,e.ng.router,e.ng.common)}(this,function(e,t,r,n,o,i){"use strict";var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function l(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function s(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(l){o={error:l}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return a}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}var u=function(){function e(){this.guard_url="/403"}return e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),p=function(){function e(e){this.options=e,this.roles=[],this.abilities=[],this.full=!1,this.aclChange=new r.BehaviorSubject(null)}return Object.defineProperty(e.prototype,"change",{get:function(){return this.aclChange.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return{full:this.full,roles:this.roles,abilities:this.abilities}},enumerable:!0,configurable:!0}),e.prototype.parseACLType=function(e){return"string"==typeof e||Array.isArray(e)?Array.isArray(e)?{role:e}:{role:[e]}:e},e.prototype.set=function(e){this.abilities=[],this.roles=[],this.add(e),this.aclChange.next(e)},e.prototype.setFull=function(e){this.full=e,this.aclChange.next(e)},e.prototype.setAbility=function(e){this.set({ability:e})},e.prototype.setRole=function(e){this.set({role:e})},e.prototype.add=function(e){var t,r;e.role&&e.role.length>0&&(t=this.roles).push.apply(t,c(e.role)),e.ability&&e.ability.length>0&&(r=this.abilities).push.apply(r,c(e.ability))},e.prototype.attachRole=function(e){var t,r;try{for(var n=l(e),o=n.next();!o.done;o=n.next()){var i=o.value;this.roles.includes(i)||this.roles.push(i)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}this.aclChange.next(this.data)},e.prototype.attachAbility=function(e){var t,r;try{for(var n=l(e),o=n.next();!o.done;o=n.next()){var i=o.value;this.abilities.includes(i)||this.abilities.push(i)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}this.aclChange.next(this.data)},e.prototype.removeRole=function(e){var t,r;try{for(var n=l(e),o=n.next();!o.done;o=n.next()){var i=o.value,a=this.roles.indexOf(i);-1!==a&&this.roles.splice(a,1)}}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}this.aclChange.next(this.data)},e.prototype.removeAbility=function(e){var t,r;try{for(var n=l(e),o=n.next();!o.done;o=n.next()){var i=o.value,a=this.abilities.indexOf(i);-1!==a&&this.abilities.splice(a,1)}}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}this.aclChange.next(this.data)},e.prototype.can=function(e){var t=this;if(!0===this.full||!e)return!0;var r=this.options.preCan;r&&(e=r(e));var n={};return(n="number"==typeof e?{ability:[e]}:Array.isArray(e)&&e.length>0&&"number"==typeof e[0]?{ability:e}:this.parseACLType(e)).role?"allOf"===n.mode?n.role.every(function(e){return t.roles.includes(e)}):n.role.some(function(e){return t.roles.includes(e)}):!!n.ability&&("allOf"===n.mode?n.ability.every(function(e){return t.abilities.includes(e)}):n.ability.some(function(e){return t.abilities.includes(e)}))},e.prototype.parseAbility=function(e){return("number"==typeof e||"string"==typeof e||Array.isArray(e))&&(e={ability:Array.isArray(e)?e:[e]}),delete e.role,e},e.prototype.canAbility=function(e){return this.can(this.parseAbility(e))},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:u}]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e(t.inject(u))},token:e,providedIn:"root"}),e}(),f=function(){function e(e,t,r){var o=this;this.el=e,this.renderer=t,this.srv=r,this.change$=this.srv.change.pipe(n.filter(function(e){return null!=e})).subscribe(function(){return o.set(o._value)})}return Object.defineProperty(e.prototype,"acl",{set:function(e){this.set(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ability",{set:function(e){this.set(this.srv.parseAbility(e))},enumerable:!0,configurable:!0}),e.prototype.set=function(e){this._value=e,this._updateView()},e.prototype._updateView=function(){var e=this.el.nativeElement;this.srv.can(this._value)?this.renderer.removeClass(e,"acl__hide"):this.renderer.addClass(e,"acl__hide")},e.prototype.ngOnDestroy=function(){this.change$.unsubscribe()},e.decorators=[{type:t.Directive,args:[{selector:"[acl]",exportAs:"acl"}]}],e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2},{type:p}]},e.propDecorators={acl:[{type:t.Input,args:["acl"]}],ability:[{type:t.Input,args:["acl-ability"]}]},e}(),y=function(e){function r(t,r,n,o,i){var a=e.call(this,n,o,i)||this;return a._viewContainer=t,a.templateRef=r,a}return function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(r,e),Object.defineProperty(r.prototype,"acl",{set:function(e){this.set(e)},enumerable:!0,configurable:!0}),r.prototype._updateView=function(){this._viewContainer.clear(),this.srv.can(this._value)&&this._viewContainer.createEmbeddedView(this.templateRef)},r.decorators=[{type:t.Directive,args:[{selector:"[aclIf]",exportAs:"aclIf"}]}],r.ctorParameters=function(){return[{type:t.ViewContainerRef},{type:t.TemplateRef},{type:t.ElementRef},{type:t.Renderer2},{type:p}]},r.propDecorators={acl:[{type:t.Input,args:["aclIf"]}]},r}(f),h=function(){function e(e,t,r){this.srv=e,this.router=t,this.options=r}return e.prototype.process=function(e){var t=this;return(e&&e instanceof r.Observable?e:r.of(null!=e?e:null)).pipe(n.map(function(e){return t.srv.can(e)}),n.tap(function(e){e||t.router.navigateByUrl(t.options.guard_url)}))},e.prototype.canLoad=function(e){return this.process(e.data&&e.data.guard||null)},e.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},e.prototype.canActivate=function(e,t){return this.process(e.data&&e.data.guard||null)},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:p},{type:o.Router},{type:u}]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e(t.inject(p),t.inject(o.Router),t.inject(u))},token:e,providedIn:"root"}),e}(),d=[f,y],b=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[i.CommonModule],declarations:c(d),exports:c(d)}]}],e}();e.ACLDirective=f,e.ACLGuard=h,e.ACLIfDirective=y,e.ACLService=p,e.DelonACLConfig=u,e.DelonACLModule=b,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=acl.umd.min.js.map
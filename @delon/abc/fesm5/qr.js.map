{"version":3,"file":"qr.js","sources":["ng://@delon/abc/qr/qr.config.ts","ng://@delon/abc/qr/qr.service.ts","ng://@delon/abc/qr/qr.component.ts","ng://@delon/abc/qr/qr.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { AlainQRConfig } from '@delon/theme';\nimport { deprecation10Cog } from '@delon/util';\n\nexport const DEFULAT_CONFIG: AlainQRConfig = {\n  background: 'white',\n  backgroundAlpha: 1,\n  foreground: 'black',\n  foregroundAlpha: 1,\n  level: 'L',\n  mime: 'image/png',\n  padding: 10,\n  size: 220,\n};\n\n/**\n * @deprecated `QRConfig` is going to be removed in 10.0.0. Please refer to https://ng-alain.com/docs/global-config\n */\n@Injectable({ providedIn: 'root' })\nexport class QRConfig {\n  constructor() {\n    deprecation10Cog(`QRConfig`);\n  }\n  /** 背景，默认：`white` */\n  background = 'white';\n  /** 背景透明级别，范围：`0-1` 之间，默认：`1.0` */\n  backgroundAlpha = 1;\n  /** 前景，默认：`black` */\n  foreground = 'black';\n  /** 前景透明级别，范围：`0-1` 之间，默认：`1.0` */\n  foregroundAlpha = 1;\n  /** 误差校正级别，默认：`L` */\n  level: 'L' | 'M' | 'Q' | 'H' = 'L';\n  /** 二维码输出图片MIME类型，默认：`image/png` */\n  mime = 'image/png';\n  /** 内边距（单位：px），默认：`10` */\n  padding = 10;\n  /** 大小（单位：px），默认：`220` */\n  size = 220;\n}\n","import { Injectable } from '@angular/core';\nimport { AlainConfigService, AlainQRConfig } from '@delon/theme';\nimport { DEFULAT_CONFIG } from './qr.config';\n\ndeclare var QRious: any;\n\n@Injectable({ providedIn: 'root' })\nexport class QRService {\n  /** 当前qr实例 */\n  readonly qr: any;\n  /** 背景 */\n  background: string;\n  /** 背景透明级别，范围：`0-1` 之间 */\n  backgroundAlpha = 1;\n  /** 前景 */\n  foreground: string;\n  /** 前景透明级别，范围：`0-1` 之间 */\n  foregroundAlpha: number;\n  /** 误差校正级别 */\n  level: string;\n  /** 二维码输出图片MIME类型 */\n  mime: string;\n  /** 内边距（单位：px） */\n  padding: number;\n  /** 大小（单位：px） */\n  size: number;\n  /** 值 */\n  value: string;\n\n  constructor(configSrv: AlainConfigService) {\n    configSrv.attach<AlainQRConfig, 'qr'>(this, 'qr', DEFULAT_CONFIG);\n    this.qr = new QRious();\n  }\n\n  /**\n   * 生成二维码，并返回Base64编码\n   *\n   * @param [value] 重新指定值\n   */\n  refresh(value?: string | {}): string {\n    const option: any =\n      typeof value === 'object'\n        ? value\n        : {\n            background: this.background,\n            backgroundAlpha: this.backgroundAlpha,\n            foreground: this.foreground,\n            foregroundAlpha: this.foregroundAlpha,\n            level: this.level,\n            padding: this.padding,\n            size: this.size,\n            value: value || this.value,\n          };\n    option.value = this.toUtf8ByteArray(option.value);\n    this.qr.set(option);\n    return this.dataURL;\n  }\n\n  private toUtf8ByteArray(str: string): string {\n    str = encodeURI(str);\n    const result: number[] = [];\n    for (let i = 0; i < str.length; i++) {\n      if (str.charAt(i) !== '%') {\n        result.push(str.charCodeAt(i));\n      } else {\n        result.push(parseInt(str.substr(i + 1, 2), 16));\n        i += 2;\n      }\n    }\n    return result.map(v => String.fromCharCode(v)).join('');\n  }\n\n  /**\n   * 返回当前二维码Base64编码\n   */\n  get dataURL(): string {\n    return this.qr.toDataURL();\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnChanges,\n  Output,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { AlainConfigService, AlainQRConfig } from '@delon/theme';\nimport { InputNumber } from '@delon/util';\nimport { DEFULAT_CONFIG } from './qr.config';\nimport { QRService } from './qr.service';\n\n@Component({\n  selector: 'qr',\n  exportAs: 'qr',\n  template: ` <img class=\"qr__img\" src=\"{{ dataURL }}\" /> `,\n  host: {\n    '[class.qr]': 'true',\n    '[style.height.px]': 'size',\n    '[style.width.px]': 'size',\n  },\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class QRComponent implements OnChanges {\n  dataURL: string;\n\n  // #region fields\n\n  @Input() background: string;\n  @Input() backgroundAlpha: number;\n  @Input() foreground: string;\n  @Input() foregroundAlpha: number;\n  @Input() level: string;\n  @Input() mime: string;\n  @Input() @InputNumber() padding: number;\n  @Input() @InputNumber() size: number;\n  @Input() value: string;\n  // tslint:disable-next-line:no-output-native\n  @Output() readonly change = new EventEmitter<string>();\n\n  // #endregion\n\n  constructor(private srv: QRService, private cdr: ChangeDetectorRef, configSrv: AlainConfigService) {\n    configSrv.attach<AlainQRConfig, 'qr'>(this, 'qr', DEFULAT_CONFIG);\n  }\n\n  ngOnChanges(): void {\n    this.dataURL = this.srv.refresh({\n      background: this.background,\n      backgroundAlpha: this.backgroundAlpha,\n      foreground: this.foreground,\n      foregroundAlpha: this.foregroundAlpha,\n      level: this.level,\n      mime: this.mime,\n      padding: this.padding,\n      size: this.size,\n      value: this.value,\n    });\n    this.cdr.detectChanges();\n    this.change.emit(this.dataURL);\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { DelonUtilModule } from '@delon/util';\nimport { QRComponent } from './qr.component';\n\nconst COMPONENTS = [QRComponent];\n\n@NgModule({\n  imports: [CommonModule, DelonUtilModule],\n  declarations: [...COMPONENTS],\n  exports: [...COMPONENTS],\n})\nexport class QRModule {}\n"],"names":[],"mappings":"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"}
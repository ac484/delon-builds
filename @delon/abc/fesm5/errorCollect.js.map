{"version":3,"file":"errorCollect.js.map","sources":["ng://@delon/abc/error-collect/error-collect.config.ts","ng://@delon/abc/error-collect/error-collect.component.ts","ng://@delon/abc/error-collect/error-collect.module.ts"],"sourcesContent":["export class ErrorCollectConfig {\r\n  /**\r\n   * çå¬é¢ç\r\n   */\r\n  freq?: number = 500;\r\n  /**\r\n   * é¡¶é¨åç§»å¼\r\n   */\r\n  offsetTop?: number = 65 + 64 + 8 * 2;\r\n}\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  HostBinding,\r\n  OnDestroy,\r\n  ElementRef,\r\n  HostListener,\r\n  Inject,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n} from '@angular/core';\r\nimport { DOCUMENT } from '@angular/common';\r\nimport { InputNumber } from '@delon/util';\r\n\r\nimport { ErrorCollectConfig } from './error-collect.config';\r\n\r\n/**\r\n * éè¯¯æ¶æ¯ééå¨\r\n * PSï¼è½ç¶æ­¤æ³å¹¶ä¸å¥½çï¼ä½å¯¹ååºå¼è¡¨å&æ¨¡æ¿è¡¨åæå¾å¥½çææã\r\n */\r\n@Component({\r\n  selector: 'error-collect, [error-collect]',\r\n  template: `\r\n  <i class=\"anticon anticon-exclamation-circle\"></i>\r\n  <span class=\"pl-sm\">{{count}}</span>`,\r\n  host: { '[class.error-collect]': 'true' },\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  preserveWhitespaces: false,\r\n})\r\nexport class ErrorCollectComponent implements OnInit, OnDestroy {\r\n  private $time = null;\r\n  private formEl: HTMLFormElement;\r\n\r\n  @Input()\r\n  @InputNumber()\r\n  freq: number;\r\n\r\n  @Input()\r\n  @InputNumber()\r\n  offsetTop: number;\r\n\r\n  @HostBinding('class.d-none')\r\n  _hiden = true;\r\n\r\n  count = 0;\r\n\r\n  constructor(\r\n    cog: ErrorCollectConfig,\r\n    private el: ElementRef,\r\n    private cd: ChangeDetectorRef,\r\n    @Inject(DOCUMENT) private doc: any,\r\n  ) {\r\n    Object.assign(this, cog);\r\n  }\r\n\r\n  private get errEls() {\r\n    return this.formEl.querySelectorAll('.has-error');\r\n  }\r\n\r\n  private update() {\r\n    const count = this.errEls.length;\r\n    if (count === this.count) return;\r\n    this.count = count;\r\n    this._hiden = count === 0;\r\n    this.cd.markForCheck();\r\n  }\r\n\r\n  @HostListener('click')\r\n  _click() {\r\n    if (this.count === 0) return false;\r\n    // nz-form-control\r\n    const els = this.errEls;\r\n    const formItemEl = this.findParent(els[0], '[nz-form-control]') || els[0];\r\n    formItemEl.scrollIntoView(true);\r\n    // fix header height\r\n    this.doc.documentElement.scrollTop -= this.offsetTop;\r\n  }\r\n\r\n  private install() {\r\n    this.uninstall();\r\n    this.$time = setInterval(() => this.update(), this.freq);\r\n    this.update();\r\n  }\r\n\r\n  private uninstall() {\r\n    clearInterval(this.$time);\r\n  }\r\n\r\n  private findParent(el: any, selector: string) {\r\n    let retEl = null;\r\n    while (el) {\r\n      if (el.querySelector(selector)) {\r\n        retEl = el;\r\n        break;\r\n      }\r\n      el = el.parentElement;\r\n    }\r\n    return retEl;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.formEl = this.findParent(this.el.nativeElement, 'form');\r\n    if (this.formEl === null) throw new Error('æªæ¾å°ææ form åç´ ');\r\n    this.install();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.uninstall();\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { DelonUtilModule } from '@delon/util';\r\n\r\nimport { ErrorCollectComponent } from './error-collect.component';\r\nimport { ErrorCollectConfig } from './error-collect.config';\r\n\r\nconst COMPONENTS = [ErrorCollectComponent];\r\n\r\n@NgModule({\r\n  imports: [CommonModule, DelonUtilModule],\r\n  declarations: [...COMPONENTS],\r\n  exports: [...COMPONENTS],\r\n})\r\nexport class ErrorCollectModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: ErrorCollectModule,\r\n      providers: [ErrorCollectConfig],\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}

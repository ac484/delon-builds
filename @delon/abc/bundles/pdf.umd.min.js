/**
 * @license ng-alain(cipchk@qq.com) v11.3.1
 * (c) 2020 cipchk https://ng-alain.com/
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("@delon/util"),require("rxjs"),require("rxjs/operators"),require("@angular/cdk/platform"),require("ng-zorro-antd/skeleton")):"function"==typeof define&&define.amd?define("@delon/abc/pdf",["exports","@angular/common","@angular/core","@delon/util","rxjs","rxjs/operators","@angular/cdk/platform","ng-zorro-antd/skeleton"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).delon=e.delon||{},e.delon.abc=e.delon.abc||{},e.delon.abc.pdf={}),e.ng.common,e.ng.core,e.delon.util,e.rxjs,e.rxjs.operators,e.ng.cdk.platform,e["ng-zorro-antd/skeleton"])}(this,(function(e,t,n,i,o,r,s,a){"use strict";function l(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var u=l(n);
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function p(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}Object.create;function d(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}Object.create;var g,h,y={lib:"https://cdn.jsdelivr.net/npm/pdfjs-dist@2.5.207/",showAll:!0,renderText:!0,showBorders:!1,originalSize:!0,fitToPage:!1,autoReSize:!0};(g=e.PdfTextLayerMode||(e.PdfTextLayerMode={}))[g.DISABLE=0]="DISABLE",g[g.ENABLE=1]="ENABLE",g[g.ENABLE_ENHANCE=2]="ENABLE_ENHANCE",(h=e.PdfExternalLinkTarget||(e.PdfExternalLinkTarget={}))[h.NONE=0]="NONE",h[h.SELF=1]="SELF",h[h.BLANK=2]="BLANK",h[h.PARENT=3]="PARENT",h[h.TOP=4]="TOP";var m=96/72,b=function(){function t(t,i,r,s,a,l){this.ngZone=t,this.lazySrv=r,this.platform=s,this.el=a,this.doc=l,this.inited=!1,this.unsubscribe$=new o.Subject,this.lib="",this._pi=1,this._total=0,this._showAll=!0,this._rotation=0,this._zoom=1,this._renderText=!0,this.textLayerMode=e.PdfTextLayerMode.ENABLE,this.showBorders=!1,this.stickToPage=!1,this.originalSize=!0,this.fitToPage=!1,this.zoomScale="page-width",this.autoReSize=!0,this.externalLinkTarget=e.PdfExternalLinkTarget.BLANK,this.change=new n.EventEmitter;var u=i.merge("pdf",y);Object.assign(this,u);var p=u.lib;this.lib=p.endsWith("/")?p:p+"/"}return Object.defineProperty(t.prototype,"src",{set:function(e){this._src=e,this.load()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pi",{set:function(e){this._pi=this.getValidPi(e),this._pdf&&this.pageViewer.scrollPageIntoView({pageNumber:this._pi})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showAll",{set:function(e){this._showAll=e,this.resetDoc()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderText",{set:function(e){this._renderText=e,this._pdf&&(this.pageViewer.textLayerMode=this._textLayerMode,this.resetDoc())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zoom",{set:function(e){e<=0||(this._zoom=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{set:function(e){e%90==0?this._rotation=e:console.warn("Invalid rotation angle, shoule be divisible by 90.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pdf",{get:function(){return this._pdf},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"findController",{get:function(){return this._showAll?this.multiPageFindController:this.singlePageFindController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageViewer",{get:function(){return this._showAll?this.multiPageViewer:this.singlePageViewer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linkService",{get:function(){return this._showAll?this.multiPageLinkService:this.singlePageLinkService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_textLayerMode",{get:function(){return this._renderText?this.textLayerMode:e.PdfTextLayerMode.DISABLE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"win",{get:function(){return this.doc.defaultView||window},enumerable:!1,configurable:!0}),t.prototype.getValidPi=function(e){if(e<1)return 1;var t=this._pdf;return t&&e>t.numPages?t.numPages:e},t.prototype.emit=function(e,t){var n=this;this.ngZone.run((function(){return n.change.emit(Object.assign({type:e,pdf:n._pdf,pi:n._pi,total:n._total},t))}))},t.prototype.initDelay=function(){var e=this;this.inited=!0,this.win.pdfjsLib.GlobalWorkerOptions.workerSrc=this.lib+"build/pdf.worker.min.js",setTimeout((function(){return e.load()}),this.delay)},t.prototype.load=function(){var e=this,t=this._src;this.inited&&t&&(this.lastSrc!==t?this.ngZone.runOutsideAngular((function(){e.destroy();var n=e.loadingTask=e.win.pdfjsLib.getDocument(t);n.onProgress=function(t){return e.emit("load-progress",{progress:t})},n.promise.then((function(n){e._pdf=n,e.lastSrc=t,e._total=n.numPages,e.emit("loaded"),e.pageViewer||e.setupPageViewer(),e.resetDoc(),e.render()}),(function(t){return e.emit("error",{error:t})}))})):this.render())},t.prototype.resetDoc=function(){var e=this,t=this._pdf;t&&this.ngZone.runOutsideAngular((function(){e.cleanDoc(),e.findController.setDocument(t),e.pageViewer.setDocument(t),e.linkService.setDocument(t,null)}))},t.prototype.cleanDoc=function(){this.multiPageViewer.setDocument(null),this.singlePageViewer.setDocument(null),this.multiPageLinkService.setDocument(null,null),this.singlePageLinkService.setDocument(null,null),this.multiPageFindController.setDocument(null),this.singlePageFindController.setDocument(null)},t.prototype.render=function(){var e=this,t=this.pageViewer;t&&(0===this._rotation&&t.pagesRotation===this._rotation||setTimeout((function(){t.pagesRotation=e._rotation})),this.stickToPage&&setTimeout((function(){t.currentPageNumber=e._pi})),this.updateSize())},t.prototype.updateSize=function(){var e=this;this.ngZone.runOutsideAngular((function(){var t=e.pageViewer;e._pdf.getPage(t.currentPageNumber).then((function(n){var i=e,o=i._rotation,r=i._zoom,s=o||n.rotate,a=n.getViewport({scale:r,rotation:s}).width*m,l=r,u=!0;if(!e.originalSize||e.fitToPage&&a>e.el.nativeElement.clientWidth){var p=n.getViewport({scale:1,rotation:s});l=e.getScale(p.width,p.height),u=!e.stickToPage}t._setScale(l,u)}))}))},t.prototype.getScale=function(e,t){var n=this.showBorders?18:0,i=this.el.nativeElement,o=i.clientWidth-n,r=i.clientHeight-n;if(0===r||0===t||0===o||0===e)return 1;var s=1;switch(this.zoomScale){case"page-fit":s=Math.min(r/t,o/e);break;case"page-height":s=r/t;break;case"page-width":default:s=o/e}return this._zoom*s/m},t.prototype.destroy=function(){var e=this;this.ngZone.runOutsideAngular((function(){var t=e.loadingTask;t&&!t.destroyed&&t.destroy(),e._pdf&&(e._pdf.destroy(),e._pdf=null,e.cleanDoc())}))},t.prototype.setupPageViewer=function(){this.win.pdfjsLib.disableTextLayer=!this._renderText,this.win.pdfjsLib.externalLinkTarget=this.externalLinkTarget,this.setupMultiPageViewer(),this.setupSinglePageViewer()},t.prototype.createEventBus=function(){var e=this,t=new this.win.pdfjsViewer.EventBus;return t.on("pagesinit",(function(t){e.emit("pages-init",{ev:t})})),t.on("pagerendered",(function(t){e.emit("page-rendered",{ev:t})})),t.on("pagechanging",(function(t){var n=t.pageNumber;n!==e._pi&&(e._pi=n,e.emit("pi",{ev:t}))})),t.on("textlayerrendered",(function(t){e.emit("text-layer-rendered",{ev:t})})),t},t.prototype.setupMultiPageViewer=function(){var e=this.win.pdfjsViewer,t=this.createEventBus(),n=this.multiPageLinkService=new e.PDFLinkService({eventBus:t}),i=this.multiPageFindController=new e.PDFFindController({eventBus:t,linkService:n}),o=this.multiPageViewer=new e.PDFViewer({eventBus:t,container:this.el.nativeElement,removePageBorders:!this.showBorders,textLayerMode:this._textLayerMode,linkService:n,findController:i});n.setViewer(o)},t.prototype.setupSinglePageViewer=function(){var e=this.win.pdfjsViewer,t=this.createEventBus(),n=this.singlePageLinkService=new e.PDFLinkService({eventBus:t}),i=this.singlePageFindController=new e.PDFFindController({eventBus:t,linkService:n}),o=this.singlePageViewer=new e.PDFSinglePageViewer({eventBus:t,container:this.el.nativeElement,removePageBorders:!this.showBorders,textLayerMode:this._textLayerMode,linkService:n,findController:i});n.setViewer(o),o._currentPageNumber=this._pi},t.prototype.ngAfterViewInit=function(){var e=this;if(this.platform.isBrowser)if(this.win.pdfjsLib)this.initDelay();else{var t=this.lib;this.lazySrv.load(t+"build/pdf.min.js").then((function(){return e.lazySrv.load([t+"web/pdf_viewer.js",t+"web/pdf_viewer.css"])})).then((function(){return e.initDelay()})),this.ngZone.runOutsideAngular((function(){return e.initResize()}))}},t.prototype.initResize=function(){var e=this;o.fromEvent(this.win,"resize").pipe(r.debounceTime(100),r.filter((function(){return e.autoReSize&&e._pdf})),r.takeUntil(this.unsubscribe$)).subscribe((function(){return e.updateSize()}))},t.prototype.ngOnChanges=function(e){this.inited&&!e.src&&this.render()},t.prototype.ngOnDestroy=function(){var e=this.unsubscribe$;e.next(),e.complete(),this.destroy()},t}();b.ɵfac=function(e){return new(e||b)(n.ɵɵdirectiveInject(n.NgZone),n.ɵɵdirectiveInject(i.AlainConfigService),n.ɵɵdirectiveInject(i.LazyService),n.ɵɵdirectiveInject(s.Platform),n.ɵɵdirectiveInject(n.ElementRef),n.ɵɵdirectiveInject(t.DOCUMENT,8))},b.ɵcmp=n.ɵɵngDeclareComponent({version:"11.1.1",type:b,selector:"pdf",inputs:{src:"src",pi:"pi",showAll:"showAll",renderText:"renderText",textLayerMode:"textLayerMode",showBorders:"showBorders",stickToPage:"stickToPage",originalSize:"originalSize",fitToPage:"fitToPage",zoom:"zoom",zoomScale:"zoomScale",rotation:"rotation",autoReSize:"autoReSize",externalLinkTarget:"externalLinkTarget",delay:"delay"},outputs:{change:"change"},host:{properties:{"class.pdf-container":"true"}},exportAs:["pdf"],usesOnChanges:!0,ngImport:u,template:'\n    <nz-skeleton *ngIf="!inited"></nz-skeleton>\n    <div class="pdfViewer"></div>\n  ',isInline:!0,directives:[{type:t.NgIf,selector:"[ngIf]",inputs:["ngIf","ngIfThen","ngIfElse"]},{type:a.NzSkeletonComponent,selector:"nz-skeleton",inputs:["nzActive","nzLoading","nzRound","nzTitle","nzAvatar","nzParagraph"],exportAs:["nzSkeleton"]}],changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}),p([i.InputNumber(),c("design:type",Number),c("design:paramtypes",[Number])],b.prototype,"pi",null),p([i.InputBoolean(),c("design:type",Boolean),c("design:paramtypes",[Boolean])],b.prototype,"showAll",null),p([i.InputBoolean(),c("design:type",Boolean),c("design:paramtypes",[Boolean])],b.prototype,"renderText",null),p([i.InputBoolean(),c("design:type",Object)],b.prototype,"showBorders",void 0),p([i.InputBoolean(),c("design:type",Object)],b.prototype,"stickToPage",void 0),p([i.InputBoolean(),c("design:type",Object)],b.prototype,"originalSize",void 0),p([i.InputBoolean(),c("design:type",Object)],b.prototype,"fitToPage",void 0),p([i.InputNumber(),c("design:type",Number),c("design:paramtypes",[Number])],b.prototype,"zoom",null),p([i.InputNumber(),c("design:type",Number),c("design:paramtypes",[Number])],b.prototype,"rotation",null),p([i.InputBoolean(),c("design:type",Object)],b.prototype,"autoReSize",void 0),p([i.InputNumber(),c("design:type",Number)],b.prototype,"delay",void 0),("undefined"==typeof ngDevMode||ngDevMode)&&n.ɵsetClassMetadata(b,[{type:n.Component,args:[{selector:"pdf",exportAs:"pdf",template:'\n    <nz-skeleton *ngIf="!inited"></nz-skeleton>\n    <div class="pdfViewer"></div>\n  ',host:{"[class.pdf-container]":"true"},preserveWhitespaces:!1,changeDetection:n.ChangeDetectionStrategy.OnPush,encapsulation:n.ViewEncapsulation.None}]}],(function(){return[{type:n.NgZone},{type:i.AlainConfigService},{type:i.LazyService},{type:s.Platform},{type:n.ElementRef},{type:Document,decorators:[{type:n.Optional},{type:n.Inject,args:[t.DOCUMENT]}]}]}),{src:[{type:n.Input}],pi:[{type:n.Input}],showAll:[{type:n.Input}],renderText:[{type:n.Input}],textLayerMode:[{type:n.Input}],showBorders:[{type:n.Input}],stickToPage:[{type:n.Input}],originalSize:[{type:n.Input}],fitToPage:[{type:n.Input}],zoom:[{type:n.Input}],zoomScale:[{type:n.Input}],rotation:[{type:n.Input}],autoReSize:[{type:n.Input}],externalLinkTarget:[{type:n.Input}],delay:[{type:n.Input}],change:[{type:n.Output}]});var v=[b],w=function(){};w.ɵmod=n.ɵɵdefineNgModule({type:w}),w.ɵinj=n.ɵɵdefineInjector({factory:function(e){return new(e||w)},imports:[[t.CommonModule,i.DelonUtilModule,a.NzSkeletonModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&n.ɵɵsetNgModuleScope(w,{declarations:[b],imports:[t.CommonModule,i.DelonUtilModule,a.NzSkeletonModule],exports:[b]}),("undefined"==typeof ngDevMode||ngDevMode)&&n.ɵsetClassMetadata(w,[{type:n.NgModule,args:[{imports:[t.CommonModule,i.DelonUtilModule,a.NzSkeletonModule],declarations:f(v),exports:f(v)}]}],null,null),e.PDF_DEFULAT_CONFIG=y,e.PdfComponent=b,e.PdfModule=w,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pdf.umd.min.js.map
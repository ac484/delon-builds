/**
 * @license ng-alain(cipchk@qq.com) v10.1.2
 * (c) 2020 cipchk https://ng-alain.com/
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/cdk/platform"),require("@angular/core"),require("@delon/util"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("@delon/abc/pdf",["exports","@angular/cdk/platform","@angular/core","@delon/util","rxjs","rxjs/operators","@angular/common"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).delon=e.delon||{},e.delon.abc=e.delon.abc||{},e.delon.abc.pdf={}),e.ng.cdk.platform,e.ng.core,e.delon.util,e.rxjs,e.rxjs.operators,e.ng.common)}(this,(function(e,t,i,n,r,o,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function a(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}Object.create;function p(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,o=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}Object.create;var c={lib:"https://cdn.jsdelivr.net/npm/pdfjs-dist@2.5.207/"};var d={DISABLE:0,ENABLE:1,ENABLE_ENHANCE:2};d[d.DISABLE]="DISABLE",d[d.ENABLE]="ENABLE",d[d.ENABLE_ENHANCE]="ENABLE_ENHANCE";var g={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4};g[g.NONE]="NONE",g[g.SELF]="SELF",g[g.BLANK]="BLANK",g[g.PARENT]="PARENT",g[g.TOP]="TOP";var f=window,h=96/72,y=function(){function e(e,t,n,o,s){this.ngZone=e,this.lazySrv=n,this.platform=o,this.el=s,this.unsubscribe$=new r.Subject,this.lib="",this.inited=!1,this._pi=1,this._total=0,this._showAllPages=!0,this._rotation=0,this._zoom=1,this._disableTextLayer=!1,this.removePageBorders=!0,this.stickToPage=!1,this.originalSize=!0,this.zoomScale="page-width",this.fitToPage=!1,this.textLayerMode=d.ENABLE,this.externalLinkTarget=g.BLANK,this.autoresize=!0,this.change=new i.EventEmitter,this.cog=t.merge("pdf",c),Object.assign(this,this.cog);var a=this.cog.lib;this.lib=a.endsWith("/")?a:a+"/"}return Object.defineProperty(e.prototype,"src",{set:function(e){this._src=e,this.load()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pi",{set:function(e){this._pi=this.getValidPi(e),this._pdf&&this.pageViewer.scrollPageIntoView({pageNumber:this._pi})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showAllPages",{set:function(e){this._showAllPages=e,this.resetDoc()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disableTextLayer",{set:function(e){this._disableTextLayer=e,this._pdf&&(this.pageViewer.textLayerMode=this._textLayerMode,this.resetDoc())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{set:function(e){e<=0||(this._zoom=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{set:function(e){e%90==0?this._rotation=e:console.warn("Invalid rotation angle, shoule be divisible by 90.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pdf",{get:function(){return this._pdf},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"findController",{get:function(){return this._showAllPages?this.multiPageFindController:this.singlePageFindController},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageViewer",{get:function(){return this._showAllPages?this.multiPageViewer:this.singlePageViewer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkService",{get:function(){return this._showAllPages?this.multiPageLinkService:this.singlePageLinkService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_textLayerMode",{get:function(){return this._disableTextLayer?d.DISABLE:this.textLayerMode},enumerable:!1,configurable:!0}),e.prototype.getValidPi=function(e){if(e<1)return 1;var t=this._pdf;return t&&e>t.numPages?t.numPages:e},e.prototype.emit=function(e,t){var i=this;this.ngZone.run((function(){return i.change.emit(Object.assign({type:e,pdf:i._pdf,pi:i._pi,total:i._total},t))}))},e.prototype.initDelay=function(){var e=this;this.inited=!0,f.pdfjsLib.GlobalWorkerOptions.workerSrc=this.lib+"build/pdf.worker.min.js",setTimeout((function(){return e.load()}),this.delay)},e.prototype.load=function(){var e=this,t=this._src;this.inited&&t&&(this.lastSrc!==t?this.ngZone.runOutsideAngular((function(){e.destroy();var i=e.loadingTask=f.pdfjsLib.getDocument(t);i.onProgress=function(t){return e.emit("load-progress",{progress:t})},i.promise.then((function(i){e._pdf=i,e.lastSrc=t,e._total=i.numPages,e.emit("loaded"),e.pageViewer||e.setupPageViewer(),e.resetDoc(),e.render()}),(function(t){return e.emit("error",{error:t})}))})):this.render())},e.prototype.resetDoc=function(){var e=this,t=this._pdf;t&&this.ngZone.runOutsideAngular((function(){e.cleanDoc(),e.findController.setDocument(t),e.pageViewer.setDocument(t),e.linkService.setDocument(t,null)}))},e.prototype.cleanDoc=function(){this.multiPageViewer.setDocument(null),this.singlePageViewer.setDocument(null),this.multiPageLinkService.setDocument(null,null),this.singlePageLinkService.setDocument(null,null),this.multiPageFindController.setDocument(null),this.singlePageFindController.setDocument(null)},e.prototype.render=function(){var e=this,t=this.pageViewer;t&&(0===this._rotation&&t.pagesRotation===this._rotation||setTimeout((function(){t.pagesRotation=e._rotation})),this.stickToPage&&setTimeout((function(){t.currentPageNumber=e._pi})),this.updateSize())},e.prototype.updateSize=function(){var e=this,t=this.pageViewer;this._pdf.getPage(t.currentPageNumber).then((function(i){var n=e,r=n._rotation,o=n._zoom,s=r||i.rotate,a=i.getViewport({scale:o,rotation:s}).width*h,l=o,p=!0;if(!e.originalSize||e.fitToPage&&a>e.el.nativeElement.clientWidth){var u=i.getViewport({scale:1,rotation:s});l=e.getScale(u.width,u.height),p=!e.stickToPage}t._setScale(l,p)}))},e.prototype.getScale=function(e,t){var i=this.removePageBorders?0:18,n=this.el.nativeElement,r=n.clientWidth-i,o=n.clientHeight-i;if(0===o||0===t||0===r||0===e)return 1;var s=1;switch(this.zoomScale){case"page-fit":s=Math.min(o/t,r/e);break;case"page-height":s=o/t;break;case"page-width":default:s=r/e}return this._zoom*s/h},e.prototype.destroy=function(){var e=this;this.ngZone.runOutsideAngular((function(){var t=e.loadingTask;t&&!t.destroyed&&t.destroy(),e._pdf&&(e._pdf.destroy(),e._pdf=null,e.cleanDoc())}))},e.prototype.setupPageViewer=function(){f.pdfjsLib.disableTextLayer=this._disableTextLayer,f.pdfjsLib.externalLinkTarget=this.externalLinkTarget,this.setupMultiPageViewer(),this.setupSinglePageViewer()},e.prototype.createEventBus=function(){var e=this,t=new f.pdfjsViewer.EventBus;return t.on("pagesinit",(function(t){e.emit("pages-init",{ev:t})})),t.on("pagerendered",(function(t){e.emit("page-rendered",{ev:t})})),t.on("pagechanging",(function(t){var i=t.pageNumber;i!==e._pi&&(e._pi=i,e.emit("pi",{ev:t}))})),t.on("textlayerrendered",(function(t){e.emit("text-layer-rendered",{ev:t})})),t},e.prototype.setupMultiPageViewer=function(){var e=f.pdfjsViewer,t=this.createEventBus(),i=this.multiPageLinkService=new e.PDFLinkService({eventBus:t}),n=this.multiPageFindController=new e.PDFFindController({eventBus:t,linkService:i}),r=this.multiPageViewer=new e.PDFViewer({eventBus:t,container:this.el.nativeElement,removePageBorders:this.removePageBorders,textLayerMode:this._textLayerMode,linkService:i,findController:n});i.setViewer(r)},e.prototype.setupSinglePageViewer=function(){var e=f.pdfjsViewer,t=this.createEventBus(),i=this.singlePageLinkService=new e.PDFLinkService({eventBus:t}),n=this.singlePageFindController=new e.PDFFindController({eventBus:t,linkService:i}),r=this.singlePageViewer=new e.PDFSinglePageViewer({eventBus:t,container:this.el.nativeElement,removePageBorders:this.removePageBorders,textLayerMode:this._textLayerMode,linkService:i,findController:n});i.setViewer(r),r._currentPageNumber=this._pi},e.prototype.ngAfterViewInit=function(){var e=this;if(this.platform.isBrowser)if(f.pdfjsLib)this.initDelay();else{var t=this.lib;this.lazySrv.load(t+"build/pdf.min.js").then((function(){return e.lazySrv.load([t+"web/pdf_viewer.js",t+"web/pdf_viewer.css"])})).then((function(){return e.initDelay()})),this.ngZone.runOutsideAngular((function(){return e.initResize()}))}},e.prototype.initResize=function(){var e=this;r.fromEvent(f,"resize").pipe(o.debounceTime(100),o.filter((function(){return e.autoresize})),o.takeUntil(this.unsubscribe$)).subscribe((function(){return e.updateSize()}))},e.prototype.ngOnChanges=function(e){this.inited&&!e.src&&this.render()},e.prototype.ngOnDestroy=function(){var e=this.unsubscribe$;e.next(),e.complete(),this.destroy()},e}();y.decorators=[{type:i.Component,args:[{selector:"pdf",exportAs:"pdf",template:'<div class="pdfViewer"></div>',host:{"[class.pdf-container]":"true"},preserveWhitespaces:!1,changeDetection:i.ChangeDetectionStrategy.OnPush,encapsulation:i.ViewEncapsulation.None}]}],y.ctorParameters=function(){return[{type:i.NgZone},{type:n.AlainConfigService},{type:n.LazyService},{type:t.Platform},{type:i.ElementRef}]},y.propDecorators={src:[{type:i.Input}],pi:[{type:i.Input}],showAllPages:[{type:i.Input}],disableTextLayer:[{type:i.Input}],removePageBorders:[{type:i.Input}],stickToPage:[{type:i.Input}],originalSize:[{type:i.Input}],zoom:[{type:i.Input}],zoomScale:[{type:i.Input}],fitToPage:[{type:i.Input}],textLayerMode:[{type:i.Input}],externalLinkTarget:[{type:i.Input}],rotation:[{type:i.Input}],autoresize:[{type:i.Input}],delay:[{type:i.Input}],change:[{type:i.Output}]},a([n.InputNumber(),l("design:type",Number),l("design:paramtypes",[Number])],y.prototype,"pi",null),a([n.InputBoolean(),l("design:type",Boolean),l("design:paramtypes",[Boolean])],y.prototype,"showAllPages",null),a([n.InputBoolean(),l("design:type",Boolean),l("design:paramtypes",[Boolean])],y.prototype,"disableTextLayer",null),a([n.InputBoolean(),l("design:type",Object)],y.prototype,"removePageBorders",void 0),a([n.InputBoolean(),l("design:type",Object)],y.prototype,"stickToPage",void 0),a([n.InputBoolean(),l("design:type",Object)],y.prototype,"originalSize",void 0),a([n.InputNumber(),l("design:type",Number),l("design:paramtypes",[Number])],y.prototype,"zoom",null),a([n.InputBoolean(),l("design:type",Object)],y.prototype,"fitToPage",void 0),a([n.InputNumber(),l("design:type",Number),l("design:paramtypes",[Number])],y.prototype,"rotation",null),a([n.InputBoolean(),l("design:type",Object)],y.prototype,"autoresize",void 0),a([n.InputNumber(),l("design:type",Number)],y.prototype,"delay",void 0);var m=[y],b=function(){};b.decorators=[{type:i.NgModule,args:[{imports:[s.CommonModule,n.DelonUtilModule],declarations:u(m),exports:u(m)}]}],e.PDF_DEFULAT_CONFIG=c,e.PdfComponent=y,e.PdfExternalLinkTarget=g,e.PdfModule=b,e.PdfTextLayerMode=d,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pdf.umd.min.js.map
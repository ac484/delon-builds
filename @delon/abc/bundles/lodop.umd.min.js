/**
 * @license ng-alain(cipchk@qq.com) v2.0.1
 * (c) 2018 Cipchk https://ng-alain.com/
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("@angular/core"),require("@delon/util")):"function"==typeof define&&define.amd?define("@delon/abc/lodop",["exports","rxjs","@angular/core","@delon/util"],e):e((t.delon=t.delon||{},t.delon.abc=t.delon.abc||{},t.delon.abc.lodop={}),t.rxjs,t.ng.core,t.delon.util)}(this,function(t,o,e,n){"use strict";var i=function(){return(i=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function c(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),c=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)c.push(n.value)}catch(u){r={error:u}}finally{try{n&&!n.done&&(o=i["return"])&&o.call(i)}finally{if(r)throw r.error}}return c}var r=function p(){},u=function(){function t(t,e){this.defCog=t,this.scriptSrv=e,this.pending=!1,this._lodop=null,this._init=new o.Subject,this._events=new o.Subject,this.printBuffer=[],this.cog=t}return Object.defineProperty(t.prototype,"cog",{get:function(){return this._cog},set:function(t){this._cog=i({url:"https://localhost:8443/CLodopfuncs.js",name:"CLODOP",companyName:"",checkMaxCount:100},this.defCog,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){return this._events.asObservable()},enumerable:!0,configurable:!0}),t.prototype.check=function(){if(!this._lodop)throw new Error("请务必先调用 lodop 获取对象")},t.prototype.request=function(){var o=this;this.pending=!0;var t=this.cog.url+"?name="+this.cog.name,e=this.cog.checkMaxCount,n=function(t,e){o._init.next({ok:"ok"===t,status:t,error:e,lodop:o._lodop})},r=function(){if(--e,o._lodop.webskt&&1===o._lodop.webskt.readyState)n("ok");else{if(e<0)return void n("check-limit");setTimeout(function(){return r()},100)}};this.scriptSrv.loadScript(t).then(function(t){if("ok"!==t.status)return o.pending=!1,void n("script-load-error",t[0]);o._lodop=window.hasOwnProperty(o.cog.name)&&window[o.cog.name],null!==o._lodop?(o._lodop.SET_LICENSES(o.cog.companyName,o.cog.license,o.cog.licenseA,o.cog.licenseB),r()):n("load-variable-name-error",{name:o.cog.name})})},t.prototype.reset=function(){this._lodop=null,this.pending=!1,this.request()},Object.defineProperty(t.prototype,"lodop",{get:function(){return this._lodop?o.of({ok:!0,lodop:this._lodop}):(this.pending||this.request(),this._init.asObservable())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"printer",{get:function(){this.check();for(var t=[],e=this._lodop.GET_PRINTER_COUNT(),o=0;o<e;o++)t.push(this._lodop.GET_PRINTER_NAME(o));return t},enumerable:!0,configurable:!0}),t.prototype.attachCode=function(t,c,u){var s=this;this.check(),u||(u=/LODOP\.([^(]+)\(([^\n]+)\);/i),t.split("\n").forEach(function(t){var e=u.exec(t.trim());if(e){var o=s._lodop[e[1]];if(o){var n=void 0;try{n=new Function("return ["+e[2]+"]")()}catch(i){}if(Array.isArray(n)&&c)for(var r=0;r<n.length;r++)"string"==typeof n[r]&&(n[r]=n[r].replace(/{{(.*?)}}/g,function(t,e){return c[e.trim()]||""}));o.apply(s._lodop,n)}}})},t.prototype.design=function(){var n=this;this.check();var r=this._lodop.PRINT_DESIGN();return new Promise(function(o){n._lodop.On_Return=function(t,e){r===t&&(n._lodop.On_Return=null,o(""+e))}})},t.prototype.printDo=function(){var o=this,n=this.printBuffer.shift();if(n){this.attachCode(n.code,n.item,n.parser);var r=this._lodop.PRINT();this._lodop.On_Return=function(t,e){r===t&&(o._lodop.On_Return=null,o._events.next(i({ok:!0===e,error:!0===e?null:e},n)),o.printDo())}}},t.prototype.print=function(e,t,o){var n;this.check(),t&&(n=this.printBuffer).push.apply(n,function r(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}((Array.isArray(t)?t:[t]).map(function(t){return{code:e,parser:o,item:t}}))),this.printDo()},t.prototype.ngOnDestroy=function(){this._init.unsubscribe(),this._events.unsubscribe()},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:r},{type:n.LazyService}]},t}(),s=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[u,r]}},t.decorators=[{type:e.NgModule,args:[{imports:[n.DelonUtilModule]}]}],t}();t.LodopService=u,t.LodopConfig=r,t.LodopModule=s,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=lodop.umd.min.js.map
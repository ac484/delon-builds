{"version":3,"sources":["../../../../packages/abc/loading/loading.component.ts","../../../../packages/abc/loading/loading.service.ts","../../../../packages/abc/loading/loading.module.ts"],"names":["LoadingDefaultComponent","Object","defineProperty","prototype","this","options","Component","args","selector","template","host","[class.loading-default]","preserveWhitespaces","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","LoadingService","overlay","configSrv","_this","compRef","opt","n$","Subject","cog","merge","type","text","icon","theme","spin","delay","loading$","asObservable","pipe","debounce","timer","subscribe","create","instance","_close","_overlayRef","positionStrategy","position","global","centerHorizontally","centerVertically","scrollStrategy","scrollStrategies","block","hasBackdrop","backdropClass","comp","ComponentPortal","attach","assign","changeDetectorRef","markForCheck","open","next","cleanOpt","detach","close","ngOnDestroy","unsubscribe","Injectable","providedIn","Overlay","AlainConfigService","NgModule","imports","CommonModule","OverlayModule","PortalModule","NzIconModule","NzSpinModule","declarations","exports"],"mappings":"o1BAaA,SAAAA,YAGEC,OAAAC,eAAIF,EAAAG,UAAA,OAAI,KAAR,WACE,OAAOC,KAAKC,QAAY,sCAG1BJ,OAAAC,eAAIF,EAAAG,UAAA,SAAM,KAAV,WACE,OAAOC,KAAKC,QAAc,iEAlB7BC,EAAAA,UAASC,KAAA,CAAC,CACTC,SAAU,kBACVC,SAAA,kgBACAC,KAAM,CACJC,0BAA2B,QAE7BC,qBAAqB,EACrBC,gBAAiBC,EAAAA,wBAAwBC,OACzCC,cAAeC,EAAAA,kBAAkBC,0BCWjC,SAAAC,EAAoBC,EAAkBC,GAAtC,IAAAC,EAAAlB,KAAoBA,KAAAgB,QAAAA,EAVZhB,KAAAmB,QAAwD,KACxDnB,KAAAoB,IAAiC,KAEjCpB,KAAAqB,GAAK,IAAIC,EAAAA,QAQftB,KAAKuB,IAAMN,EAAUO,MAAM,UAAW,CACpCC,KAAM,OACNC,KAAM,SACNC,KAAM,CACJF,KAAM,UACNG,MAAO,UACPC,MAAM,GAERC,MAAO,IAET9B,KAAK+B,SAAW/B,KAAKqB,GAClBW,eACAC,KAAKC,EAAAA,UAAQ,WAAO,OAAAC,EAAAA,MAAMjB,EAAQ,IAAEY,WACpCM,WAAS,WAAO,OAAAlB,EAAKmB,mBAlB1BxC,OAAAC,eAAIiB,EAAAhB,UAAA,WAAQ,KAAZ,WACE,OAAuB,MAAhBC,KAAKmB,QAAkBnB,KAAKmB,QAAQmB,SAAW,sCAoBhDvB,EAAAhB,UAAAsC,OAAA,WACN,GAAgB,MAAZrC,KAAKoB,IAAT,CAEApB,KAAKuC,QAAO,GAEZvC,KAAKwC,YAAcxC,KAAKgB,QAAQqB,OAAO,CACrCI,iBAAkBzC,KAAKgB,QAAQ0B,WAAWC,SAASC,qBAAqBC,mBACxEC,eAAgB9C,KAAKgB,QAAQ+B,iBAAiBC,QAC9CC,aAAa,EACbC,cAAe,yBAEXC,EAAO,IAAIC,EAAAA,gBAAgBxD,GACjCI,KAAKmB,QAAUnB,KAAKwC,YAAYa,OAAOF,GACvCtD,OAAOyD,OAAOtD,KAAKsC,SAAU,CAAErC,QAASD,KAAKoB,MAC7CpB,KAAKmB,QAAQoC,kBAAkBC,iBAGjCzC,EAAAhB,UAAA0D,KAAA,SAAKxD,GACHD,KAAKoB,IAAGvB,OAAAyD,OAAAzD,OAAAyD,OAAA,GAAQtD,KAAKuB,KAAQtB,GAC7BD,KAAKqB,GAAGqC,QAGF3C,EAAAhB,UAAAwC,OAAA,SAAOoB,GACTA,IAAU3D,KAAKoB,IAAM,MACpBpB,KAAKwC,cACVxC,KAAKwC,YAAYoB,SACjB5D,KAAKmB,QAAU,OAGjBJ,EAAAhB,UAAA8D,MAAA,WACE7D,KAAKuC,QAAO,IAGdxB,EAAAhB,UAAA+D,YAAA,WACE9D,KAAK+B,SAASgC,wCAhEjBC,EAAAA,WAAU7D,KAAA,CAAC,CAAE8D,WAAY,oDATjBC,EAAAA,eAGAC,EAAAA,+KCUT,iCALCC,EAAAA,SAAQjE,KAAA,CAAC,CACRkE,QAAS,CAACC,EAAAA,aAAcC,EAAAA,cAAeC,EAAAA,aAAcC,EAAAA,aAAcC,EAAAA,cACnEC,aAAc,CAAC/E,GACfgF,QAAS,CAAChF","sourcesContent":["import { ChangeDetectionStrategy, Component, ViewEncapsulation } from '@angular/core';\nimport { LoadingShowOptions } from './loading.types';\n\n@Component({\n  selector: 'loading-default',\n  templateUrl: './loading.component.html',\n  host: {\n    '[class.loading-default]': 'true',\n  },\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class LoadingDefaultComponent {\n  options: LoadingShowOptions;\n\n  get icon() {\n    return this.options.icon!;\n  }\n\n  get custom() {\n    return this.options.custom!;\n  }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { ComponentPortal } from '@angular/cdk/portal';\nimport { ComponentRef, Injectable, OnDestroy } from '@angular/core';\nimport { AlainConfigService, AlainLoadingConfig } from '@delon/util';\nimport { Subject, Subscription, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport { LoadingDefaultComponent } from './loading.component';\nimport { LoadingShowOptions } from './loading.types';\n\n@Injectable({ providedIn: 'root' })\nexport class LoadingService implements OnDestroy {\n  private _overlayRef: OverlayRef;\n  private compRef: ComponentRef<LoadingDefaultComponent> | null = null;\n  private opt: LoadingShowOptions | null = null;\n  private cog: AlainLoadingConfig;\n  private n$ = new Subject();\n  private loading$: Subscription;\n\n  get instance() {\n    return this.compRef != null ? this.compRef.instance : null;\n  }\n\n  constructor(private overlay: Overlay, configSrv: AlainConfigService) {\n    this.cog = configSrv.merge('loading', {\n      type: 'spin',\n      text: '加载中...',\n      icon: {\n        type: 'loading',\n        theme: 'outline',\n        spin: true,\n      },\n      delay: 0,\n    })!;\n    this.loading$ = this.n$\n      .asObservable()\n      .pipe(debounce(() => timer(this.opt!.delay)))\n      .subscribe(() => this.create());\n  }\n\n  private create() {\n    if (this.opt == null) return;\n\n    this._close(false);\n\n    this._overlayRef = this.overlay.create({\n      positionStrategy: this.overlay.position().global().centerHorizontally().centerVertically(),\n      scrollStrategy: this.overlay.scrollStrategies.block(),\n      hasBackdrop: true,\n      backdropClass: 'loading-backdrop',\n    });\n    const comp = new ComponentPortal(LoadingDefaultComponent);\n    this.compRef = this._overlayRef.attach(comp);\n    Object.assign(this.instance, { options: this.opt });\n    this.compRef.changeDetectorRef.markForCheck();\n  }\n\n  open(options?: LoadingShowOptions): void {\n    this.opt = { ...this.cog, ...options };\n    this.n$.next();\n  }\n\n  private _close(cleanOpt: boolean): void {\n    if (cleanOpt) this.opt = null;\n    if (!this._overlayRef) return;\n    this._overlayRef.detach();\n    this.compRef = null;\n  }\n\n  close(): void {\n    this._close(true);\n  }\n\n  ngOnDestroy(): void {\n    this.loading$.unsubscribe();\n  }\n}\n","import { OverlayModule } from '@angular/cdk/overlay';\nimport { PortalModule } from '@angular/cdk/portal';\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { NzSpinModule } from 'ng-zorro-antd/spin';\nimport { LoadingDefaultComponent } from './loading.component';\n\n@NgModule({\n  imports: [CommonModule, OverlayModule, PortalModule, NzIconModule, NzSpinModule],\n  declarations: [LoadingDefaultComponent],\n  exports: [LoadingDefaultComponent],\n})\nexport class LoadingModule {}\n"]}
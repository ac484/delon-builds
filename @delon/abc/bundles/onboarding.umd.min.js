/**
 * @license ng-alain(cipchk@qq.com) v11.10.2
 * (c) 2020 cipchk https://ng-alain.com/
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/cdk/bidi"),require("@angular/common"),require("@angular/core"),require("@angular/router"),require("@delon/theme"),require("@delon/util/config"),require("rxjs"),require("rxjs/operators"),require("@angular/cdk/platform"),require("ng-zorro-antd/button"),require("ng-zorro-antd/core/no-animation"),require("ng-zorro-antd/core/outlet"),require("ng-zorro-antd/popover")):"function"==typeof define&&define.amd?define("@delon/abc/onboarding",["exports","@angular/cdk/bidi","@angular/common","@angular/core","@angular/router","@delon/theme","@delon/util/config","rxjs","rxjs/operators","@angular/cdk/platform","ng-zorro-antd/button","ng-zorro-antd/core/no-animation","ng-zorro-antd/core/outlet","ng-zorro-antd/popover"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).delon=t.delon||{},t.delon.abc=t.delon.abc||{},t.delon.abc.onboarding={}),t.ng.cdk.bidi,t.ng.common,t.ng.core,t.ng.router,t.delon.theme,t.i4,t.rxjs,t.rxjs.operators,t.ng.cdk.platform,t["ng-zorro-antd/button"],t["ng-zorro-antd/core/no-animation"],t["ng-zorro-antd/core/outlet"],t["ng-zorro-antd/popover"])}(this,(function(t,e,n,o,i,r,a,s,c,l,p,u,d,g){"use strict";var h=function(){function t(t,e,n,i){this.el=t,this.doc=e,this.platform=n,this.cdr=i,this.active=0,this.max=0,this.op=new o.EventEmitter,this.running=!1,this.dir="ltr"}return Object.defineProperty(t.prototype,"first",{get:function(){return 0===this.active},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"last",{get:function(){return this.active===this.max-1},enumerable:!1,configurable:!0}),t.prototype._getDoc=function(){return this.doc},t.prototype._getWin=function(){return this._getDoc().defaultView||window},t.prototype.getLightData=function(){var t=this._getDoc(),e=this._getWin(),n=t.querySelector(this.item.selectors);if(!n)return null;var o=e.pageYOffset||t.documentElement.scrollTop||t.body.scrollTop,i=e.pageXOffset||t.documentElement.scrollLeft||t.body.scrollLeft,r=n.getBoundingClientRect(),a=r.top+o,s=r.left+i,c=a>8&&s>8,l=c?8:0,p=c?16:0;return{top:a-l,left:s-l,width:r.width+p,height:r.height+p,el:n,clientWidth:t.body.clientWidth,clientHeight:t.body.clientHeight}},t.prototype.ngAfterViewInit=function(){this.popover.component.onClickOutside=function(){}},t.prototype.scroll=function(t){this.prevSelectorEl=t.el;var e=t.top-(t.clientHeight-t.height)/2;this._getWin().scrollTo({top:e}),this.updatePrevElStatus(!0)},t.prototype.updateRunning=function(t){this.running=t,this.cdr.detectChanges(),t||this.updatePosition()},t.prototype.updatePosition=function(){if(this.platform.isBrowser){var t=this.getLightData();if(null!=t){var e=this.el.nativeElement.querySelector(".onboarding__light").style;e.top=t.top+"px",e.left=t.left+"px",e.width=t.width+"px",e.height=t.height+"px",this.updatePrevElStatus(!1),this.scroll(t)}else console.warn("Did not matches selectors ["+this.item.selectors+"]")}},t.prototype.updatePrevElStatus=function(t){this.prevSelectorEl&&this.prevSelectorEl.classList[t?"add":"remove"]("onboarding__light-el")},t.prototype.to=function(t){this.op.emit(t)},t.prototype.handleMask=function(){!0===this.config.maskClosable&&(this.popover.component.hide(),this.to("done"))},t.prototype.ngOnDestroy=function(){clearTimeout(this.time),this.updatePrevElStatus(!1)},t}();h.decorators=[{type:o.Component,args:[{selector:"onboarding",template:'<div *ngIf="!running && config.mask" class="onboarding__mask" (click)="handleMask()"></div>\n<div\n  *ngIf="item"\n  class="onboarding__light"\n  [class.onboarding__light-hide]="running"\n  [attr.style]="item.lightStyle"\n  nz-popover\n  #popover="nzPopover"\n  [nzPopoverTitle]="item.title"\n  [nzPopoverContent]="content"\n  [nzPopoverVisible]="!running"\n  [nzPopoverTrigger]="null"\n  [nzPopoverPlacement]="item.position"\n  [nzPopoverOverlayClassName]="item.className"\n  [nzPopoverOverlayStyle]="{ \'max-width.px\': item.width, direction: dir }"\n  [nzNoAnimation]="true"\n></div>\n<ng-template #content>\n  <ng-container *nzStringTemplateOutlet="item.content">\n    <div [innerHTML]="item.content"></div>\n  </ng-container>\n  <div class="flex-center-between onboarding__footer">\n    <span class="onboarding__total">\n      <ng-container *ngIf="config.showTotal">{{ active + 1 }}/{{ max }}</ng-container>\n    </span>\n    <div class="onboarding__btns">\n      <a *ngIf="!last && item.skip !== null" nz-button nzType="link" (click)="to(\'skip\')" nzSize="small" data-btnType="skip">\n        <ng-container *nzStringTemplateOutlet="item.skip">{{ item.skip }}</ng-container>\n      </a>\n      <a *ngIf="!first && item.prev !== null" nz-button (click)="to(\'prev\')" nzSize="small" data-btnType="prev">\n        <ng-container *nzStringTemplateOutlet="item.prev">{{ item.prev }}</ng-container>\n      </a>\n      <a *ngIf="!last && item.next !== null" nz-button (click)="to(\'next\')" nzType="primary" nzSize="small" data-btnType="next">\n        <ng-container *nzStringTemplateOutlet="item.next">{{ item.next }}</ng-container>\n      </a>\n      <a *ngIf="last && item.done !== null" nz-button (click)="to(\'done\')" nzType="primary" nzSize="small" data-btnType="done">\n        <ng-container *nzStringTemplateOutlet="item.done">{{ item.done }}</ng-container>\n      </a>\n    </div>\n  </div>\n</ng-template>\n',host:{"[class.onboarding]":"true","[class.onboarding-rtl]":"dir === 'rtl'","[attr.data-onboarding-active]":"active"},preserveWhitespaces:!1,changeDetection:o.ChangeDetectionStrategy.OnPush,encapsulation:o.ViewEncapsulation.None}]}],h.ctorParameters=function(){return[{type:o.ElementRef},{type:void 0,decorators:[{type:o.Optional},{type:o.Inject,args:[n.DOCUMENT]}]},{type:l.Platform},{type:o.ChangeDetectorRef}]},h.propDecorators={popover:[{type:o.ViewChild,args:["popover",{static:!1}]}]};var f=function(){function t(t,e,n,o,i,r,a,s){this.i18n=t,this.appRef=e,this.resolver=n,this.router=o,this.injector=i,this.doc=r,this.configSrv=a,this.directionality=s,this.active=0,this.running$=null,this._running=!1,this.type=null}return t.prototype._getDoc=function(){return this.doc},Object.defineProperty(t.prototype,"running",{get:function(){return this._running},enumerable:!1,configurable:!0}),t.prototype.attach=function(){var t=this,e=this.compRef=this.resolver.resolveComponentFactory(h).create(this.injector);this.appRef.attachView(e.hostView);var n=e.hostView.rootNodes[0],o=this._getDoc(),i=o.querySelector(".cdk-overlay-container");i?o.body.insertBefore(n,i):o.body.appendChild(n),this.op$=this.compRef.instance.op.subscribe((function(e){switch(e){case"next":t.next();break;case"prev":t.prev();break;default:t.done()}}))},t.prototype.cancelRunning=function(){return this.running$&&(this.running$.unsubscribe(),this.running$=null),this},t.prototype.updateRunning=function(t){return this._running=t,this.compRef.instance.updateRunning(t),this},t.prototype.destroy=function(){this.cancelRunning(),this.compRef&&(this.appRef.detachView(this.compRef.hostView),this.compRef.destroy(),this.op$.unsubscribe())},t.prototype.showItem=function(t){var e=this;void 0===t&&(t=!1);var n=this.config.items,o=Object.assign(Object.assign({position:"bottomLeft",before:s.of(!0),after:s.of(!0)},this.i18n.getData("onboarding")),n[this.active]),i=this.configSrv.get("onboarding").direction||this.directionality.value;Object.assign(this.compRef.instance,{item:o,config:this.config,active:this.active,max:n.length,dir:i});var r=[c.switchMap((function(){return o.url?e.router.navigateByUrl(o.url):s.of(!0)})),c.switchMap((function(){var t="prev"===e.type?o.after:o.before;return"number"==typeof t?s.of(!0).pipe(c.delay(t)):t}))];t||r.push(c.delay(1)),this.updateRunning(!0),this.running$=s.of(!0).pipe(s.pipe.apply(this,r)).subscribe((function(){return e.cancelRunning().updateRunning(!1)}),(function(){return e.done()}))},t.prototype.start=function(t){this.running||(this.destroy(),this.config=Object.assign({items:[],mask:!0,maskClosable:!0,showTotal:!1},t),this.active=0,this.type=null,this.attach(),this.showItem(!0))},t.prototype.next=function(){this._running||this.active+1>=this.config.items.length?this.done():(this.type="next",++this.active,this.showItem())},t.prototype.prev=function(){this._running||this.active-1<0||(this.type="prev",--this.active,this.showItem())},t.prototype.done=function(){this.type="done",this.destroy()},t.prototype.ngOnDestroy=function(){this.destroy()},t}();f.ɵprov=o.ɵɵdefineInjectable({factory:function(){return new f(o.ɵɵinject(r.DelonLocaleService),o.ɵɵinject(o.ApplicationRef),o.ɵɵinject(o.ComponentFactoryResolver),o.ɵɵinject(i.Router),o.ɵɵinject(o.INJECTOR),o.ɵɵinject(n.DOCUMENT),o.ɵɵinject(a.AlainConfigService),o.ɵɵinject(e.Directionality,8))},token:f,providedIn:"root"}),f.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],f.ctorParameters=function(){return[{type:r.DelonLocaleService},{type:o.ApplicationRef},{type:o.ComponentFactoryResolver},{type:i.Router},{type:o.Injector},{type:void 0,decorators:[{type:o.Inject,args:[n.DOCUMENT]}]},{type:a.AlainConfigService},{type:e.Directionality,decorators:[{type:o.Optional}]}]};var m=[h],y=function(){};y.decorators=[{type:o.NgModule,args:[{imports:[n.CommonModule,r.DelonLocaleModule,g.NzPopoverModule,d.NzOutletModule,p.NzButtonModule,u.NzNoAnimationModule],declarations:m,entryComponents:m,exports:m}]}],t.OnboardingComponent=h,t.OnboardingModule=y,t.OnboardingService=f,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=onboarding.umd.min.js.map
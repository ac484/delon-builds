{"version":3,"file":"loading.umd.js","sources":["../../../../packages/abc/loading/loading.component.ts","../../../../packages/abc/loading/loading.service.ts","../../../../packages/abc/loading/loading.module.ts"],"sourcesContent":["import { ChangeDetectionStrategy, Component, ViewEncapsulation } from '@angular/core';\nimport { LoadingShowOptions } from './loading.types';\n\n@Component({\n  selector: 'loading-default',\n  templateUrl: './loading.component.html',\n  host: {\n    '[class.loading-default]': 'true',\n  },\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class LoadingDefaultComponent {\n  options: LoadingShowOptions;\n\n  get icon() {\n    return this.options.icon!;\n  }\n\n  get custom() {\n    return this.options.custom!;\n  }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { ComponentPortal } from '@angular/cdk/portal';\nimport { ComponentRef, Injectable, OnDestroy } from '@angular/core';\nimport { AlainConfigService, AlainLoadingConfig } from '@delon/util';\nimport { Subject, Subscription, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport { LoadingDefaultComponent } from './loading.component';\nimport { LoadingShowOptions } from './loading.types';\n\n@Injectable({ providedIn: 'root' })\nexport class LoadingService implements OnDestroy {\n  private _overlayRef: OverlayRef;\n  private compRef: ComponentRef<LoadingDefaultComponent> | null = null;\n  private opt: LoadingShowOptions | null = null;\n  private cog: AlainLoadingConfig;\n  private n$ = new Subject();\n  private loading$: Subscription;\n\n  get instance() {\n    return this.compRef != null ? this.compRef.instance : null;\n  }\n\n  constructor(private overlay: Overlay, configSrv: AlainConfigService) {\n    this.cog = configSrv.merge('loading', {\n      type: 'spin',\n      text: '加载中...',\n      icon: {\n        type: 'loading',\n        theme: 'outline',\n        spin: true,\n      },\n      delay: 0,\n    })!;\n    this.loading$ = this.n$\n      .asObservable()\n      .pipe(debounce(() => timer(this.opt!.delay)))\n      .subscribe(() => this.create());\n  }\n\n  private create() {\n    if (this.opt == null) return;\n\n    this._close(false);\n\n    this._overlayRef = this.overlay.create({\n      positionStrategy: this.overlay.position().global().centerHorizontally().centerVertically(),\n      scrollStrategy: this.overlay.scrollStrategies.block(),\n      hasBackdrop: true,\n      backdropClass: 'loading-backdrop',\n    });\n    const comp = new ComponentPortal(LoadingDefaultComponent);\n    this.compRef = this._overlayRef.attach(comp);\n    Object.assign(this.instance, { options: this.opt });\n    this.compRef.changeDetectorRef.markForCheck();\n  }\n\n  open(options?: LoadingShowOptions): void {\n    this.opt = { ...this.cog, ...options };\n    this.n$.next();\n  }\n\n  private _close(cleanOpt: boolean): void {\n    if (cleanOpt) this.opt = null;\n    if (!this._overlayRef) return;\n    this._overlayRef.detach();\n    this.compRef = null;\n  }\n\n  close(): void {\n    this._close(true);\n  }\n\n  ngOnDestroy(): void {\n    this.loading$.unsubscribe();\n  }\n}\n","import { OverlayModule } from '@angular/cdk/overlay';\nimport { PortalModule } from '@angular/cdk/portal';\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { NzSpinModule } from 'ng-zorro-antd/spin';\nimport { LoadingDefaultComponent } from './loading.component';\n\n@NgModule({\n  imports: [CommonModule, OverlayModule, PortalModule, NzIconModule, NzSpinModule],\n  declarations: [LoadingDefaultComponent],\n  exports: [LoadingDefaultComponent],\n})\nexport class LoadingModule {}\n"],"names":["Component","ChangeDetectionStrategy","ViewEncapsulation","Subject","debounce","timer","ComponentPortal","Injectable","Overlay","AlainConfigService","NgModule","CommonModule","OverlayModule","PortalModule","NzIconModule","NzSpinModule"],"mappings":"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"}
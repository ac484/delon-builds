/**
 * @license ng-alain(cipchk@qq.com) v11.3.1
 * (c) 2020 cipchk https://ng-alain.com/
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@delon/theme"),require("ng-zorro-antd/menu"),require("@angular/common"),require("rxjs"),require("@angular/cdk/overlay"),require("@angular/cdk/portal"),require("@delon/util/decorator"),require("rxjs/operators"),require("@angular/router"),require("ng-zorro-antd/tabs"),require("ng-zorro-antd/icon")):"function"==typeof define&&define.amd?define("@delon/abc/reuse-tab",["exports","@angular/core","@delon/theme","ng-zorro-antd/menu","@angular/common","rxjs","@angular/cdk/overlay","@angular/cdk/portal","@delon/util/decorator","rxjs/operators","@angular/router","ng-zorro-antd/tabs","ng-zorro-antd/icon"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).delon=e.delon||{},e.delon.abc=e.delon.abc||{},e.delon.abc["reuse-tab"]={}),e.ng.core,e.delon.theme,e["ng-zorro-antd/menu"],e.ng.common,e.rxjs,e.ng.cdk.overlay,e.ng.cdk.portal,e.decorator,e.rxjs.operators,e.ng.router,e["ng-zorro-antd/tabs"],e["ng-zorro-antd/icon"])}(this,(function(e,t,n,o,i,r,s,a,c,u,l,h,p){"use strict";function d(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var f=d(t),g=function(){function e(e){this.i18nSrv=e,this.close=new t.EventEmitter}return Object.defineProperty(e.prototype,"i18n",{get:function(){return this._i18n},set:function(e){this._i18n=Object.assign(Object.assign({},this.i18nSrv.getData("reuseTab")),e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"includeNonCloseable",{get:function(){return this.event.ctrlKey},enumerable:!1,configurable:!0}),e.prototype.notify=function(e){this.close.next({type:e,item:this.item,includeNonCloseable:this.includeNonCloseable})},e.prototype.ngOnInit=function(){this.includeNonCloseable&&(this.item.closable=!0)},e.prototype.click=function(e,t,n){if(e.preventDefault(),e.stopPropagation(),("close"!==t||this.item.closable)&&("closeRight"!==t||!this.item.last)){if(n){if(this.isDisabled(n))return;n.fn(this.item,n)}this.notify(t)}},e.prototype.isDisabled=function(e){return!!e.disabled&&e.disabled(this.item)},e.prototype.closeMenu=function(e){"click"===e.type&&2===e.button||this.notify(null)},e}();g.ɵfac=function(e){return new(e||g)(t.ɵɵdirectiveInject(n.DelonLocaleService))},g.ɵcmp=t.ɵɵngDeclareComponent({version:"11.1.1",type:g,selector:"reuse-tab-context-menu",inputs:{i18n:"i18n",item:"item",event:"event",customContextMenu:"customContextMenu"},outputs:{close:"close"},host:{listeners:{"document:click":"closeMenu($event)","document:contextmenu":"closeMenu($event)"}},ngImport:f,template:'<ul nz-menu>\n  <li nz-menu-item (click)="click($event, \'refresh\')" data-type="refresh" [innerHTML]="i18n.refresh"></li>\n  <li nz-menu-item (click)="click($event, \'close\')" data-type="close" [nzDisabled]="!item.closable" [innerHTML]="i18n.close"></li>\n  <li nz-menu-item (click)="click($event, \'closeOther\')" data-type="closeOther" [innerHTML]="i18n.closeOther"></li>\n  <li nz-menu-item (click)="click($event, \'closeRight\')" data-type="closeRight" [nzDisabled]="item.last" [innerHTML]="i18n.closeRight"></li>\n  <ng-container *ngIf="customContextMenu!.length > 0">\n    <li nz-menu-divider></li>\n    <li\n      *ngFor="let i of customContextMenu"\n      nz-menu-item\n      [attr.data-type]="i.id"\n      [nzDisabled]="isDisabled(i)"\n      (click)="click($event, \'custom\', i)"\n      [innerHTML]="i.title"\n    ></li>\n  </ng-container>\n</ul>\n',directives:[{type:o.NzMenuDirective,selector:"[nz-menu]",inputs:["nzInlineIndent","nzTheme","nzMode","nzInlineCollapsed","nzSelectable"],outputs:["nzClick"],exportAs:["nzMenu"]},{type:o.NzMenuItemDirective,selector:"[nz-menu-item]",inputs:["nzDisabled","nzSelected","nzDanger","nzMatchRouterExact","nzMatchRouter","nzPaddingLeft"],exportAs:["nzMenuItem"]},{type:i.NgIf,selector:"[ngIf]",inputs:["ngIf","ngIfThen","ngIfElse"]},{type:o.NzMenuDividerDirective,selector:"[nz-menu-divider]",exportAs:["nzMenuDivider"]},{type:i.NgForOf,selector:"[ngFor][ngForOf]",inputs:["ngForOf","ngForTrackBy","ngForTemplate"]}],changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(g,[{type:t.Component,args:[{selector:"reuse-tab-context-menu",templateUrl:"./reuse-tab-context-menu.component.html",host:{"(document:click)":"closeMenu($event)","(document:contextmenu)":"closeMenu($event)"},preserveWhitespaces:!1,changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None}]}],(function(){return[{type:n.DelonLocaleService}]}),{i18n:[{type:t.Input}],item:[{type:t.Input}],event:[{type:t.Input}],customContextMenu:[{type:t.Input}],close:[{type:t.Output}]});var b=function(){function e(e){this.overlay=e,this.show=new r.Subject,this.close=new r.Subject}return e.prototype.remove=function(){this.ref&&(this.ref.detach(),this.ref.dispose(),this.ref=null)},e.prototype.open=function(e){var n=this;this.remove();var o=e.event,i=e.item,c=e.customContextMenu,u=new t.ElementRef({getBoundingClientRect:function(){return{bottom:o.clientY,height:0,left:o.clientX,right:o.clientX,top:o.clientY,width:0}}}),l=[new s.ConnectionPositionPair({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"top"}),new s.ConnectionPositionPair({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"})],h=this.overlay.position().flexibleConnectedTo(u).withPositions(l);this.ref=this.overlay.create({positionStrategy:h,panelClass:"reuse-tab__cm",scrollStrategy:this.overlay.scrollStrategies.close()});var p=this.ref.attach(new a.ComponentPortal(g)),d=p.instance;d.i18n=this.i18n,d.item=Object.assign({},i),d.customContextMenu=c,d.event=o;var f=new r.Subscription;f.add(d.close.subscribe((function(e){n.close.next(e),n.remove()}))),p.onDestroy((function(){return f.unsubscribe()}))},e}();b.ɵfac=function(e){return new(e||b)(t.ɵɵinject(s.Overlay))},b.ɵprov=t.ɵɵdefineInjectable({token:b,factory:b.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(b,[{type:t.Injectable}],(function(){return[{type:s.Overlay}]}),null);var y=function(){function e(e){var n=this;this.srv=e,this.sub$=new r.Subscription,this.change=new t.EventEmitter,this.sub$.add(e.show.subscribe((function(e){return n.srv.open(e)}))),this.sub$.add(e.close.subscribe((function(e){return n.change.emit(e)})))}return Object.defineProperty(e.prototype,"i18n",{set:function(e){this.srv.i18n=e},enumerable:!1,configurable:!0}),e.prototype.ngOnDestroy=function(){this.sub$.unsubscribe()},e}();y.ɵfac=function(e){return new(e||y)(t.ɵɵdirectiveInject(b))},y.ɵcmp=t.ɵɵngDeclareComponent({version:"11.1.1",type:y,selector:"reuse-tab-context",inputs:{i18n:"i18n"},outputs:{change:"change"},ngImport:f,template:"",isInline:!0}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(y,[{type:t.Component,args:[{selector:"reuse-tab-context",template:""}]}],(function(){return[{type:b}]}),{i18n:[{type:t.Input}],change:[{type:t.Output}]});var v=function(){function e(e){this.srv=e}return e.prototype._onContextMenu=function(e){this.srv.show.next({event:e,item:this.item,customContextMenu:this.customContextMenu}),e.preventDefault(),e.stopPropagation()},e}();v.ɵfac=function(e){return new(e||v)(t.ɵɵdirectiveInject(b))},v.ɵdir=t.ɵɵngDeclareDirective({version:"11.1.1",type:v,selector:"[reuse-tab-context-menu]",inputs:{item:["reuse-tab-context-menu","item"],customContextMenu:"customContextMenu"},host:{listeners:{contextmenu:"_onContextMenu($event)"}},exportAs:["reuseTabContextMenu"],ngImport:f}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(v,[{type:t.Directive,args:[{selector:"[reuse-tab-context-menu]",exportAs:"reuseTabContextMenu",host:{"(contextmenu)":"_onContextMenu($event)"}}]}],(function(){return[{type:b}]}),{item:[{type:t.Input,args:["reuse-tab-context-menu"]}],customContextMenu:[{type:t.Input}]});function m(e,t,n,o){var i,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s}function x(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}Object.create;function C(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,i,r=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return s}function M(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(C(arguments[t]));return e}var _;Object.create;(_=e.ReuseTabMatchMode||(e.ReuseTabMatchMode={}))[_.Menu=0]="Menu",_[_.MenuForce=1]="MenuForce",_[_.URL=2]="URL";var z=function(){function t(t,n){this.injector=t,this.menuService=n,this._inited=!1,this._max=10,this._keepingScroll=!1,this._cachedChange=new r.BehaviorSubject(null),this._cached=[],this._titleCached={},this._closableCached={},this.positionBuffer={},this.debug=!1,this.routeParamMatchMode="strict",this.mode=e.ReuseTabMatchMode.Menu,this.excludes=[]}return Object.defineProperty(t.prototype,"snapshot",{get:function(){return this.injector.get(l.ActivatedRoute).snapshot},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inited",{get:function(){return this._inited},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"curUrl",{get:function(){return this.getUrl(this.snapshot)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"max",{set:function(e){this._max=Math.min(Math.max(e,2),100);for(var t=this._cached.length;t>this._max;t--)this._cached.pop()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keepingScroll",{get:function(){return this._keepingScroll},set:function(e){this._keepingScroll=e,this.initScroll()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this._cached},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._cached.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"change",{get:function(){return this._cachedChange.asObservable()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"title",{set:function(e){var t=this.curUrl;"string"==typeof e&&(e={text:e}),this._titleCached[t]=e,this.di("update current tag title: ",e),this._cachedChange.next({active:"title",url:t,title:e,list:this._cached})},enumerable:!1,configurable:!0}),t.prototype.index=function(e){return this._cached.findIndex((function(t){return t.url===e}))},t.prototype.exists=function(e){return-1!==this.index(e)},t.prototype.get=function(e){return e&&this._cached.find((function(t){return t.url===e}))||null},t.prototype.remove=function(e,t){var n="string"==typeof e?this.index(e):e,o=-1!==n?this._cached[n]:null;return!(!o||!t&&!o.closable)&&(this.destroy(o._handle),this._cached.splice(n,1),delete this._titleCached[e],!0)},t.prototype.close=function(e,t){return void 0===t&&(t=!1),this.removeUrlBuffer=e,this.remove(e,t),this._cachedChange.next({active:"close",url:e,list:this._cached}),this.di("close tag",e),!0},t.prototype.closeRight=function(e,t){void 0===t&&(t=!1);for(var n=this.index(e),o=this.count-1;o>n;o--)this.remove(o,t);return this.removeUrlBuffer=null,this._cachedChange.next({active:"closeRight",url:e,list:this._cached}),this.di("close right tages",e),!0},t.prototype.clear=function(e){var t=this;void 0===e&&(e=!1),this._cached.forEach((function(n){!e&&n.closable&&t.destroy(n._handle)})),this._cached=this._cached.filter((function(t){return!e&&!t.closable})),this.removeUrlBuffer=null,this._cachedChange.next({active:"clear",list:this._cached}),this.di("clear all catch")},t.prototype.move=function(e,t){var n=this._cached.findIndex((function(t){return t.url===e}));if(-1!==n){var o=this._cached.slice();o.splice(t<0?o.length+t:t,0,o.splice(n,1)[0]),this._cached=o,this._cachedChange.next({active:"move",url:e,position:t,list:this._cached})}},t.prototype.replace=function(e){var t=this.curUrl;this.exists(t)?this.close(t,!0):this.removeUrlBuffer=t,this.injector.get(l.Router).navigateByUrl(e)},t.prototype.getTitle=function(e,t){if(this._titleCached[e])return this._titleCached[e];if(t&&t.data&&(t.data.titleI18n||t.data.title))return{text:t.data.title,i18n:t.data.titleI18n};var n=this.getMenu(e);return n?{text:n.text,i18n:n.i18n}:{text:e}},t.prototype.clearTitleCached=function(){this._titleCached={}},Object.defineProperty(t.prototype,"closable",{set:function(e){var t=this.curUrl;this._closableCached[t]=e,this.di("update current tag closable: ",e),this._cachedChange.next({active:"closable",closable:e,list:this._cached})},enumerable:!1,configurable:!0}),t.prototype.getClosable=function(t,n){if(void 0!==this._closableCached[t])return this._closableCached[t];if(n&&n.data&&"boolean"==typeof n.data.reuseClosable)return n.data.reuseClosable;var o=this.mode!==e.ReuseTabMatchMode.URL?this.getMenu(t):null;return!o||"boolean"!=typeof o.reuseClosable||o.reuseClosable},t.prototype.clearClosableCached=function(){this._closableCached={}},t.prototype.getTruthRoute=function(e){for(var t=e;t.firstChild;)t=t.firstChild;return t},t.prototype.getUrl=function(e){for(var t=this.getTruthRoute(e),n=[];t;)n.push(t.url.join("/")),t=t.parent;return"/"+n.filter((function(e){return e})).reverse().join("/")},t.prototype.can=function(t){var n=this.getUrl(t);if(n===this.removeUrlBuffer)return!1;if(t.data&&"boolean"==typeof t.data.reuse)return t.data.reuse;if(this.mode!==e.ReuseTabMatchMode.URL){var o=this.getMenu(n);if(!o)return!1;if(this.mode===e.ReuseTabMatchMode.Menu){if(!1===o.reuse)return!1}else if(!o.reuse||!0!==o.reuse)return!1;return!0}return!this.isExclude(n)},t.prototype.isExclude=function(e){return-1!==this.excludes.findIndex((function(t){return t.test(e)}))},t.prototype.refresh=function(e){this._cachedChange.next({active:"refresh",data:e})},t.prototype.destroy=function(e){e&&e.componentRef&&e.componentRef.destroy&&e.componentRef.destroy()},t.prototype.di=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.debug&&console.warn.apply(console,M(e))},t.prototype.init=function(){this.initScroll(),this._inited=!0},t.prototype.getMenu=function(e){var t=this.menuService.getPathByUrl(e);return t&&0!==t.length?t.pop():null},t.prototype.runHook=function(e,t,n){(void 0===n&&(n="init"),"number"==typeof t)&&(t=this._cached[t]._handle.componentRef);var o=t.instance;if(null!=t&&o){var i=o[e];"function"==typeof i&&("_onReuseInit"===e?i.call(o,n):i.call(o))}},t.prototype.hasInValidRoute=function(e){return!e.routeConfig||!!e.routeConfig.loadChildren||!!e.routeConfig.children},t.prototype.shouldDetach=function(e){return!this.hasInValidRoute(e)&&(this.di("#shouldDetach",this.can(e),this.getUrl(e)),this.can(e))},t.prototype.store=function(e,t){var n=this.getUrl(e),o=this.index(n),i=-1===o,r={title:this.getTitle(n,e),closable:this.getClosable(n,e),position:this.getKeepingScroll(n,e)?this.positionBuffer[n]:null,url:n,_snapshot:e,_handle:t};if(i){if(this.count>=this._max){var s=this._cached.findIndex((function(e){return e.closable}));-1!==s&&this.remove(s,!1)}this._cached.push(r)}else this._cached[o]=r;this.removeUrlBuffer=null,this.di("#store",i?"[new]":"[override]",n),t&&t.componentRef&&this.runHook("_onReuseDestroy",t.componentRef),i||this._cachedChange.next({active:"override",item:r,list:this._cached})},t.prototype.shouldAttach=function(e){if(this.hasInValidRoute(e))return!1;var t=this.getUrl(e),n=this.get(t),o=!(!n||!n._handle);if(this.di("#shouldAttach",o,t),o){var i=n._handle.componentRef;i&&(this.componentRef=i,this.runHook("_onReuseInit",i))}else this._cachedChange.next({active:"add",url:t,list:this._cached});return o},t.prototype.retrieve=function(e){if(this.hasInValidRoute(e))return null;var t=this.getUrl(e),n=this.get(t),o=n&&n._handle||null;return this.di("#retrieve",t,o),o},t.prototype.shouldReuseRoute=function(e,t){var n=e.routeConfig===t.routeConfig;if(!n)return!1;var o=e.routeConfig&&e.routeConfig.path||"";return o.length>0&&~o.indexOf(":")&&(n="strict"===this.routeParamMatchMode?this.getUrl(e)===this.getUrl(t):o===(t.routeConfig&&t.routeConfig.path||"")),this.di("====================="),this.di("#shouldReuseRoute",n,this.getUrl(t)+"=>"+this.getUrl(e),e,t),n},t.prototype.getKeepingScroll=function(t,n){if(n&&n.data&&"boolean"==typeof n.data.keepingScroll)return n.data.keepingScroll;var o=this.mode!==e.ReuseTabMatchMode.URL?this.getMenu(t):null;return o&&"boolean"==typeof o.keepingScroll?o.keepingScroll:this.keepingScroll},Object.defineProperty(t.prototype,"isDisabledInRouter",{get:function(){return"disabled"===this.injector.get(l.ROUTER_CONFIGURATION,{}).scrollPositionRestoration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ss",{get:function(){return this.injector.get(n.ScrollService)},enumerable:!1,configurable:!0}),t.prototype.initScroll=function(){var e=this;this._router$&&this._router$.unsubscribe(),this._router$=this.injector.get(l.Router).events.subscribe((function(t){if(t instanceof l.NavigationStart){var n=e.curUrl;e.getKeepingScroll(n,e.getTruthRoute(e.snapshot))?e.positionBuffer[n]=e.ss.getScrollPosition(e.keepingScrollContainer):delete e.positionBuffer[n]}else if(t instanceof l.NavigationEnd){n=e.curUrl;var o=e.get(n);o&&o.position&&e.getKeepingScroll(n,e.getTruthRoute(e.snapshot))&&(e.isDisabledInRouter?e.ss.scrollToPosition(e.keepingScrollContainer,o.position):setTimeout((function(){return e.ss.scrollToPosition(e.keepingScrollContainer,o.position)}),1))}}))},t.prototype.ngOnDestroy=function(){var e=this._cachedChange,t=this._router$;this.clear(),this._cached=[],e.complete(),t&&t.unsubscribe()},t}();z.ɵfac=function(e){return new(e||z)(t.ɵɵinject(t.Injector),t.ɵɵinject(n.MenuService))},z.ɵprov=t.ɵɵdefineInjectable({token:z,factory:z.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(z,[{type:t.Injectable,args:[{providedIn:"root"}]}],(function(){return[{type:t.Injector},{type:n.MenuService}]}),null);var I=function(){function n(n,o,i,s,a,c){this.srv=n,this.cdr=o,this.router=i,this.route=s,this.i18nSrv=a,this.doc=c,this.unsubscribe$=new r.Subject,this.updatePos$=new r.Subject,this.list=[],this.pos=0,this.mode=e.ReuseTabMatchMode.Menu,this.debug=!1,this.allowClose=!0,this.keepingScroll=!1,this.customContextMenu=[],this.tabType="line",this.routeParamMatchMode="strict",this.change=new t.EventEmitter,this.close=new t.EventEmitter}return Object.defineProperty(n.prototype,"keepingScrollContainer",{set:function(e){this._keepingScrollContainer="string"==typeof e?this.doc.querySelector(e):e},enumerable:!1,configurable:!0}),n.prototype.genTit=function(e){return e.i18n&&this.i18nSrv?this.i18nSrv.fanyi(e.i18n):e.text},Object.defineProperty(n.prototype,"curUrl",{get:function(){return this.srv.getUrl(this.route.snapshot)},enumerable:!1,configurable:!0}),n.prototype.genCurItem=function(){var e=this.curUrl,t=this.srv.getTruthRoute(this.route.snapshot);return{url:e,title:this.genTit(this.srv.getTitle(e,t)),closable:this.allowClose&&this.srv.count>0&&this.srv.getClosable(e,t),active:!1,last:!1,index:0}},n.prototype.genList=function(e){var t=this,n=this.srv.items.map((function(e,n){return{url:e.url,title:t.genTit(e.title),closable:t.allowClose&&e.closable&&t.srv.count>0,index:n,active:!1,last:!1}})),o=this.curUrl,i=-1===n.findIndex((function(e){return e.url===o}));if(e&&"close"===e.active&&e.url===o){i=!1;var r=0,s=this.list.find((function(e){return e.url===o}));s.index===n.length?r=n.length-1:s.index<n.length&&(r=Math.max(0,s.index)),this.router.navigateByUrl(n[r].url)}i&&n.push(this.genCurItem()),n.forEach((function(e,t){return e.index=t})),1===n.length&&(n[0].closable=!1),this.list=n,this.cdr.detectChanges(),this.updatePos$.next()},n.prototype.updateTitle=function(e){var t=this.list.find((function(t){return t.url===e.url}));t&&(t.title=this.genTit(e.title),this.cdr.detectChanges())},n.prototype.refresh=function(e){this.srv.runHook("_onReuseInit",this.pos===e.index?this.srv.componentRef:e.index,"refresh")},n.prototype.contextMenuChange=function(e){var t=this,n=null;switch(e.type){case"refresh":this.refresh(e.item);break;case"close":this._close(null,e.item.index,e.includeNonCloseable);break;case"closeRight":n=function(){t.srv.closeRight(e.item.url,e.includeNonCloseable),t.close.emit(null)};break;case"closeOther":n=function(){t.srv.clear(e.includeNonCloseable),t.close.emit(null)}}n&&(!e.item.active&&e.item.index<=this.list.find((function(e){return e.active})).index?this._to(e.item.index,n):n())},n.prototype._to=function(e,t){var n=this;e=Math.max(0,Math.min(e,this.list.length-1));var o=this.list[e];this.router.navigateByUrl(o.url).then((function(e){e&&(n.item=o,n.change.emit(o),t&&t())}))},n.prototype._close=function(e,t,n){null!=e&&(e.preventDefault(),e.stopPropagation());var o=this.list[t];return this.srv.close(o.url,n),this.close.emit(o),this.cdr.detectChanges(),!1},n.prototype.activate=function(e){this.srv.componentRef={instance:e}},n.prototype.ngOnInit=function(){var e=this;this.updatePos$.pipe(u.takeUntil(this.unsubscribe$),u.debounceTime(50)).subscribe((function(){var t=e.srv.getUrl(e.route.snapshot),n=e.list.filter((function(n){return n.url===t||!e.srv.isExclude(n.url)}));if(0!==n.length){var o=n[n.length-1],i=n.find((function(e){return e.url===t}));o.last=!0;var r=null==i?o.index:i.index;n.forEach((function(e,t){return e.active=r===t})),e.pos=r,e.tabset.nzSelectedIndex=r,e.list=n,e.cdr.detectChanges()}})),this.srv.change.pipe(u.takeUntil(this.unsubscribe$)).subscribe((function(t){var n;switch(null==t?void 0:t.active){case"title":return void e.updateTitle(t);case"override":if((null===(n=null==t?void 0:t.list)||void 0===n?void 0:n.length)===e.list.length)return void e.updatePos$.next()}e.genList(t)})),this.i18nSrv.change.pipe(u.filter((function(){return e.srv.inited})),u.takeUntil(this.unsubscribe$),u.debounceTime(100)).subscribe((function(){return e.genList({active:"title"})})),this.srv.init()},n.prototype.ngOnChanges=function(e){e.max&&(this.srv.max=this.max),e.excludes&&(this.srv.excludes=this.excludes),e.mode&&(this.srv.mode=this.mode),e.routeParamMatchMode&&(this.srv.routeParamMatchMode=this.routeParamMatchMode),e.keepingScroll&&(this.srv.keepingScroll=this.keepingScroll,this.srv.keepingScrollContainer=this._keepingScrollContainer),this.srv.debug=this.debug,this.cdr.detectChanges()},n.prototype.ngOnDestroy=function(){var e=this.unsubscribe$;e.next(),e.complete()},n}();I.ɵfac=function(e){return new(e||I)(t.ɵɵdirectiveInject(z),t.ɵɵdirectiveInject(t.ChangeDetectorRef),t.ɵɵdirectiveInject(l.Router),t.ɵɵdirectiveInject(l.ActivatedRoute),t.ɵɵdirectiveInject(n.ALAIN_I18N_TOKEN,8),t.ɵɵdirectiveInject(i.DOCUMENT))},I.ɵcmp=t.ɵɵngDeclareComponent({version:"11.1.1",type:I,selector:"reuse-tab, [reuse-tab]",inputs:{mode:"mode",i18n:"i18n",debug:"debug",max:"max",tabMaxWidth:"tabMaxWidth",excludes:"excludes",allowClose:"allowClose",keepingScroll:"keepingScroll",keepingScrollContainer:"keepingScrollContainer",customContextMenu:"customContextMenu",tabBarExtraContent:"tabBarExtraContent",tabBarGutter:"tabBarGutter",tabBarStyle:"tabBarStyle",tabType:"tabType",routeParamMatchMode:"routeParamMatchMode"},outputs:{change:"change",close:"close"},host:{properties:{"class.reuse-tab":"true","class.reuse-tab__line":"tabType === 'line'","class.reuse-tab__card":"tabType === 'card'"}},providers:[b],viewQueries:[{propertyName:"tabset",first:!0,predicate:["tabset"],emitDistinctChangesOnly:!1,descendants:!0}],exportAs:["reuseTab"],usesOnChanges:!0,ngImport:f,template:'<nz-tabset\n  #tabset\n  [nzSelectedIndex]="pos"\n  [nzAnimated]="false"\n  [nzType]="tabType"\n  [nzTabBarExtraContent]="tabBarExtraContent"\n  [nzTabBarGutter]="tabBarGutter"\n  [nzTabBarStyle]="tabBarStyle"\n>\n  <nz-tab *ngFor="let i of list; let index = index" [nzTitle]="titleTemplate" (nzClick)="_to(index)">\n    <ng-template #titleTemplate>\n      <div [reuse-tab-context-menu]="i" [customContextMenu]="customContextMenu" class="reuse-tab__name" [attr.title]="i.title">\n        <span [class.reuse-tab__name-width]="tabMaxWidth" [style.max-width.px]="tabMaxWidth">\n          {{ i.title }}\n        </span>\n      </div>\n      <i *ngIf="i.closable" nz-icon nzType="close" class="reuse-tab__op" (click)="_close($event, index, false)"></i>\n    </ng-template>\n  </nz-tab>\n</nz-tabset>\n<reuse-tab-context [i18n]="i18n" (change)="contextMenuChange($event)"></reuse-tab-context>\n',directives:[{type:h.NzTabSetComponent,selector:"nz-tabset",inputs:["nzTabPosition","nzCanDeactivate","nzAddIcon","nzTabBarStyle","nzType","nzSize","nzAnimated","nzTabBarGutter","nzHideAdd","nzCentered","nzHideAll","nzLinkRouter","nzLinkExact","nzSelectedIndex","nzTabBarExtraContent"],outputs:["nzSelectChange","nzSelectedIndexChange","nzTabListScroll","nzClose","nzAdd"],exportAs:["nzTabset"]},{type:i.NgForOf,selector:"[ngFor][ngForOf]",inputs:["ngForOf","ngForTrackBy","ngForTemplate"]},{type:h.NzTabComponent,selector:"nz-tab",inputs:["nzTitle","nzClosable","nzCloseIcon","nzDisabled","nzForceRender"],outputs:["nzSelect","nzDeselect","nzClick","nzContextmenu"],exportAs:["nzTab"]},{type:v,selector:"[reuse-tab-context-menu]",inputs:["reuse-tab-context-menu","customContextMenu"],exportAs:["reuseTabContextMenu"]},{type:i.NgIf,selector:"[ngIf]",inputs:["ngIf","ngIfThen","ngIfElse"]},{type:p.NzIconDirective,selector:"[nz-icon]",inputs:["nzRotate","nzSpin","nzType","nzTheme","nzTwotoneColor","nzIconfont"],exportAs:["nzIcon"]},{type:y,selector:"reuse-tab-context",inputs:["i18n"],outputs:["change"]}],changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None}),m([c.InputBoolean(),x("design:type",Object)],I.prototype,"debug",void 0),m([c.InputNumber(),x("design:type",Number)],I.prototype,"max",void 0),m([c.InputNumber(),x("design:type",Number)],I.prototype,"tabMaxWidth",void 0),m([c.InputBoolean(),x("design:type",Object)],I.prototype,"allowClose",void 0),m([c.InputBoolean(),x("design:type",Object)],I.prototype,"keepingScroll",void 0),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(I,[{type:t.Component,args:[{selector:"reuse-tab, [reuse-tab]",exportAs:"reuseTab",templateUrl:"./reuse-tab.component.html",host:{"[class.reuse-tab]":"true","[class.reuse-tab__line]":"tabType === 'line'","[class.reuse-tab__card]":"tabType === 'card'"},providers:[b],preserveWhitespaces:!1,changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None}]}],(function(){return[{type:z},{type:t.ChangeDetectorRef},{type:l.Router},{type:l.ActivatedRoute},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[n.ALAIN_I18N_TOKEN]}]},{type:void 0,decorators:[{type:t.Inject,args:[i.DOCUMENT]}]}]}),{tabset:[{type:t.ViewChild,args:["tabset"]}],mode:[{type:t.Input}],i18n:[{type:t.Input}],debug:[{type:t.Input}],max:[{type:t.Input}],tabMaxWidth:[{type:t.Input}],excludes:[{type:t.Input}],allowClose:[{type:t.Input}],keepingScroll:[{type:t.Input}],keepingScrollContainer:[{type:t.Input}],customContextMenu:[{type:t.Input}],tabBarExtraContent:[{type:t.Input}],tabBarGutter:[{type:t.Input}],tabBarStyle:[{type:t.Input}],tabType:[{type:t.Input}],routeParamMatchMode:[{type:t.Input}],change:[{type:t.Output}],close:[{type:t.Output}]});var T=function(){function e(e){this.srv=e}return e.prototype.shouldDetach=function(e){return this.srv.shouldDetach(e)},e.prototype.store=function(e,t){this.srv.store(e,t)},e.prototype.shouldAttach=function(e){return this.srv.shouldAttach(e)},e.prototype.retrieve=function(e){return this.srv.retrieve(e)},e.prototype.shouldReuseRoute=function(e,t){return this.srv.shouldReuseRoute(e,t)},e}(),R=[I],S=[g,y,v],j=function(){};j.ɵmod=t.ɵɵdefineNgModule({type:j}),j.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||j)},imports:[[i.CommonModule,l.RouterModule,n.DelonLocaleModule,o.NzMenuModule,h.NzTabsModule,p.NzIconModule,s.OverlayModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(j,{declarations:[I,g,y,v],imports:[i.CommonModule,l.RouterModule,n.DelonLocaleModule,o.NzMenuModule,h.NzTabsModule,p.NzIconModule,s.OverlayModule],exports:[I]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(j,[{type:t.NgModule,args:[{imports:[i.CommonModule,l.RouterModule,n.DelonLocaleModule,o.NzMenuModule,h.NzTabsModule,p.NzIconModule,s.OverlayModule],declarations:M(R,S),exports:R}]}],null,null),e.ReuseTabComponent=I,e.ReuseTabContextComponent=y,e.ReuseTabContextDirective=v,e.ReuseTabContextMenuComponent=g,e.ReuseTabContextService=b,e.ReuseTabModule=j,e.ReuseTabService=z,e.ReuseTabStrategy=T,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=reuseTab.umd.min.js.map
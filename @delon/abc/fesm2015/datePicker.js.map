{"version":3,"file":"datePicker.js","sources":["../../../../packages/abc/date-picker/range.component.ts","../../../../packages/abc/date-picker/range.component.html","../../../../packages/abc/date-picker/date-picker.module.ts","../../../../packages/abc/date-picker/datePicker.ts"],"sourcesContent":["import { Component, EventEmitter, forwardRef, Input, Output, TemplateRef, ViewChild } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { AlainConfigService, AlainDateRangePickerShortcut, AlainDateRangePickerShortcutItem } from '@delon/util/config';\nimport { fixEndTimeOfRange, getTimeDistance } from '@delon/util/date-time';\nimport { InputBoolean } from '@delon/util/decorator';\nimport { deepMergeKey } from '@delon/util/other';\nimport { FunctionProp, NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { NzRangePickerComponent } from 'ng-zorro-antd/date-picker';\n\n@Component({\n  selector: 'range-picker',\n  exportAs: 'rangePicker',\n  templateUrl: './range.component.html',\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      multi: true,\n      useExisting: forwardRef(() => RangePickerComponent),\n    },\n  ],\n})\nexport class RangePickerComponent implements ControlValueAccessor {\n  private onChangeFn: (val: Date) => void;\n  private _shortcut: AlainDateRangePickerShortcut;\n  private defaultShortcuts: AlainDateRangePickerShortcut;\n  @ViewChild('comp', { static: false }) private comp: NzRangePickerComponent;\n  value: Date[] = [];\n\n  @Input() ngModelEnd: Date;\n  @Input()\n  set shortcut(val: AlainDateRangePickerShortcut | null) {\n    const item = deepMergeKey({}, true, this.defaultShortcuts, val == null ? {} : val) as AlainDateRangePickerShortcut;\n    if (typeof val === 'boolean') {\n      item.enabled = val;\n    }\n    (item.list || []).forEach(i => {\n      i._text = this.dom.bypassSecurityTrustHtml(i.text);\n    });\n    this._shortcut = item;\n  }\n  get shortcut(): AlainDateRangePickerShortcut | null {\n    return this._shortcut;\n  }\n  @Output() readonly ngModelEndChange = new EventEmitter<Date>();\n\n  // #region Native properties\n\n  @Input() nzAllowClear = true;\n  @Input() nzAutoFocus = false;\n  @Input() nzClassName: string;\n  @Input() nzDisabled: boolean;\n  @Input() nzSize: string;\n  @Input() nzStyle: string;\n  @Input() nzDisabledDate: (d: Date) => boolean;\n  @Input() nzLocale: object;\n  @Input() nzPopupStyle: object;\n  @Input() nzDropdownClassName: string;\n  @Input() nzPlaceHolder: string | string[];\n  @Output() readonly nzOnOpenChange = new EventEmitter<boolean>();\n\n  // range\n  @Input() nzDateRender: any;\n  @Input() nzFormat: any;\n  @Input() nzDisabledTime: any;\n  @Input() nzRenderExtraFooter: FunctionProp<TemplateRef<void> | string>;\n  @Input() nzShowTime: any;\n  @Input() @InputBoolean() nzShowToday: boolean = true;\n  @Input() nzMode: any;\n  @Input() nzRanges: any;\n  @Output() readonly nzOnPanelChange = new EventEmitter<any>();\n  @Output() readonly nzOnOk = new EventEmitter<any>();\n\n  // #endregion\n\n  constructor(private dom: DomSanitizer, configSrv: AlainConfigService) {\n    const cog = configSrv.merge('dataRange', {\n      nzFormat: 'yyyy-MM-dd',\n      nzAllowClear: true,\n      nzAutoFocus: false,\n      nzPopupStyle: { position: 'relative' },\n      nzShowToday: true,\n      shortcuts: {\n        enabled: false,\n        closed: true,\n        list: [\n          {\n            text: '今天',\n            fn: () => getTimeDistance('today'),\n          },\n          {\n            text: '昨天',\n            fn: () => getTimeDistance('yesterday'),\n          },\n          {\n            text: '近3天',\n            fn: () => getTimeDistance(-2),\n          },\n          {\n            text: '近7天',\n            fn: () => getTimeDistance(-6),\n          },\n          {\n            text: '本周',\n            fn: () => getTimeDistance('week'),\n          },\n          {\n            text: '本月',\n            fn: () => getTimeDistance('month'),\n          },\n          {\n            text: '全年',\n            fn: () => getTimeDistance('year'),\n          },\n        ],\n      },\n    })!;\n    this.defaultShortcuts = { ...cog.shortcuts } as AlainDateRangePickerShortcut;\n    Object.assign(this, cog);\n  }\n\n  _nzOnOpenChange(e: any): void {\n    this.nzOnOpenChange.emit(e);\n  }\n\n  _nzOnPanelChange(e: any): void {\n    this.nzOnPanelChange.emit(e);\n  }\n\n  _nzOnOk(e: any): void {\n    this.nzOnOk.emit(e);\n  }\n\n  valueChange(e: [Date, Date]): void {\n    e = fixEndTimeOfRange(e);\n    this.onChangeFn(e[0]);\n    this.ngModelEnd = e[1];\n    this.ngModelEndChange.emit(e[1]);\n  }\n\n  writeValue(value: Date): void {\n    this.value = value && this.ngModelEnd ? [value, this.ngModelEnd] : [];\n  }\n\n  registerOnChange(fn: (val: Date) => void): void {\n    this.onChangeFn = fn;\n  }\n\n  registerOnTouched(_fn: () => void): void {\n    // this.onTouchedFn = fn;\n  }\n\n  setDisabledState(disabled: boolean): void {\n    this.nzDisabled = disabled;\n  }\n\n  clickShortcut(item: AlainDateRangePickerShortcutItem): void {\n    this.value = item.fn(this.value as any);\n    this.valueChange(this.value as [Date, Date]);\n    if (this._shortcut.closed) {\n      // tslint:disable-next-line:no-string-literal\n      (this.comp as NzSafeAny)['picker'].hideOverlay();\n    }\n  }\n}\n","<nz-range-picker\n  #comp\n  [ngModel]=\"value\"\n  (ngModelChange)=\"valueChange($event)\"\n  [nzAllowClear]=\"nzAllowClear\"\n  [nzAutoFocus]=\"nzAutoFocus\"\n  [ngClass]=\"nzClassName\"\n  [nzDisabled]=\"nzDisabled\"\n  [nzSize]=\"nzSize\"\n  [nzDisabledDate]=\"nzDisabledDate\"\n  [nzLocale]=\"nzLocale\"\n  [nzPopupStyle]=\"nzPopupStyle\"\n  [nzDropdownClassName]=\"nzDropdownClassName\"\n  [ngStyle]=\"nzStyle\"\n  [nzPlaceHolder]=\"nzPlaceHolder\"\n  (nzOnOpenChange)=\"_nzOnOpenChange($event)\"\n  [nzDateRender]=\"nzDateRender\"\n  [nzDisabledTime]=\"nzDisabledTime\"\n  [nzFormat]=\"nzFormat\"\n  [nzRenderExtraFooter]=\"nzRenderExtraFooter || (shortcut?.enabled ? shortcutTpl : null)\"\n  [nzShowTime]=\"nzShowTime\"\n  [nzShowToday]=\"nzShowToday\"\n  [nzMode]=\"nzMode\"\n  [nzRanges]=\"nzRanges\"\n  (nzOnPanelChange)=\"_nzOnPanelChange($event)\"\n  (nzOnOk)=\"_nzOnOk($event)\"\n></nz-range-picker>\n<ng-template #shortcutTpl>\n  <a *ngFor=\"let i of shortcut?.list; let first = first\" (click)=\"clickShortcut(i)\" [innerHTML]=\"i._text\" [ngClass]=\"{ 'ml-sm': !first }\"></a>\n</ng-template>\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { NzDatePickerModule } from 'ng-zorro-antd/date-picker';\n\nimport { RangePickerComponent } from './range.component';\n\nconst COMPONENTS = [RangePickerComponent];\n\n@NgModule({\n  imports: [CommonModule, FormsModule, NzDatePickerModule],\n  declarations: COMPONENTS,\n  exports: COMPONENTS,\n})\nexport class DatePickerModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}
{"version":3,"file":"image.js.map","sources":["ng://@delon/abc/image/image.config.ts","ng://@delon/abc/image/image.directive.ts","ng://@delon/abc/image/image.module.ts"],"sourcesContent":["export class ImageConfig {\r\n  /**\r\n   * é»è®¤å¤§å°ï¼é»è®¤å¼ï¼`64`ï¼åä½ï¼px\r\n   */\r\n  size?: number = 64;\r\n\r\n  /**\r\n   * éè¯¯å¾ç\r\n   */\r\n  error?: string = './assets/img/logo.svg';\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  OnChanges,\r\n  ElementRef,\r\n  Renderer2,\r\n  SimpleChanges,\r\n  OnInit,\r\n  SimpleChange,\r\n} from '@angular/core';\r\nimport { deepCopy, InputNumber } from '@delon/util';\r\n\r\nimport { ImageConfig } from './image.config';\r\n\r\n/**\r\n * imgæ ç­¾\r\n * + æ¯æå¾®ä¿¡ãqqå¤´åè§åç¼©ç¥å¾è§å\r\n * + æ¯æç§»é¤http&httpsåè®®http\r\n * + æ¯æå¢å onerroräºä»¶\r\n */\r\n@Directive({ selector: '[_src]' })\r\nexport class ImageDirective implements OnChanges, OnInit {\r\n  @Input('_src') src: string;\r\n\r\n  @Input() @InputNumber() size = 64;\r\n\r\n  @Input() error = './assets/img/logo.svg';\r\n\r\n  private inited = false;\r\n\r\n  constructor(\r\n    private el: ElementRef,\r\n    private render: Renderer2,\r\n    DEF: ImageConfig,\r\n  ) {\r\n    Object.assign(this, deepCopy(DEF));\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.update();\r\n    this.updateError();\r\n    this.inited = true;\r\n  }\r\n\r\n  ngOnChanges(\r\n    changes: { [P in keyof this]?: SimpleChange } & SimpleChanges,\r\n  ): void {\r\n    if (this.inited) {\r\n      if (changes.error) {\r\n        this.updateError();\r\n      } else {\r\n        this.update();\r\n      }\r\n    }\r\n  }\r\n\r\n  private update() {\r\n    let newSrc = this.src;\r\n\r\n    if (newSrc.includes('qlogo.cn')) {\r\n      const arr = newSrc.split('/'),\r\n        size = arr[arr.length - 1];\r\n      arr[arr.length - 1] =\r\n        size === '0' || +size !== this.size ? this.size.toString() : size;\r\n      newSrc = arr.join('/');\r\n    }\r\n\r\n    const isHttp = newSrc.startsWith('http:'),\r\n      isHttps = newSrc.startsWith('https:');\r\n    if (isHttp || isHttps) newSrc = newSrc.substr(isHttp ? 5 : 6);\r\n\r\n    this.render.setAttribute(this.el.nativeElement, 'src', newSrc);\r\n  }\r\n\r\n  private updateError() {\r\n    this.render.setAttribute(\r\n      this.el.nativeElement,\r\n      'onerror',\r\n      `this.src='${this.error}';`,\r\n    );\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { DelonUtilModule } from '@delon/util';\r\n\r\nimport { ImageDirective } from './image.directive';\r\nimport { ImageConfig } from './image.config';\r\n\r\nconst DIRECTIVES = [ImageDirective];\r\n\r\n@NgModule({\r\n  imports: [CommonModule, DelonUtilModule],\r\n  declarations: [...DIRECTIVES],\r\n  exports: [...DIRECTIVES],\r\n})\r\nexport class ImageModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return { ngModule: ImageModule, providers: [ImageConfig] };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;AAAA;;;;;oBAIkB,EAAE;;;;qBAKD,uBAAuB;;CACzC;;;;;;;;;;;;ACWD;;;;;;IASE,YACU,IACA,QACR,GAAgB;QAFR,OAAE,GAAF,EAAE;QACF,WAAM,GAAN,MAAM;oBARe,EAAE;qBAEhB,uBAAuB;sBAEvB,KAAK;QAOpB,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;KACpC;;;;IAED,QAAQ;QACN,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;KACpB;;;;;IAED,WAAW,CACT,OAA6D;QAE7D,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,IAAI,OAAO,CAAC,KAAK,EAAE;gBACjB,IAAI,CAAC,WAAW,EAAE,CAAC;aACpB;iBAAM;gBACL,IAAI,CAAC,MAAM,EAAE,CAAC;aACf;SACF;KACF;;;;IAEO,MAAM;;QACZ,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC;QAEtB,IAAI,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;;YAC/B,MAAM,GAAG,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CACA;;YAD7B,MACE,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YAC7B,GAAG,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC;gBACjB,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC;YACpE,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACxB;;QAED,MAAM,MAAM,GAAG,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CACD;;QADxC,MACE,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QACxC,IAAI,MAAM,IAAI,OAAO;YAAE,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QAE9D,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;;;;;IAGzD,WAAW;QACjB,IAAI,CAAC,MAAM,CAAC,YAAY,CACtB,IAAI,CAAC,EAAE,CAAC,aAAa,EACrB,SAAS,EACT,aAAa,IAAI,CAAC,KAAK,IAAI,CAC5B,CAAC;;;;YA3DL,SAAS,SAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE;;;;YAhB/B,UAAU;YACV,SAAS;YAOF,WAAW;;;kBAUjB,KAAK,SAAC,MAAM;mBAEZ,KAAK;oBAEL,KAAK;;;IAFI,WAAW,EAAE;;;;;;;;ACxBzB;AAOA,MAAM,UAAU,GAAG,CAAC,cAAc,CAAC,CAAC;AAOpC;;;;IACE,OAAO,OAAO;QACZ,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,SAAS,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC;KAC5D;;;YARF,QAAQ,SAAC;gBACR,OAAO,EAAE,CAAC,YAAY,EAAE,eAAe,CAAC;gBACxC,YAAY,EAAE,CAAC,GAAG,UAAU,CAAC;gBAC7B,OAAO,EAAE,CAAC,GAAG,UAAU,CAAC;aACzB;;;;;;;;;;;;;;;"}

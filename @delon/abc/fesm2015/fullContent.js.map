{"version":3,"file":"fullContent.js.map","sources":["ng://@delon/abc/full-content/full-content.service.ts","ng://@delon/abc/full-content/full-content.component.ts","ng://@delon/abc/full-content/full-content-toggle.directive.ts","ng://@delon/abc/full-content/full-content.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Observable, BehaviorSubject } from 'rxjs';\r\nimport { share } from 'rxjs/operators';\r\n\r\n@Injectable()\r\nexport class FullContentService {\r\n  private _change: BehaviorSubject<any> = new BehaviorSubject<any>(null);\r\n\r\n  /** åæ¢å¨å±å·¥ä½åºç¶æ */\r\n  toggle() {\r\n    this._change.next(true);\r\n  }\r\n\r\n  get change(): Observable<boolean> {\r\n    return this._change.pipe(share());\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  ElementRef,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnChanges,\r\n  OnInit,\r\n  Inject,\r\n  HostBinding,\r\n  OnDestroy,\r\n  AfterViewInit,\r\n} from '@angular/core';\r\nimport { DOCUMENT } from '@angular/common';\r\nimport { Router, ActivationStart, ActivationEnd } from '@angular/router';\r\nimport { Subscription, fromEvent } from 'rxjs';\r\nimport { debounceTime, filter } from 'rxjs/operators';\r\nimport { InputBoolean, InputNumber } from '@delon/util';\r\n\r\nimport { FullContentService } from './full-content.service';\r\n\r\nconst wrapCls = `full-content__body`;\r\nconst openedCls = `full-content__opened`;\r\nconst hideTitleCls = `full-content__hidden-title`;\r\n\r\n@Component({\r\n  selector: 'full-content',\r\n  template: `<ng-content></ng-content>`,\r\n  host: { '[class.full-content]': 'true' },\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class FullContentComponent\r\n  implements AfterViewInit, OnInit, OnChanges, OnDestroy {\r\n  private bodyEl: HTMLElement;\r\n  private inited = false;\r\n  private srv$: Subscription;\r\n  private route$: Subscription;\r\n  private id = `_full-content-${Math.random()\r\n    .toString(36)\r\n    .substring(2)}`;\r\n  private scroll$: Subscription = null;\r\n\r\n  @HostBinding('style.height.px')\r\n  _height = 0;\r\n\r\n  // #region fields\r\n\r\n  @Input()\r\n  @InputBoolean()\r\n  fullscreen: boolean;\r\n\r\n  @Input()\r\n  @InputBoolean()\r\n  hideTitle = true;\r\n\r\n  @Input()\r\n  @InputNumber()\r\n  padding = 24;\r\n\r\n  @Output()\r\n  fullscreenChange: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  // #endregion\r\n\r\n  constructor(\r\n    private el: ElementRef,\r\n    private cd: ChangeDetectorRef,\r\n    private srv: FullContentService,\r\n    private router: Router,\r\n    @Inject(DOCUMENT) private doc: any,\r\n  ) {}\r\n\r\n  private updateCls() {\r\n    const clss = this.bodyEl.classList;\r\n    if (this.fullscreen) {\r\n      clss.add(openedCls);\r\n      if (this.hideTitle) {\r\n        clss.add(hideTitleCls);\r\n      }\r\n    } else {\r\n      clss.remove(openedCls);\r\n      if (this.hideTitle) {\r\n        clss.remove(hideTitleCls);\r\n      }\r\n    }\r\n  }\r\n\r\n  private update() {\r\n    this.updateCls();\r\n    this.updateHeight();\r\n    this.fullscreenChange.emit(this.fullscreen);\r\n  }\r\n\r\n  private updateHeight() {\r\n    this._height =\r\n      this.bodyEl.getBoundingClientRect().height -\r\n      (this.el.nativeElement as HTMLElement).getBoundingClientRect().top -\r\n      this.padding;\r\n    this.cd.detectChanges();\r\n  }\r\n\r\n  private removeInBody() {\r\n    this.bodyEl.classList.remove(wrapCls, openedCls, hideTitleCls);\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.inited = true;\r\n    this.bodyEl = this.doc.querySelector('body');\r\n    this.bodyEl.classList.add(wrapCls);\r\n    (this.el.nativeElement as HTMLElement).id = this.id;\r\n\r\n    this.updateCls();\r\n\r\n    // when window resize\r\n    this.scroll$ = fromEvent(window, 'resize')\r\n      .pipe(debounceTime(200))\r\n      .subscribe(() => this.updateHeight());\r\n\r\n    // when servier changed\r\n    this.srv$ = this.srv.change\r\n      .pipe(filter(res => res !== null))\r\n      .subscribe(() => this.toggle());\r\n\r\n    // when router changed\r\n    this.route$ = this.router.events\r\n      .pipe(\r\n        filter(\r\n          (e: any) =>\r\n            e instanceof ActivationStart || e instanceof ActivationEnd,\r\n        ),\r\n        debounceTime(200),\r\n      )\r\n      .subscribe(e => {\r\n        if (!!this.doc.querySelector('#' + this.id)) {\r\n          this.bodyEl.classList.add(wrapCls);\r\n          this.updateCls();\r\n        } else {\r\n          this.removeInBody();\r\n        }\r\n      });\r\n  }\r\n\r\n  toggle() {\r\n    this.fullscreen = !this.fullscreen;\r\n    this.update();\r\n    this.updateHeight();\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    setTimeout(() => this.updateHeight());\r\n  }\r\n\r\n  ngOnChanges(): void {\r\n    if (this.inited) this.update();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.removeInBody();\r\n    this.scroll$.unsubscribe();\r\n    this.srv$.unsubscribe();\r\n    this.route$.unsubscribe();\r\n  }\r\n}\r\n","import { Directive, HostListener } from '@angular/core';\r\nimport { FullContentComponent } from './full-content.component';\r\n\r\n@Directive({\r\n  selector: '[full-toggle]',\r\n})\r\nexport class FullContentToggleDirective {\r\n  constructor(private parent: FullContentComponent) {}\r\n\r\n  @HostListener('click')\r\n  _click() {\r\n    this.parent.toggle();\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { DelonUtilModule } from '@delon/util';\r\n\r\nimport { FullContentComponent } from './full-content.component';\r\nimport { FullContentToggleDirective } from './full-content-toggle.directive';\r\nimport { FullContentService } from './full-content.service';\r\n\r\nconst COMPONENTS = [FullContentComponent, FullContentToggleDirective];\r\n\r\n@NgModule({\r\n  imports: [CommonModule, DelonUtilModule],\r\n  declarations: [...COMPONENTS],\r\n  exports: [...COMPONENTS],\r\n})\r\nexport class FullContentModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: FullContentModule,\r\n      providers: [FullContentService],\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}

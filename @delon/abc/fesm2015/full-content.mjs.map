{"version":3,"file":"full-content.mjs","sources":["../../../../packages/abc/full-content/full-content.service.ts","../../../../packages/abc/full-content/full-content.component.ts","../../../../packages/abc/full-content/full-content-toggle.directive.ts","../../../../packages/abc/full-content/full-content.module.ts","../../../../packages/abc/full-content/full-content.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { share } from 'rxjs/operators';\n\n@Injectable({ providedIn: 'root' })\nexport class FullContentService {\n  private _change = new BehaviorSubject<boolean | null>(null);\n\n  /** 切换全屏工作区状态 */\n  toggle(): void {\n    this._change.next(true);\n  }\n\n  get change(): Observable<boolean | null> {\n    return this._change.pipe(share());\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Inject,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewEncapsulation\n} from '@angular/core';\nimport { ActivationEnd, ActivationStart, Event, Router } from '@angular/router';\nimport { fromEvent, Subject } from 'rxjs';\nimport { debounceTime, filter, takeUntil } from 'rxjs/operators';\n\nimport { BooleanInput, InputBoolean, InputNumber, NumberInput } from '@delon/util/decorator';\nimport type { NzSafeAny } from 'ng-zorro-antd/core/types';\n\nimport { FullContentService } from './full-content.service';\n\nconst wrapCls = `full-content__body`;\nconst openedCls = `full-content__opened`;\nconst hideTitleCls = `full-content__hidden-title`;\n\n@Component({\n  selector: 'full-content',\n  exportAs: 'fullContent',\n  template: ` <ng-content></ng-content> `,\n  host: {\n    '[class.full-content]': 'true',\n    '[style.height.px]': '_height'\n  },\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class FullContentComponent implements AfterViewInit, OnInit, OnChanges, OnDestroy {\n  static ngAcceptInputType_fullscreen: BooleanInput;\n  static ngAcceptInputType_hideTitle: BooleanInput;\n  static ngAcceptInputType_padding: NumberInput;\n\n  private bodyEl!: HTMLElement;\n  private inited = false;\n  private id = `_full-content-${Math.random().toString(36).substring(2)}`;\n  private destroy$ = new Subject<void>();\n\n  _height = 0;\n\n  @Input() @InputBoolean() fullscreen?: boolean;\n  @Input() @InputBoolean() hideTitle = true;\n  @Input() @InputNumber() padding = 24;\n  @Output() readonly fullscreenChange = new EventEmitter<boolean>();\n\n  constructor(\n    private el: ElementRef<HTMLElement>,\n    private cdr: ChangeDetectorRef,\n    private srv: FullContentService,\n    private router: Router,\n    @Inject(DOCUMENT) private doc: NzSafeAny\n  ) {}\n\n  private updateCls(): void {\n    const clss = this.bodyEl.classList;\n    if (this.fullscreen) {\n      clss.add(openedCls);\n      if (this.hideTitle) {\n        clss.add(hideTitleCls);\n      }\n    } else {\n      clss.remove(openedCls);\n      if (this.hideTitle) {\n        clss.remove(hideTitleCls);\n      }\n    }\n  }\n\n  private update(): void {\n    this.updateCls();\n    this.updateHeight();\n    this.fullscreenChange.emit(this.fullscreen);\n  }\n\n  private updateHeight(): void {\n    this._height =\n      this.bodyEl.getBoundingClientRect().height - this.el.nativeElement.getBoundingClientRect().top - this.padding;\n    this.cdr.detectChanges();\n  }\n\n  private removeInBody(): void {\n    this.bodyEl.classList.remove(wrapCls, openedCls, hideTitleCls);\n  }\n\n  ngOnInit(): void {\n    this.inited = true;\n    this.bodyEl = this.doc.querySelector('body');\n    this.bodyEl.classList.add(wrapCls);\n    this.el.nativeElement.id = this.id;\n\n    this.updateCls();\n\n    // when window resize\n    fromEvent(window, 'resize')\n      .pipe(takeUntil(this.destroy$), debounceTime(200))\n      .subscribe(() => this.updateHeight());\n\n    // when servier changed\n    this.srv.change\n      .pipe(\n        takeUntil(this.destroy$),\n        filter(res => res !== null)\n      )\n      .subscribe(() => this.toggle());\n\n    // when router changed\n    this.router.events\n      .pipe(\n        takeUntil(this.destroy$),\n        filter((e: Event) => e instanceof ActivationStart || e instanceof ActivationEnd),\n        debounceTime(200)\n      )\n      .subscribe(() => {\n        if (!!this.doc.querySelector(`#${this.id}`)) {\n          this.bodyEl.classList.add(wrapCls);\n          this.updateCls();\n        } else {\n          this.removeInBody();\n        }\n      });\n  }\n\n  toggle(): void {\n    this.fullscreen = !this.fullscreen;\n    this.update();\n    this.updateHeight();\n  }\n\n  ngAfterViewInit(): void {\n    setTimeout(() => this.updateHeight());\n  }\n\n  ngOnChanges(): void {\n    if (this.inited) this.update();\n  }\n\n  ngOnDestroy(): void {\n    this.removeInBody();\n    const { destroy$ } = this;\n    destroy$.next();\n    destroy$.complete();\n  }\n}\n","import { Directive } from '@angular/core';\n\nimport { FullContentComponent } from './full-content.component';\n\n@Directive({\n  selector: '[full-toggle]',\n  exportAs: 'fullToggle',\n  host: {\n    '(click)': '_click()'\n  }\n})\nexport class FullContentToggleDirective {\n  constructor(private parent: FullContentComponent) {}\n\n  _click(): void {\n    this.parent.toggle();\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\n\nimport { FullContentToggleDirective } from './full-content-toggle.directive';\nimport { FullContentComponent } from './full-content.component';\n\nconst COMPONENTS = [FullContentComponent, FullContentToggleDirective];\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: COMPONENTS,\n  exports: COMPONENTS\n})\nexport class FullContentModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["i1.FullContentComponent"],"mappings":"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"}
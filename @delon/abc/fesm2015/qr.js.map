{"version":3,"file":"qr.js","sources":["ng://@delon/abc/qr/qr.config.ts","ng://@delon/abc/qr/qr.service.ts","ng://@delon/abc/qr/qr.component.ts","ng://@delon/abc/qr/qr.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({ providedIn: 'root' })\nexport class QRConfig {\n  /** 背景，默认：`white` */\n  background = 'white';\n  /** 背景透明级别，范围：`0-1` 之间，默认：`1.0` */\n  backgroundAlpha = 1;\n  /** 前景，默认：`black` */\n  foreground = 'black';\n  /** 前景透明级别，范围：`0-1` 之间，默认：`1.0` */\n  foregroundAlpha = 1;\n  /** 误差校正级别，默认：`L` */\n  level: 'L' | 'M' | 'Q' | 'H' = 'L';\n  /** 二维码输出图片MIME类型，默认：`image/png` */\n  mime = 'image/png';\n  /** 内边距（单位：px），默认：`10` */\n  padding = 10;\n  /** 大小（单位：px），默认：`220` */\n  size = 220;\n}\n","import { Injectable } from '@angular/core';\nimport { QRConfig } from './qr.config';\n\ndeclare var QRious: any;\n\n@Injectable({ providedIn: 'root' })\nexport class QRService {\n  /** 当前qr实例 */\n  readonly qr: any;\n  /** 背景 */\n  background: string;\n  /** 背景透明级别，范围：`0-1` 之间 */\n  backgroundAlpha = 1;\n  /** 前景 */\n  foreground: string;\n  /** 前景透明级别，范围：`0-1` 之间 */\n  foregroundAlpha: number;\n  /** 误差校正级别 */\n  level: string;\n  /** 二维码输出图片MIME类型 */\n  mime: string;\n  /** 内边距（单位：px） */\n  padding: number;\n  /** 大小（单位：px） */\n  size: number;\n  /** 值 */\n  value: string;\n\n  constructor(cog: QRConfig) {\n    Object.assign(this, cog);\n    this.qr = new QRious();\n  }\n\n  /**\n   * 生成二维码，并返回Base64编码\n   *\n   * @param [value] 重新指定值\n   */\n  refresh(value?: string | {}): string {\n    const option: any =\n      typeof value === 'object'\n        ? value\n        : {\n            background: this.background,\n            backgroundAlpha: this.backgroundAlpha,\n            foreground: this.foreground,\n            foregroundAlpha: this.foregroundAlpha,\n            level: this.level,\n            padding: this.padding,\n            size: this.size,\n            value: value || this.value,\n          };\n    option.value = this.toUtf8ByteArray(option.value);\n    this.qr.set(option);\n    return this.dataURL;\n  }\n\n  private toUtf8ByteArray(str: string): string {\n    str = encodeURI(str);\n    const result: number[] = [];\n    for (let i = 0; i < str.length; i++) {\n      if (str.charAt(i) !== '%') {\n        result.push(str.charCodeAt(i));\n      } else {\n        result.push(parseInt(str.substr(i + 1, 2), 16));\n        i += 2;\n      }\n    }\n    return result.map(v => String.fromCharCode(v)).join('');\n  }\n\n  /**\n   * 返回当前二维码Base64编码\n   */\n  get dataURL(): string {\n    return this.qr.toDataURL();\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  OnChanges,\n  Output,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { InputNumber } from '@delon/util';\nimport { QRConfig } from './qr.config';\nimport { QRService } from './qr.service';\n\n@Component({\n  selector: 'qr',\n  exportAs: 'qr',\n  template: ` <img class=\"qr__img\" src=\"{{ dataURL }}\" /> `,\n  host: {\n    '[class.qr]': 'true',\n    '[style.height.px]': 'size',\n    '[style.width.px]': 'size',\n  },\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class QRComponent implements OnChanges {\n  dataURL: string;\n\n  // #region fields\n\n  @Input() background: string;\n  @Input() backgroundAlpha: number;\n  @Input() foreground: string;\n  @Input() foregroundAlpha: number;\n  @Input() level: string;\n  @Input() mime: string;\n  @Input() @InputNumber() padding: number;\n  @Input() @InputNumber() size: number;\n  @Input() value: string;\n  @Output() readonly change = new EventEmitter<string>();\n\n  // #endregion\n\n  constructor(cog: QRConfig, private srv: QRService, private cdr: ChangeDetectorRef) {\n    Object.assign(this, { ...new QRConfig(), ...cog });\n  }\n\n  ngOnChanges(): void {\n    this.dataURL = this.srv.refresh({\n      background: this.background,\n      backgroundAlpha: this.backgroundAlpha,\n      foreground: this.foreground,\n      foregroundAlpha: this.foregroundAlpha,\n      level: this.level,\n      mime: this.mime,\n      padding: this.padding,\n      size: this.size,\n      value: this.value,\n    });\n    this.cdr.detectChanges();\n    this.change.emit(this.dataURL);\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { DelonUtilModule } from '@delon/util';\nimport { QRComponent } from './qr.component';\n\nconst COMPONENTS = [QRComponent];\n\n@NgModule({\n  imports: [CommonModule, DelonUtilModule],\n  declarations: [...COMPONENTS],\n  exports: [...COMPONENTS],\n})\nexport class QRModule {}\n"],"names":[],"mappings":"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"}
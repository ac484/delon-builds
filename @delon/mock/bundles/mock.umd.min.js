/**
 * @license ng-alain(cipchk@qq.com) v2.0.0-rc.2-ff4991a
 * (c) 2018 Cipchk https://ng-alain.com/
 * License: MIT
 */
!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@delon/mock",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators"],e):e((r.delon=r.delon||{},r.delon.mock={}),r.ng.core,r.ng.common.http,r.rxjs,r.rxjs.operators)}(this,function(r,t,p,f,h){"use strict";var d=function n(r,e){this.status=r,this.error=e},g=function c(){this.delay=300,this.force=!1,this.log=!0},y=function(){function r(r){this.config=r,this.cached=[],this.applyMock(),delete this.config.data}return r.prototype.applyMock=function(){this.cached=[];try{this.realApplyMock()}catch(r){this.outputError(r)}},r.prototype.realApplyMock=function(){var a=this,r=this.config.data;r&&(Object.keys(r).forEach(function(n){var c=r[n];c&&Object.keys(c).forEach(function(r){var e=c[r];if("function"!=typeof e&&"object"!=typeof e&&"string"!=typeof e)throw Error("mock value of ["+n+"-"+r+"] should be function or object or string, but got "+typeof e);var t=a.genRule(r,e);if(-1===["GET","POST","PUT","HEAD","DELETE","PATCH","OPTIONS"].indexOf(t.method))throw Error("method of "+n+"-"+r+" is not valid");var o=a.cached.find(function(r){return r.url===t.url&&r.method===t.method});o?o.callback=t.callback:a.cached.push(t)})}),this.cached.sort(function(r,e){return(e.martcher||"").toString().length-(r.martcher||"").toString().length}))},r.prototype.genRule=function(r,e){var t="GET",o=r;if(-1<r.indexOf(" ")){var n=r.split(" ");t=n[0].toLowerCase(),o=n[1]}var c=null,a=[];if(~o.indexOf(":")){a=o.split("/").filter(function(r){return r.startsWith(":")}).map(function(r){return r.substring(1)});var i=o.split("/").map(function(r){return r.startsWith(":")?"([^/]+)":r}).join("/");c=new RegExp(i,"i")}else/(\([^)]+\))/i.test(o)&&(c=new RegExp(o,"i"));return{url:o,martcher:c,segments:a,callback:e,method:t.toUpperCase()}},r.prototype.outputError=function(r){var e=r.message.split(": ")[0],t=r.stack.split("\n").filter(function(r){return 0!==r.trim().indexOf("at ")}).map(function(r){return r.replace(e+": ","")});throw t.splice(1,0,[""]),console.group(),console.warn("==========Failed to parse mock config.=========="),console.log(t.join("\n")),console.groupEnd(),r},r.prototype.getRule=function(e,t){e=(e||"GET").toUpperCase();var o={},r=this.cached.filter(function(r){return r.method===e&&(r.martcher?r.martcher.test(t):r.url===t)});if(0===r.length)return null;var n=r.find(function(r){return r.url===t})||r[0];n.martcher&&n.martcher.exec(t).slice(1).map(function(r,e){o[n.segments[e]]=r});return{url:t,method:n.method,params:o,callback:n.callback}},r.prototype.clearCache=function(){this.cached=[]},Object.defineProperty(r.prototype,"rules",{get:function(){return this.cached},enumerable:!0,configurable:!0}),r.prototype.ngOnDestroy=function(){this.clearCache()},r.decorators=[{type:t.Injectable}],r.ctorParameters=function(){return[{type:g}]},r}(),o=function(){function r(r){this.injector=r}return r.prototype.intercept=function(e,r){var t,o=this.injector.get(y),n=Object.assign({delay:300,force:!1,log:!0},this.injector.get(g,null)),c=o.getRule(e.method,e.url.split("?")[0]);if(!c&&!n.force)return r.handle(e);switch(typeof c.callback){case"function":var a={original:e,body:e.body,queryString:{},headers:{},params:c.params},i=e.url.split("?");1<i.length&&i[1].split("&").forEach(function(r){var e=r.split("="),t=e[0],o=e[1];Object.keys(a.queryString).includes(t)?(Array.isArray(a.queryString[t])||(a.queryString[t]=[a.queryString[t]]),a.queryString[t].push(o)):a.queryString[t]=o}),e.params.keys().forEach(function(r){return a.queryString[r]=e.params.get(r)}),e.headers.keys().forEach(function(r){return a.headers[r]=e.headers.get(r)});try{t=c.callback.call(this,a)}catch(l){var u=void 0;return l instanceof d?(u=new p.HttpErrorResponse({url:e.url,headers:e.headers,status:l.status,statusText:l.statusText||"Unknown Error",error:l.error}),n.log&&console.log("%c ðŸ‘½MOCK "+l.status+" STATUS ","background:#000;color:#bada55",e.url,u,e)):console.error("Please use MockStatusError to throw status error",l,e),new f.Observable(function(r){r.error(u)})}break;default:t=c.callback}var s=new p.HttpResponse({status:200,body:t,url:e.url});return n.log&&console.log("%c ðŸ‘½MOCK ","background:#000;color:#bada55",e.url,s,e),f.of(s).pipe(h.delay(n.delay))},r.decorators=[{type:t.Injectable}],r.ctorParameters=function(){return[{type:t.Injector}]},r}(),e=function(){function e(){}return e.forRoot=function(r){return{ngModule:e,providers:[y,{provide:g,useValue:r},{provide:p.HTTP_INTERCEPTORS,useClass:o,multi:!0}]}},e.forChild=function(){return{ngModule:e,providers:[{provide:p.HTTP_INTERCEPTORS,useClass:o,multi:!0}]}},e.decorators=[{type:t.NgModule,args:[{}]}],e}();r.MockStatusError=d,r.MockService=y,r.MockInterceptor=o,r.DelonMockConfig=g,r.DelonMockModule=e,Object.defineProperty(r,"__esModule",{value:!0})});
//# sourceMappingURL=mock.umd.min.js.map
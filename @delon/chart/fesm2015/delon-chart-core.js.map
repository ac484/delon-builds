{"version":3,"file":"delon-chart-core.js","sources":["../../../../packages/chart/core/g2.servicce.ts","../../../../packages/chart/core/g2.base.component.ts"],"sourcesContent":["import { Injectable, OnDestroy } from '@angular/core';\nimport { AlainChartConfig, AlainConfigService } from '@delon/util/config';\nimport { LazyService } from '@delon/util/other';\nimport { Observable, Subject } from 'rxjs';\n\n@Injectable({ providedIn: 'root' })\nexport class G2Service implements OnDestroy {\n  private _cog: AlainChartConfig;\n  private loading = false;\n  private loaded = false;\n  private notify$ = new Subject<void>();\n\n  get cog(): AlainChartConfig {\n    return this._cog;\n  }\n  set cog(val: AlainChartConfig) {\n    this._cog = this.cogSrv.merge(\n      'chart',\n      {\n        theme: '',\n        libs: [\n          'https://gw.alipayobjects.com/os/lib/antv/g2/4.1.4/dist/g2.min.js',\n          'https://gw.alipayobjects.com/os/lib/antv/data-set/0.11.7/dist/data-set.js',\n        ],\n      } as AlainChartConfig,\n      val,\n    )!;\n  }\n\n  constructor(private cogSrv: AlainConfigService, private lazySrv: LazyService) {\n    this.cog = { theme: '' };\n  }\n\n  libLoad(): this {\n    if (this.loading) {\n      if (this.loaded) {\n        this.notify$.next();\n      }\n      return this;\n    }\n    this.loading = true;\n    this.lazySrv.load(this.cog.libs!).then(() => {\n      this.loaded = true;\n      this.notify$.next();\n    });\n    return this;\n  }\n\n  get notify(): Observable<void> {\n    return this.notify$.asObservable();\n  }\n\n  ngOnDestroy(): void {\n    this.notify$.unsubscribe();\n  }\n}\n","import { Platform } from '@angular/cdk/platform';\nimport { ChangeDetectorRef, Directive, ElementRef, Input, NgZone, OnChanges, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { Chart, Types } from '@antv/g2';\nimport { InputNumber, NumberInput } from '@delon/util/other';\nimport { Subject, Subscription } from 'rxjs';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { G2Service } from './g2.servicce';\n\n@Directive()\nexport abstract class G2BaseComponent implements OnInit, OnChanges, OnDestroy {\n  static ngAcceptInputType_delay: NumberInput;\n\n  @ViewChild('container', { static: true }) protected node: ElementRef;\n  protected resize$: Subscription;\n  protected destroy$ = new Subject<void>();\n  protected _chart: Chart;\n  loaded = false;\n\n  @Input() @InputNumber() delay = 0;\n  @Input() theme: string | Types.LooseObject;\n\n  get chart(): Chart {\n    return this._chart;\n  }\n\n  abstract install(): void;\n\n  abstract attachChart(): void;\n\n  onInit(): void {}\n\n  onChanges(): void {}\n\n  constructor(\n    protected srv: G2Service,\n    protected el: ElementRef<HTMLElement>,\n    protected ngZone: NgZone,\n    protected platform: Platform,\n    protected cdr: ChangeDetectorRef,\n  ) {\n    this.theme = srv.cog.theme!;\n    this.srv.notify\n      .pipe(\n        takeUntil(this.destroy$),\n        filter(() => !this.loaded),\n      )\n      .subscribe(() => this.load());\n  }\n\n  private load(): void {\n    this.ngZone.run(() => {\n      this.loaded = true;\n      this.cdr.detectChanges();\n    });\n    this.ngZone.runOutsideAngular(() => setTimeout(() => this.install(), this.delay));\n  }\n\n  ngOnInit(): void {\n    if (!this.platform.isBrowser) {\n      return;\n    }\n    this.onInit();\n    if ((window as any).G2) {\n      this.load();\n    } else {\n      this.srv.libLoad();\n    }\n  }\n\n  ngOnChanges(): void {\n    this.onChanges();\n    this.ngZone.runOutsideAngular(() => this.attachChart());\n  }\n\n  ngOnDestroy(): void {\n    if (this.resize$) {\n      this.resize$.unsubscribe();\n    }\n    this.destroy$.next();\n    this.destroy$.complete();\n    if (this._chart) {\n      this.ngZone.runOutsideAngular(() => this._chart.destroy());\n    }\n  }\n}\n"],"names":[],"mappings":"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"}
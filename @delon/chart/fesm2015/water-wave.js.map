{"version":3,"file":"water-wave.js.map","sources":["ng://@delon/chart/water-wave/water-wave.component.ts","ng://@delon/chart/water-wave/water-wave.module.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  Input,\n  NgZone,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Renderer2,\n  TemplateRef,\n  ViewChild,\n} from '@angular/core';\nimport { InputNumber } from '@delon/util';\nimport { fromEvent, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\n@Component({\n  selector: 'g2-water-wave',\n  templateUrl: './water-wave.component.html',\n  host: { '[class.g2-water-wave]': 'true' },\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class G2WaterWaveComponent implements OnDestroy, OnChanges, OnInit {\n  // #region fields\n\n  _title = '';\n  _titleTpl: TemplateRef<void>;\n  @Input()\n  set title(value: string | TemplateRef<void>) {\n    if (value instanceof TemplateRef) {\n      this._title = null;\n      this._titleTpl = value;\n    } else {\n      this._title = value;\n    }\n  }\n\n  @Input()\n  color = '#1890FF';\n\n  @Input() @InputNumber() height = 160;\n\n  @Input() @InputNumber() percent: number;\n\n  // #endregion\n\n  private resize$: Subscription = null;\n  @ViewChild('container')\n  private node: ElementRef;\n\n  private initFlag = false;\n  private timer;\n\n  constructor(\n    private el: ElementRef,\n    private renderer: Renderer2,\n    private cd: ChangeDetectorRef,\n    private zone: NgZone,\n  ) { }\n\n  private renderChart() {\n    const data = this.percent / 100;\n    if (!data) return;\n\n    this.node.nativeElement.innerHTML = '';\n    const self = this;\n\n    const canvas = this.node.nativeElement as HTMLCanvasElement;\n    const ctx = canvas.getContext('2d');\n\n    const canvasWidth = canvas.width;\n    const canvasHeight = canvas.height;\n    const radius = canvasWidth / 2;\n    const lineWidth = 2;\n    const cR = radius - lineWidth;\n\n    ctx.beginPath();\n    ctx.lineWidth = lineWidth * 2;\n\n    const axisLength = canvasWidth - lineWidth;\n    const unit = axisLength / 8;\n    const range = 0.2; // æ¯å¹\n    let currRange = range;\n    const xOffset = lineWidth;\n    let sp = 0; // å¨æåç§»é\n    let currData = 0;\n    const waveupsp = 0.005; // æ°´æ³¢ä¸æ¶¨éåº¦\n\n    let arcStack = [];\n    const bR = radius - lineWidth;\n    const circleOffset = -(Math.PI / 2);\n    let circleLock = true;\n\n    for (\n      let i = circleOffset;\n      i < circleOffset + (Math.PI * 2);\n      i += 1 / (Math.PI * 8)\n    ) {\n      arcStack.push([radius + bR * Math.cos(i), radius + bR * Math.sin(i)]);\n    }\n\n    const cStartPoint = arcStack.shift();\n    ctx.strokeStyle = this.color;\n    ctx.moveTo(cStartPoint[0], cStartPoint[1]);\n\n    function drawSin() {\n      ctx.beginPath();\n      ctx.save();\n\n      const sinStack = [];\n      for (let i = xOffset; i <= xOffset + axisLength; i += 20 / axisLength) {\n        const x = sp + (xOffset + i) / unit;\n        const y = Math.sin(x) * currRange;\n        const dx = i;\n        const dy = cR * 2 * (1 - currData) + (radius - cR) - unit * y;\n\n        ctx.lineTo(dx, dy);\n        sinStack.push([dx, dy]);\n      }\n\n      const startPoint = sinStack.shift();\n\n      ctx.lineTo(xOffset + axisLength, canvasHeight);\n      ctx.lineTo(xOffset, canvasHeight);\n      ctx.lineTo(startPoint[0], startPoint[1]);\n\n      const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);\n      gradient.addColorStop(0, '#ffffff');\n      gradient.addColorStop(1, '#1890FF');\n      ctx.fillStyle = gradient;\n      ctx.fill();\n      ctx.restore();\n    }\n\n    function render() {\n      ctx.clearRect(0, 0, canvasWidth, canvasHeight);\n      if (circleLock) {\n        if (arcStack.length) {\n          const temp = arcStack.shift();\n          ctx.lineTo(temp[0], temp[1]);\n          ctx.stroke();\n        } else {\n          circleLock = false;\n          ctx.lineTo(cStartPoint[0], cStartPoint[1]);\n          ctx.stroke();\n          arcStack = null;\n\n          ctx.globalCompositeOperation = 'destination-over';\n          ctx.beginPath();\n          ctx.lineWidth = lineWidth;\n          ctx.arc(radius, radius, bR, 0, Math.PI * 2, true);\n\n          ctx.beginPath();\n          ctx.save();\n          ctx.arc(radius, radius, (radius - lineWidth) * 3, 0, Math.PI * 2, true);\n\n          ctx.restore();\n          ctx.clip();\n          ctx.fillStyle = '#1890FF';\n        }\n      } else {\n        if (data >= 0.85) {\n          if (currRange > range / 4) {\n            const t = range * 0.01;\n            currRange -= t;\n          }\n        } else if (data <= 0.1) {\n          if (currRange < range * 1.5) {\n            const t = range * 0.01;\n            currRange += t;\n          }\n        } else {\n          if (currRange <= range) {\n            const t = range * 0.01;\n            currRange += t;\n          }\n          if (currRange >= range) {\n            const t = range * 0.01;\n            currRange -= t;\n          }\n        }\n        if (data - currData > 0) {\n          currData += waveupsp;\n        }\n        if (data - currData < 0) {\n          currData -= waveupsp;\n        }\n\n        sp += 0.07;\n        drawSin();\n      }\n      self.timer = requestAnimationFrame(render);\n    }\n\n    render();\n  }\n\n  private updateRadio(radio: number) {\n    this.renderer.setStyle(\n      this.el.nativeElement,\n      'transform',\n      `scale(${radio})`,\n    );\n  }\n\n  private installResizeEvent() {\n    if (this.resize$) return;\n\n    this.resize$ = fromEvent(window, 'resize')\n      .pipe(debounceTime(500))\n      .subscribe(() => this.resize());\n  }\n\n  private resize() {\n    const { offsetWidth } = this.el.nativeElement.parentNode;\n    this.updateRadio(offsetWidth < this.height ? offsetWidth / this.height : 1);\n    this.renderChart();\n  }\n\n  ngOnInit(): void {\n    this.initFlag = true;\n    this.cd.detectChanges();\n    this.zone.runOutsideAngular(() => {\n      this.updateRadio(1);\n      this.installResizeEvent();\n      setTimeout(() => this.resize(), 130);\n    });\n  }\n\n  ngOnChanges(): void {\n    if (this.initFlag) {\n      this.cd.detectChanges();\n      this.zone.runOutsideAngular(() => this.renderChart());\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this.timer) cancelAnimationFrame(this.timer);\n    if (this.resize$) this.resize$.unsubscribe();\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { DelonUtilModule } from '@delon/util';\n\nimport { G2WaterWaveComponent } from './water-wave.component';\n\nconst COMPONENTS = [G2WaterWaveComponent];\n\n@NgModule({\n  imports: [CommonModule, DelonUtilModule],\n  declarations: [...COMPONENTS],\n  exports: [...COMPONENTS],\n})\nexport class G2WaterWaveModule { }\n"],"names":["tslib_1.__decorate"],"mappings":"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"}

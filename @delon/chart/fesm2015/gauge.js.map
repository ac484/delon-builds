{"version":3,"file":"gauge.js.map","sources":["ng://@delon/chart/gauge/gauge.component.ts","ng://@delon/chart/gauge/gauge.module.ts"],"sourcesContent":["import {\r\n  Component,\r\n  Input,\r\n  ViewChild,\r\n  ElementRef,\r\n  OnInit,\r\n  OnDestroy,\r\n  OnChanges,\r\n  NgZone,\r\n  ChangeDetectionStrategy,\r\n} from '@angular/core';\r\nimport { toNumber } from '@delon/util';\r\n\r\ndeclare var G2: any;\r\n\r\n@Component({\r\n  selector: 'g2-gauge',\r\n  template: `<div #container></div>`,\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class G2GaugeComponent implements OnInit, OnDestroy, OnChanges {\r\n  // #region fields\r\n\r\n  @Input() title: string;\r\n\r\n  @Input()\r\n  get height() {\r\n    return this._height;\r\n  }\r\n  set height(value: any) {\r\n    this._height = toNumber(value);\r\n  }\r\n  private _height;\r\n  @Input() color = '#2F9CFF';\r\n  @Input() bgColor = '#F0F2F5';\r\n  @Input() format: Function;\r\n\r\n  @Input()\r\n  set percent(value: any) {\r\n    this._percent = toNumber(value);\r\n  }\r\n  private _percent: number;\r\n\r\n  // #endregion\r\n\r\n  @ViewChild('container') private node: ElementRef;\r\n\r\n  private chart: any;\r\n  private initFlag = false;\r\n\r\n  constructor(private zone: NgZone) {}\r\n\r\n  private createData() {\r\n    return [{ name: this.title, value: +this._percent }];\r\n  }\r\n\r\n  private draw() {\r\n    if (!this.chart) return;\r\n    this.chart.guide().clear();\r\n    const data = this.createData();\r\n    // ç»å¶ä»ªè¡¨çèæ¯\r\n    this.chart.guide().arc({\r\n      zIndex: 0,\r\n      top: false,\r\n      start: [0, 0.95],\r\n      end: [100, 0.95],\r\n      style: {\r\n        // åºç°è²\r\n        stroke: this.bgColor,\r\n        lineWidth: 12,\r\n      },\r\n    });\r\n    // ç»å¶ææ \r\n    this.chart.guide().arc({\r\n      zIndex: 1,\r\n      start: [0, 0.95],\r\n      end: [data[0].value, 0.95],\r\n      style: {\r\n        stroke: this.color,\r\n        lineWidth: 12,\r\n      },\r\n    });\r\n    // ç»å¶æ°å­\r\n    this.chart.guide().html({\r\n      position: ['50%', '95%'],\r\n      html: `\r\n      <div style=\"width: 300px;text-align: center;font-size: 12px!important;\">\r\n        <p style=\"font-size: 14px; color: rgba(0,0,0,0.43);margin: 0;\">${this.title}</p>\r\n        <p style=\"font-size: 24px;color: rgba(0,0,0,0.85);margin: 0;\">\r\n          ${data[0].value}%\r\n        </p>\r\n      </div>`\r\n    });\r\n    this.chart.changeData(data);\r\n  }\r\n\r\n  private runInstall() {\r\n    this.zone.runOutsideAngular(() => setTimeout(() => this.install()));\r\n  }\r\n\r\n  private install() {\r\n    this.node.nativeElement.innerHTML = '';\r\n    const Shape = G2.Shape;\r\n    // èªå®ä¹Shape é¨å\r\n    Shape.registerShape('point', 'pointer', {\r\n      drawShape(cfg, group) {\r\n        let point = cfg.points[0]; // è·åç¬¬ä¸ä¸ªæ è®°ç¹\r\n        point = this.parsePoint(point);\r\n        const center = this.parsePoint({\r\n          // è·åæåæ ç³»ä¸ç»å¸ä¸­å¿ç¹\r\n          x: 0,\r\n          y: 0,\r\n        });\r\n        // ç»å¶æé\r\n        group.addShape('line', {\r\n          attrs: {\r\n            x1: center.x,\r\n            y1: center.y,\r\n            x2: point.x,\r\n            y2: point.y,\r\n            stroke: cfg.color,\r\n            lineWidth: 2,\r\n            lineCap: 'round',\r\n          },\r\n        });\r\n\r\n        // const { origin } = cfg;\r\n        // group.addShape('text', {\r\n        //   attrs: {\r\n        //     x: center.x,\r\n        //     y: center.y + 80,\r\n        //     text: `${origin._origin.value}%`,\r\n        //     textAlign: 'center',\r\n        //     fontSize: 24,\r\n        //     fill: 'rgba(0, 0, 0, 0.85)',\r\n        //   },\r\n        // });\r\n        return group.addShape('circle', {\r\n          attrs: {\r\n            x: center.x,\r\n            y: center.y,\r\n            r: 9.75,\r\n            stroke: cfg.color,\r\n            lineWidth: 2,\r\n            fill: '#fff',\r\n          },\r\n        });\r\n      },\r\n    });\r\n\r\n    const data = this.createData();\r\n    const chart = new G2.Chart({\r\n      container: this.node.nativeElement,\r\n      forceFit: true,\r\n      height: this.height,\r\n      padding: [10, 10, 30, 10],\r\n    });\r\n    chart.source(data);\r\n\r\n    chart.coord('polar', {\r\n      startAngle: -1.2 * Math.PI,\r\n      endAngle: 0.2 * Math.PI,\r\n    });\r\n    chart.scale('value', {\r\n      min: 0,\r\n      max: 100,\r\n      nice: true,\r\n      tickCount: 6,\r\n    });\r\n\r\n    chart.axis('1', false);\r\n    // å»åº¦å¼\r\n    chart.axis('value', {\r\n      zIndex: 2,\r\n      line: null,\r\n      label: {\r\n        offset: -12,\r\n        formatter: this.format,\r\n      },\r\n      tickLine: null,\r\n      grid: null,\r\n    });\r\n    chart.legend(false);\r\n    chart\r\n      .point({\r\n        generatePoints: true,\r\n      })\r\n      .position('value*1')\r\n      .shape('pointer')\r\n      .color(this.color)\r\n      .active(false);\r\n\r\n    this.chart = chart;\r\n    this.draw();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.initFlag = true;\r\n    this.runInstall();\r\n  }\r\n\r\n  ngOnChanges(): void {\r\n    if (this.initFlag) this.draw();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.chart) this.chart.destroy();\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { DelonUtilModule } from '@delon/util';\r\n\r\nimport { G2GaugeComponent } from './gauge.component';\r\n\r\nconst COMPONENTS = [G2GaugeComponent];\r\n\r\n@NgModule({\r\n  imports: [CommonModule, DelonUtilModule],\r\n  declarations: [...COMPONENTS],\r\n  exports: [...COMPONENTS],\r\n})\r\nexport class G2GaugeModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return { ngModule: G2GaugeModule, providers: [] };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}

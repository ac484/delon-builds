{"version":3,"file":"bar.js.map","sources":["ng://@delon/chart/bar/bar.component.ts","ng://@delon/chart/bar/bar.module.ts"],"sourcesContent":["import {\r\n  Component,\r\n  Input,\r\n  HostBinding,\r\n  ViewChild,\r\n  ElementRef,\r\n  OnDestroy,\r\n  OnChanges,\r\n  NgZone,\r\n  TemplateRef,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n} from '@angular/core';\r\nimport { Subscription, fromEvent } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { toBoolean, toNumber } from '@delon/util';\r\n\r\ndeclare var G2: any;\r\n\r\n@Component({\r\n  selector: 'g2-bar',\r\n  template: `\r\n  <ng-container *ngIf=\"_title; else _titleTpl\"><h4 style=\"margin-bottom:20px\">{{_title}}</h4></ng-container>\r\n  <div #container></div>`,\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  preserveWhitespaces: false,\r\n})\r\nexport class G2BarComponent implements OnDestroy, OnChanges {\r\n  private autoHideXLabels = false;\r\n  private resize$: Subscription = null;\r\n  private chart: any;\r\n\r\n  // #region fields\r\n  _title = '';\r\n  _titleTpl: TemplateRef<any>;\r\n  @Input()\r\n  set title(value: string | TemplateRef<any>) {\r\n    if (value instanceof TemplateRef) {\r\n      this._title = null;\r\n      this._titleTpl = value;\r\n    } else {\r\n      this._title = value;\r\n    }\r\n    this.cd.detectChanges();\r\n  }\r\n\r\n  @Input() color = 'rgba(24, 144, 255, 0.85)';\r\n\r\n  @HostBinding('style.height.px')\r\n  @Input()\r\n  get height() {\r\n    return this._height;\r\n  }\r\n  set height(value: any) {\r\n    this._height = toNumber(value);\r\n  }\r\n  private _height = 0;\r\n\r\n  @Input() padding: number[];\r\n  @Input() data: Array<{ x: any; y: any; [key: string]: any }>;\r\n\r\n  @Input()\r\n  set autoLabel(value: any) {\r\n    this._autoLabel = toBoolean(value);\r\n  }\r\n  private _autoLabel = true;\r\n\r\n  // #endregion\r\n\r\n  @ViewChild('container') private node: ElementRef;\r\n\r\n  constructor(\r\n    private el: ElementRef,\r\n    private cd: ChangeDetectorRef,\r\n    private zone: NgZone,\r\n  ) {}\r\n\r\n  private runInstall() {\r\n    this.zone.runOutsideAngular(() => setTimeout(() => this.install()));\r\n  }\r\n\r\n  private install() {\r\n    const canvasWidth = this.el.nativeElement.clientWidth;\r\n    const minWidth = this.data.length * 30;\r\n\r\n    if (canvasWidth <= minWidth) {\r\n      if (!this.autoHideXLabels) {\r\n        this.autoHideXLabels = true;\r\n      }\r\n    } else if (this.autoHideXLabels) {\r\n      this.autoHideXLabels = false;\r\n    }\r\n\r\n    if (!this.data || (this.data && this.data.length < 1)) return;\r\n    this.node.nativeElement.innerHTML = '';\r\n\r\n    const chart = new G2.Chart({\r\n      container: this.node.nativeElement,\r\n      forceFit: true,\r\n      height: this._title || this._titleTpl ? this.height - 41 : this.height,\r\n      legend: null,\r\n      padding: this.padding || 'auto',\r\n    });\r\n\r\n    chart.axis('x', !this.autoHideXLabels);\r\n    chart.axis('y', {\r\n      title: false,\r\n      line: false,\r\n      tickLine: false,\r\n    });\r\n\r\n    chart.source(this.data, {\r\n      x: {\r\n        type: 'cat',\r\n      },\r\n      y: {\r\n        min: 0,\r\n      },\r\n    });\r\n\r\n    chart.tooltip({\r\n      showTitle: false,\r\n    });\r\n    chart\r\n      .interval()\r\n      .position('x*y')\r\n      .color(this.color)\r\n      .tooltip('x*y', (x, y) => {\r\n        return {\r\n          name: x,\r\n          value: y,\r\n        };\r\n      });\r\n    chart.render();\r\n    this.chart = chart;\r\n  }\r\n\r\n  private installResizeEvent() {\r\n    if (!this._autoLabel || this.resize$) return;\r\n\r\n    this.resize$ = fromEvent(window, 'resize')\r\n      .pipe(debounceTime(200))\r\n      .subscribe(() => this.runInstall());\r\n  }\r\n\r\n  ngOnChanges(): void {\r\n    this.installResizeEvent();\r\n    this.runInstall();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.resize$) this.resize$.unsubscribe();\r\n    if (this.chart) {\r\n      this.chart.destroy();\r\n      this.chart = null;\r\n    }\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { DelonUtilModule } from '@delon/util';\r\n\r\nimport { G2BarComponent } from './bar.component';\r\n\r\nconst COMPONENTS = [G2BarComponent];\r\n\r\n@NgModule({\r\n  imports: [CommonModule, DelonUtilModule],\r\n  declarations: [...COMPONENTS],\r\n  exports: [...COMPONENTS],\r\n})\r\nexport class G2BarModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return { ngModule: G2BarModule, providers: [] };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}

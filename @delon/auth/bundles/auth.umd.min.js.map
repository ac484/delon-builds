{"version":3,"sources":["../../../../packages/auth/src/auth.config.ts","../../../../packages/auth/src/store/local-storage.service.ts","../../../../packages/auth/src/store/interface.ts","../../../../packages/auth/src/token/token.service.ts","../../../../packages/auth/src/token/interface.ts","../../../../packages/auth/src/social/social.service.ts","../../../../packages/auth/src/store/memory.service.ts","../../../../packages/auth/src/store/session-storage.service.ts","../../../../packages/auth/src/store/cookie-storage.service.ts","../../../../node_modules/tslib/tslib.es6.js","../../../../packages/auth/src/token/helper.ts","../../../../packages/auth/src/token/base.interceptor.ts","../../../../packages/auth/src/token/jwt/jwt.helper.ts","../../../../packages/auth/src/token/jwt/jwt.model.ts","../../../../packages/auth/src/token/jwt/jwt.interceptor.ts","../../../../packages/auth/src/token/jwt/jwt.guard.ts","../../../../packages/auth/src/token/simple/simple.model.ts","../../../../packages/auth/src/token/simple/simple.interceptor.ts","../../../../packages/auth/src/token/simple/simple.guard.ts","../../../../packages/auth/src/auth.module.ts"],"names":["AUTH_DEFAULT_CONFIG","store_key","token_invalid_redirect","token_exp_offset","token_send_key","token_send_template","token_send_place","login_url","ignores","allow_anonymous_key","executeOtherInterceptors","refreshTime","refreshOffset","mergeConfig","srv","merge","DA_STORE_TOKEN_LOCAL_FACTORY","LocalStorageStore","prototype","get","key","JSON","parse","localStorage","getItem","set","value","setItem","stringify","remove","removeItem","DA_STORE_TOKEN","InjectionToken","providedIn","factory","DA_SERVICE_TOKEN_FACTORY","TokenService","inject","AlainConfigService","configSrv","store","this","refresh$","Subject","change$","BehaviorSubject","_referrer","_options","Object","defineProperty","builderRefresh","pipe","share","data","next","type","assign","clear","options","onlyToken","token","change","_this","_a","cleanRefresh","interval$","interval","map","item","expired","exp","Date","valueOf","filter","v","subscribe","res","closed","unsubscribe","ngOnDestroy","Injectable","Inject","args","DA_SERVICE_TOKEN","OPENTYPE","HREFCALLBACK","SocialService","tokenService","doc","router","login","url","callback","windowFeatures","_win","window","open","_winTime","setInterval","model","observer","complete","Observable","location","href","rawData","indexOf","Error","rightUrl","split","parseUrl","close","navigateByUrl","clearInterval","DOCUMENT","Router","MemoryStore","cache","SessionStorageStore","sessionStorage","CookieStorageStore","put","extendStatics","d","b","setPrototypeOf","__proto__","Array","p","hasOwnProperty","call","__extends","TypeError","String","__","constructor","create","__values","o","s","Symbol","iterator","m","i","length","done","CheckSimple","CheckJwt","offset","isExpired","ToLogin","injector","setTimeout","test","navigate","HttpAuthInterceptorHandler","interceptor","handle","req","intercept","BaseInterceptor","isArray","_b","_c","ingoreKey","ingored","params","has","delete","urlArr","queryStringParams","HttpParams","fromString","queryString","toString","clone","isAuth","err$_1","HttpErrorResponse","headers","status","statusText","error","interceptors","HTTP_INTERCEPTORS","lastInterceptors","slice","reduceRight","_next","_interceptor","_","setReq","urlBase64Decode","str","output","replace","decodeURIComponent","chars","bc","bs","buffer","idx","charAt","fromCharCode","b64decode","c","charCodeAt","join","b64DecodeUnicode","Injector","decorators","Optional","JWTTokenModel","parts","decoded","payload","date","setUTCSeconds","offsetSeconds","JWTInterceptor","_super","setHeaders","Authorization","JWTGuard","process","cog","canLoad","route","_segments","path","canActivateChild","_childRoute","state","canActivate","_route","SimpleInterceptor","g","obj","body","append","SimpleGuard","NgModule"],"mappings":"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","sourcesContent":["import { AlainAuthConfig, AlainConfigService } from '@delon/util/config';\n\nexport const AUTH_DEFAULT_CONFIG: AlainAuthConfig = {\n  store_key: `_token`,\n  token_invalid_redirect: true,\n  token_exp_offset: 10,\n  token_send_key: `token`,\n  // tslint:disable-next-line: no-invalid-template-strings\n  token_send_template: '${token}',\n  token_send_place: 'header',\n  login_url: '/login',\n  ignores: [/\\/login/, /assets\\//, /passport\\//],\n  allow_anonymous_key: `_allow_anonymous`,\n  executeOtherInterceptors: true,\n  refreshTime: 3000,\n  refreshOffset: 6000,\n};\n\nexport function mergeConfig(srv: AlainConfigService): AlainAuthConfig {\n  return srv.merge('auth', AUTH_DEFAULT_CONFIG)!;\n}\n","import { ITokenModel } from '../token/interface';\nimport { IStore } from './interface';\n\nexport function DA_STORE_TOKEN_LOCAL_FACTORY(): IStore {\n  return new LocalStorageStore();\n}\n\n/**\n * `localStorage` storage, **not lost after closing the browser**.\n *\n * ```ts\n * // global-config.module.ts\n * { provide: DA_STORE_TOKEN, useClass: LocalStorageStore }\n * ```\n */\nexport class LocalStorageStore implements IStore {\n  get(key: string): ITokenModel {\n    return JSON.parse(localStorage.getItem(key) || '{}') || {};\n  }\n\n  set(key: string, value: ITokenModel | null): boolean {\n    localStorage.setItem(key, JSON.stringify(value));\n    return true;\n  }\n\n  remove(key: string): void {\n    localStorage.removeItem(key);\n  }\n}\n","import { InjectionToken } from '@angular/core';\nimport { ITokenModel } from '../token/interface';\nimport { DA_STORE_TOKEN_LOCAL_FACTORY } from './local-storage.service';\n\nexport const DA_STORE_TOKEN = new InjectionToken<IStore>('AUTH_STORE_TOKEN', {\n  providedIn: 'root',\n  factory: DA_STORE_TOKEN_LOCAL_FACTORY,\n});\n\n// tslint:disable-next-line: interface-name\nexport interface IStore {\n  get(key: string): ITokenModel;\n\n  set(key: string, value: ITokenModel): boolean;\n\n  remove(key: string): void;\n}\n","import { inject, Inject, Injectable, OnDestroy } from '@angular/core';\nimport { AlainAuthConfig, AlainConfigService } from '@delon/util/config';\nimport { BehaviorSubject, interval, Observable, Subject, Subscription } from 'rxjs';\nimport { filter, map, share } from 'rxjs/operators';\nimport { mergeConfig } from '../auth.config';\nimport { DA_STORE_TOKEN, IStore } from '../store/interface';\nimport { AuthReferrer, ITokenModel, ITokenService } from './interface';\n\nexport function DA_SERVICE_TOKEN_FACTORY(): ITokenService {\n  return new TokenService(inject(AlainConfigService), inject(DA_STORE_TOKEN));\n}\n\n/**\n * 维护Token信息服务，[在线文档](https://ng-alain.com/auth)\n */\n@Injectable()\nexport class TokenService implements ITokenService, OnDestroy {\n  private refresh$ = new Subject<ITokenModel>();\n  private change$ = new BehaviorSubject<ITokenModel | null>(null);\n  private interval$: Subscription;\n  private _referrer: AuthReferrer = {};\n  private _options: AlainAuthConfig;\n\n  constructor(configSrv: AlainConfigService, @Inject(DA_STORE_TOKEN) private store: IStore) {\n    this._options = mergeConfig(configSrv);\n  }\n\n  get refresh(): Observable<ITokenModel> {\n    this.builderRefresh();\n    return this.refresh$.pipe(share());\n  }\n\n  get login_url(): string | undefined {\n    return this._options.login_url;\n  }\n\n  get referrer(): AuthReferrer {\n    return this._referrer;\n  }\n\n  get options(): AlainAuthConfig {\n    return this._options;\n  }\n\n  set(data: ITokenModel): boolean {\n    this.change$.next(data);\n    return this.store.set(this._options.store_key!, data);\n  }\n\n  get(type?: any): any;\n  get<T extends ITokenModel>(type?: new () => T): T {\n    const data = this.store.get(this._options.store_key!);\n    return type ? (Object.assign(new type(), data) as T) : (data as T);\n  }\n\n  clear(options: { onlyToken: boolean } = { onlyToken: false }): void {\n    let data: ITokenModel | null = null;\n    if (options.onlyToken === true) {\n      data = this.get() as ITokenModel;\n      data.token = ``;\n      this.set(data);\n    } else {\n      this.store.remove(this._options.store_key!);\n    }\n    this.change$.next(data);\n  }\n\n  change(): Observable<ITokenModel | null> {\n    return this.change$.pipe(share());\n  }\n\n  private builderRefresh(): void {\n    const { refreshTime, refreshOffset } = this._options;\n    this.cleanRefresh();\n    this.interval$ = interval(refreshTime)\n      .pipe(\n        map(() => {\n          const item = this.get() as ITokenModel;\n          const expired = item.expired || item.exp || 0;\n          if (expired <= 0) {\n            return null;\n          }\n\n          const curTime = new Date().valueOf() + refreshOffset!;\n          return expired <= curTime ? item : null;\n        }),\n        filter(v => v != null),\n      )\n      .subscribe(res => this.refresh$.next(res!));\n  }\n\n  private cleanRefresh(): void {\n    if (this.interval$ && !this.interval$.closed) {\n      this.interval$.unsubscribe();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.cleanRefresh();\n  }\n}\n","import { InjectionToken } from '@angular/core';\nimport { AlainAuthConfig } from '@delon/util/config';\nimport { Observable } from 'rxjs';\nimport { DA_SERVICE_TOKEN_FACTORY } from './token.service';\n\nexport const DA_SERVICE_TOKEN = new InjectionToken<ITokenService>('DA_SERVICE_TOKEN', {\n  providedIn: 'root',\n  factory: DA_SERVICE_TOKEN_FACTORY,\n});\n\n// tslint:disable-next-line: interface-name\nexport interface ITokenModel {\n  [key: string]: any;\n\n  token: string | null | undefined;\n\n  /**\n   * 过期时间，单位：ms\n   * - 不管Simple、JWT模式都必须指定\n   */\n  expired?: number;\n}\n\nexport interface AuthReferrer {\n  url?: string | null | undefined;\n}\n\n// tslint:disable-next-line: interface-name\nexport interface ITokenService {\n  /**\n   * 授权失败后跳转路由路径（支持外部链接地址），通过设置[全局配置](https://ng-alain.com/docs/global-config)来改变\n   */\n  readonly login_url: string | undefined;\n\n  /**\n   * 当前请求页面的来源页面的地址\n   */\n  readonly referrer?: AuthReferrer;\n\n  readonly options: AlainAuthConfig;\n\n  /**\n   * 订阅刷新，订阅时会自动产生一个定时器，每隔一段时间进行一些校验\n   * - **注意** 会多次触发，请务必做好业务判断\n   */\n  readonly refresh: Observable<ITokenModel>;\n\n  /**\n   * 设置 Token 信息，当用户 Token 发生变动时都需要调用此方法重新刷新\n   * - 如果需要监听过期，需要传递 `expired` 值\n   */\n  set(data: ITokenModel | null): boolean;\n\n  /**\n   * 获取Token，形式包括：\n   * - `get()` 获取 Simple Token\n   * - `get<JWTTokenModel>(JWTTokenModel)` 获取 JWT Token\n   */\n  get(type?: any): ITokenModel | null;\n\n  /**\n   * 获取Token，形式包括：\n   * - `get()` 获取 Simple Token\n   * - `get<JWTTokenModel>(JWTTokenModel)` 获取 JWT Token\n   */\n  get<T extends ITokenModel>(type?: any): T;\n\n  /**\n   * 清除 Token 信息，当用户退出登录时调用。\n   * ```\n   * // 清除所有 Token 信息\n   * tokenService.clear();\n   * // 只清除 token 字段\n   * tokenService.clear({ onlyToken: true });\n   * ```\n   */\n  clear(options?: { onlyToken: boolean }): void;\n\n  /**\n   * 订阅 Token 对象变更通知\n   */\n  change(): Observable<ITokenModel | null>;\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable, OnDestroy } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Observable, Observer } from 'rxjs';\nimport { DA_SERVICE_TOKEN, ITokenModel, ITokenService } from '../token/interface';\n\nconst OPENTYPE = '_delonAuthSocialType';\nconst HREFCALLBACK = '_delonAuthSocialCallbackByHref';\n\nexport type SocialOpenType = 'href' | 'window';\n\n@Injectable()\nexport class SocialService implements OnDestroy {\n  private _win: Window | null;\n  private _winTime: any;\n  private observer: Observer<ITokenModel | null>;\n\n  constructor(@Inject(DA_SERVICE_TOKEN) private tokenService: ITokenService, @Inject(DOCUMENT) private doc: any, private router: Router) {}\n\n  /**\n   * 使用窗体打开授权页，返回值是 `Observable<ITokenModel>` 用于订阅授权后返回的结果\n   * @param url 获取授权地址\n   * @param callback 回调路由地址\n   * @param options.windowFeatures 等同 `window.open` 的 `features` 参数值\n   */\n  login(\n    url: string,\n    callback?: string,\n    options?: {\n      type?: 'window';\n      windowFeatures?: string;\n    },\n  ): Observable<ITokenModel>;\n\n  /**\n   * 跳转至授权页\n   * @param url 获取授权地址\n   * @param callback 回调路由地址\n   */\n  login(\n    url: string,\n    callback?: string,\n    options?: {\n      type?: 'href';\n    },\n  ): void;\n\n  /**\n   * 跳转至登录页，若为 `type=window` 时，返回值是 `Observable<ITokenModel>`\n   * @param url 获取授权地址\n   * @param callback 当 `type=href` 成功时的回调路由地址\n   * @param options.type 打开方式，默认 `window`\n   * @param options.windowFeatures 等同 `window.open` 的 `features` 参数值\n   */\n  login(\n    url: string,\n    callback: string = '/',\n    options: {\n      type?: SocialOpenType;\n      windowFeatures?: string;\n    } = {},\n  ): Observable<ITokenModel | null> | void {\n    options = {\n      type: 'window',\n      windowFeatures: 'location=yes,height=570,width=520,scrollbars=yes,status=yes',\n      ...options,\n    };\n    localStorage.setItem(OPENTYPE, options.type!);\n    localStorage.setItem(HREFCALLBACK, callback);\n    if (options.type === 'href') {\n      this.doc.location.href = url;\n      return;\n    }\n\n    this._win = window.open(url, '_blank', options.windowFeatures);\n    this._winTime = setInterval(() => {\n      if (this._win && this._win.closed) {\n        this.ngOnDestroy();\n\n        let model = this.tokenService.get();\n        if (model && !model.token) model = null;\n\n        // 触发变更通知\n        if (model) {\n          this.tokenService.set(model);\n        }\n\n        this.observer.next(model);\n        this.observer.complete();\n      }\n    }, 100);\n    return new Observable((observer: Observer<ITokenModel | null>) => {\n      this.observer = observer;\n    });\n  }\n\n  /**\n   * 授权成功后的回调处理\n   *\n   * @param rawData 指定回调认证信息，为空时从根据当前URL解析\n   */\n  callback(rawData?: ITokenModel | string | null): ITokenModel {\n    // from uri\n    if (!rawData && this.router.url.indexOf('?') === -1) {\n      throw new Error(`url muse contain a ?`);\n    }\n    // parse\n    let data: ITokenModel = { token: `` };\n    if (typeof rawData === 'string') {\n      const rightUrl = rawData.split('?')[1].split('#')[0];\n      data = this.router.parseUrl('./?' + rightUrl).queryParams as ITokenModel;\n    } else {\n      data = rawData as ITokenModel;\n    }\n\n    if (!data || !data.token) throw new Error(`invalide token data`);\n    this.tokenService.set(data);\n\n    const url = localStorage.getItem(HREFCALLBACK) || '/';\n    localStorage.removeItem(HREFCALLBACK);\n    const type = localStorage.getItem(OPENTYPE);\n    localStorage.removeItem(OPENTYPE);\n    if (type === 'window') {\n      window.close();\n    } else {\n      this.router.navigateByUrl(url);\n    }\n\n    return data;\n  }\n\n  ngOnDestroy(): void {\n    clearInterval(this._winTime);\n    this._winTime = null;\n  }\n}\n","import { ITokenModel } from '../token/interface';\nimport { IStore } from './interface';\n\n/**\n * 内存存储，关掉浏览器标签后**丢失**。\n *\n * ```ts\n * // global-config.module.ts\n * { provide: DA_STORE_TOKEN, useClass: MemoryStore }\n * ```\n */\nexport class MemoryStore implements IStore {\n  private cache: { [key: string]: ITokenModel | null } = {};\n\n  get(key: string): ITokenModel {\n    return this.cache[key] || ({} as ITokenModel);\n  }\n\n  set(key: string, value: ITokenModel): boolean {\n    this.cache[key] = value;\n    return true;\n  }\n\n  remove(key: string): void {\n    this.cache[key] = null;\n  }\n}\n","import { ITokenModel } from '../token/interface';\nimport { IStore } from './interface';\n\n/**\n * `sessionStorage` storage, **lost after closing the browser**.\n *\n * ```ts\n * // global-config.module.ts\n * { provide: DA_STORE_TOKEN, useClass: SessionStorageStore }\n * ```\n */\nexport class SessionStorageStore implements IStore {\n  get(key: string): ITokenModel {\n    return JSON.parse(sessionStorage.getItem(key) || '{}') || {};\n  }\n\n  set(key: string, value: ITokenModel | null): boolean {\n    sessionStorage.setItem(key, JSON.stringify(value));\n    return true;\n  }\n\n  remove(key: string): void {\n    sessionStorage.removeItem(key);\n  }\n}\n","import { CookieService } from '@delon/util/browser';\nimport { ITokenModel } from '../token/interface';\nimport { IStore } from './interface';\n\n/**\n * `cookie` storage\n *\n * ```ts\n * // global-config.module.ts\n * { provide: DA_STORE_TOKEN, useClass: CookieStorageStore }\n * ```\n */\nexport class CookieStorageStore implements IStore {\n  constructor(private srv: CookieService) {}\n\n  get(key: string): ITokenModel {\n    return JSON.parse(this.srv.get(key) || '{}') || {};\n  }\n\n  set(key: string, value: ITokenModel | null): boolean {\n    this.srv.put(key, JSON.stringify(value));\n    return true;\n  }\n\n  remove(key: string): void {\n    this.srv.remove(key);\n  }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { DOCUMENT } from '@angular/common';\nimport { Injector } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AlainAuthConfig } from '@delon/util/config';\nimport { DA_SERVICE_TOKEN, ITokenService } from './interface';\nimport { JWTTokenModel } from './jwt/jwt.model';\nimport { SimpleTokenModel } from './simple/simple.model';\n\nexport function CheckSimple(model: SimpleTokenModel | null): boolean {\n  return model != null && typeof model.token === 'string' && model.token.length > 0;\n}\n\nexport function CheckJwt(model: JWTTokenModel, offset: number): boolean {\n  return model != null && !!model.token && !model.isExpired(offset);\n}\n\nexport function ToLogin(options: AlainAuthConfig, injector: Injector, url?: string): void {\n  const router = injector.get<Router>(Router);\n  (injector.get(DA_SERVICE_TOKEN) as ITokenService).referrer!.url = url || router.url;\n  if (options.token_invalid_redirect === true) {\n    setTimeout(() => {\n      if (/^https?:\\/\\//g.test(options.login_url!)) {\n        injector.get(DOCUMENT).location.href = options.login_url as string;\n      } else {\n        router.navigate([options.login_url]);\n      }\n    });\n  }\n}\n","import {\n  HttpErrorResponse,\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpParams,\n  HttpRequest,\n  HTTP_INTERCEPTORS,\n} from '@angular/common/http';\nimport { Injectable, Injector, Optional } from '@angular/core';\nimport { AlainAuthConfig, AlainConfigService } from '@delon/util';\nimport { Observable, Observer } from 'rxjs';\nimport { mergeConfig } from '../auth.config';\nimport { ToLogin } from './helper';\nimport { ITokenModel } from './interface';\n\nclass HttpAuthInterceptorHandler implements HttpHandler {\n  constructor(private next: HttpHandler, private interceptor: HttpInterceptor) {}\n\n  handle(req: HttpRequest<any>): Observable<HttpEvent<any>> {\n    return this.interceptor.intercept(req, this.next);\n  }\n}\n\n@Injectable()\nexport abstract class BaseInterceptor implements HttpInterceptor {\n  constructor(@Optional() protected injector: Injector) {}\n\n  protected model: ITokenModel;\n\n  abstract isAuth(options: AlainAuthConfig): boolean;\n\n  abstract setReq(req: HttpRequest<any>, options: AlainAuthConfig): HttpRequest<any>;\n\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n    const options = mergeConfig(this.injector.get(AlainConfigService));\n    if (Array.isArray(options.ignores)) {\n      for (const item of options.ignores) {\n        if (item.test(req.url)) return next.handle(req);\n      }\n    }\n\n    const ingoreKey = options.allow_anonymous_key!;\n    let ingored = false;\n    let params = req.params;\n    let url = req.url;\n    if (req.params.has(ingoreKey)) {\n      params = req.params.delete(ingoreKey);\n      ingored = true;\n    }\n    const urlArr = req.url.split('?');\n    if (urlArr.length > 1) {\n      const queryStringParams = new HttpParams({ fromString: urlArr[1] });\n      if (queryStringParams.has(ingoreKey)) {\n        const queryString = queryStringParams.delete(ingoreKey).toString();\n        url = queryString.length > 0 ? `${urlArr[0]}?${queryString}` : urlArr[0];\n        ingored = true;\n      }\n    }\n    if (ingored) {\n      return next.handle(req.clone({ params, url }));\n    }\n\n    if (this.isAuth(options)) {\n      req = this.setReq(req, options);\n    } else {\n      ToLogin(options, this.injector);\n      // Interrupt Http request, so need to generate a new Observable\n      const err$ = new Observable((observer: Observer<HttpEvent<any>>) => {\n        const res = new HttpErrorResponse({\n          url: req.url,\n          headers: req.headers,\n          status: 401,\n          statusText: `来自 @delon/auth 的拦截，所请求URL未授权，若是登录API可加入 [url?_allow_anonymous=true] 来表示忽略校验，更多方法请参考： https://ng-alain.com/auth/getting-started#AlainAuthConfig\\nThe interception from @delon/auth, the requested URL is not authorized. If the login API can add [url?_allow_anonymous=true] to ignore the check, please refer to: https://ng-alain.com/auth/getting-started#AlainAuthConfig`,\n        });\n        observer.error(res);\n      });\n      if (options.executeOtherInterceptors) {\n        const interceptors = this.injector.get(HTTP_INTERCEPTORS, []);\n        const lastInterceptors = interceptors.slice(interceptors.indexOf(this) + 1);\n        if (lastInterceptors.length > 0) {\n          const chain = lastInterceptors.reduceRight((_next, _interceptor) => new HttpAuthInterceptorHandler(_next, _interceptor), {\n            handle: (_: HttpRequest<any>) => err$,\n          });\n          return chain.handle(req);\n        }\n      }\n      return err$;\n    }\n    return next.handle(req);\n  }\n}\n","export function urlBase64Decode(str: string): string {\n  let output = str.replace(/-/g, '+').replace(/_/g, '/');\n  switch (output.length % 4) {\n    case 0: {\n      break;\n    }\n    case 2: {\n      output += '==';\n      break;\n    }\n    case 3: {\n      output += '=';\n      break;\n    }\n    default: {\n      throw new Error(`'atob' failed: The string to be decoded is not correctly encoded.`);\n    }\n  }\n  return b64DecodeUnicode(output);\n}\n\nfunction b64decode(str: string): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  let output = '';\n\n  str = String(str).replace(/=+$/, '');\n\n  for (\n    // initialize result and counters\n    // tslint:disable:no-conditional-assignment binary-expression-operand-order\n    let bc = 0, bs: any, buffer: any, idx = 0;\n    // get next character\n    (buffer = str.charAt(idx++));\n    // character found in table? initialize bit storage and add its ascii value;\n    ~buffer &&\n    // tslint:disable-next-line: ban-comma-operator\n    ((bs = bc % 4 ? bs * 64 + buffer : buffer),\n    // and if not first of each 4 characters,\n    // convert the first 8 bits to one ascii character\n    bc++ % 4)\n      ? (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6))))\n      : 0\n  ) {\n    // try to find character in table (0-63, not found => -1)\n    buffer = chars.indexOf(buffer);\n  }\n  return output;\n}\n\n// https://developer.mozilla.org/en/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem\nfunction b64DecodeUnicode(str: string): string {\n  return decodeURIComponent(\n    Array.prototype.map\n      .call(b64decode(str), (c: string) => {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n      })\n      .join(''),\n  );\n}\n","import { NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { ITokenModel } from '../interface';\nimport { urlBase64Decode } from './jwt.helper';\n\nexport interface JWT {\n  /**\n   * Issuerd\n   */\n  iss: string;\n  /**\n   * Issued At\n   */\n  iat: string;\n  /**\n   * Subject\n   */\n  sub: string;\n  /**\n   * Expiration Time\n   */\n  exp: number;\n  /**\n   * Audience\n   */\n  aud: string;\n  /**\n   * Not Before\n   */\n  nbf: string;\n  /**\n   * JWT ID\n   */\n  jti: string;\n\n  [key: string]: any;\n  [key: number]: any;\n}\n\nexport class JWTTokenModel implements ITokenModel {\n  [key: string]: NzSafeAny;\n\n  token: string | null | undefined;\n\n  expired?: number;\n\n  /**\n   * 获取载荷信息\n   */\n  get payload(): JWT {\n    const parts = (this.token || '').split('.');\n    if (parts.length !== 3) throw new Error('JWT must have 3 parts');\n\n    const decoded = urlBase64Decode(parts[1]);\n    return JSON.parse(decoded);\n  }\n\n  /**\n   * 获取过期时间戳（单位：ms）\n   */\n  get exp(): number | null {\n    const decoded = this.payload;\n    if (!decoded.hasOwnProperty('exp')) return null;\n    const date = new Date(0);\n    date.setUTCSeconds(decoded.exp);\n    return date.valueOf();\n  }\n\n  /**\n   * 检查Token是否过期，当`payload` 包含 `exp` 字段时有效，若无 `exp` 字段直接返回 `null`\n   *\n   * @param offsetSeconds 偏移量\n   */\n  isExpired(offsetSeconds: number = 0): boolean | null {\n    const exp = this.exp;\n    if (exp == null) return null;\n\n    return !(exp > new Date().valueOf() + offsetSeconds * 1000);\n  }\n}\n","import { HttpRequest } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { AlainAuthConfig } from '@delon/util/config';\nimport { BaseInterceptor } from '../base.interceptor';\nimport { CheckJwt } from '../helper';\nimport { DA_SERVICE_TOKEN } from '../interface';\nimport { JWTTokenModel } from './jwt.model';\n\n/**\n * JWT 拦截器\n *\n * ```\n * // app.module.ts\n * { provide: HTTP_INTERCEPTORS, useClass: JWTInterceptor, multi: true}\n * ```\n */\n@Injectable()\nexport class JWTInterceptor extends BaseInterceptor {\n  isAuth(options: AlainAuthConfig): boolean {\n    this.model = this.injector.get(DA_SERVICE_TOKEN).get<JWTTokenModel>(JWTTokenModel);\n    return CheckJwt(this.model as JWTTokenModel, options.token_exp_offset!);\n  }\n\n  setReq(req: HttpRequest<any>, _options: AlainAuthConfig): HttpRequest<any> {\n    return req.clone({\n      setHeaders: {\n        Authorization: `Bearer ${this.model.token}`,\n      },\n    });\n  }\n}\n","import { Inject, Injectable, Injector } from '@angular/core';\nimport { ActivatedRouteSnapshot, CanActivate, CanActivateChild, CanLoad, Route, RouterStateSnapshot, UrlSegment } from '@angular/router';\nimport { AlainAuthConfig } from '@delon/util/config';\nimport { CheckJwt, ToLogin } from '../helper';\nimport { DA_SERVICE_TOKEN, ITokenService } from '../interface';\nimport { JWTTokenModel } from './jwt.model';\n\n/**\n * JWT 路由守卫, [ACL Document](https://ng-alain.com/auth/guard).\n *\n * ```ts\n * data: {\n *  path: 'home',\n *  canActivate: [ JWTGuard ]\n * },\n * {\n *   path: 'my',\n *   canActivateChild: [JWTGuard],\n *   children: [\n *     { path: 'profile', component: MockComponent }\n *   ],\n * },\n * ```\n */\n@Injectable({ providedIn: 'root' })\nexport class JWTGuard implements CanActivate, CanActivateChild, CanLoad {\n  private url: string | undefined;\n\n  private get cog(): AlainAuthConfig {\n    return this.srv.options;\n  }\n\n  constructor(@Inject(DA_SERVICE_TOKEN) private srv: ITokenService, private injector: Injector) {}\n\n  private process(): boolean {\n    const res = CheckJwt(this.srv.get<JWTTokenModel>(JWTTokenModel), this.cog.token_exp_offset!);\n    if (!res) {\n      ToLogin(this.cog, this.injector, this.url);\n    }\n    return res;\n  }\n\n  // lazy loading\n  canLoad(route: Route, _segments: UrlSegment[]): boolean {\n    this.url = route.path;\n    return this.process();\n  }\n  // all children route\n  canActivateChild(_childRoute: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean {\n    this.url = state.url;\n    return this.process();\n  }\n  // route\n  canActivate(_route: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean {\n    this.url = state.url;\n    return this.process();\n  }\n}\n","import { NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { ITokenModel } from '../interface';\n\nexport class SimpleTokenModel implements ITokenModel {\n  [key: string]: NzSafeAny;\n\n  token: string;\n\n  expired?: number;\n}\n","import { HttpRequest } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { AlainAuthConfig } from '@delon/util/config';\nimport { NzSafeAny } from 'ng-zorro-antd/core/types';\nimport { BaseInterceptor } from '../base.interceptor';\nimport { CheckSimple } from '../helper';\nimport { DA_SERVICE_TOKEN } from '../interface';\nimport { SimpleTokenModel } from './simple.model';\n\n/**\n * Simple 拦截器\n *\n * ```\n * // app.module.ts\n * { provide: HTTP_INTERCEPTORS, useClass: SimpleInterceptor, multi: true}\n * ```\n */\n@Injectable()\nexport class SimpleInterceptor extends BaseInterceptor {\n  isAuth(_options: AlainAuthConfig): boolean {\n    this.model = this.injector.get(DA_SERVICE_TOKEN).get() as SimpleTokenModel;\n    return CheckSimple(this.model as SimpleTokenModel);\n  }\n\n  setReq(req: HttpRequest<any>, options: AlainAuthConfig): HttpRequest<any> {\n    const { token_send_template, token_send_key } = options;\n    const token = token_send_template!.replace(/\\$\\{([\\w]+)\\}/g, (_: string, g) => this.model[g]);\n    switch (options.token_send_place) {\n      case 'header':\n        const obj: NzSafeAny = {};\n        obj[token_send_key!] = token;\n        req = req.clone({\n          setHeaders: obj,\n        });\n        break;\n      case 'body':\n        const body = req.body || {};\n        body[token_send_key!] = token;\n        req = req.clone({\n          body,\n        });\n        break;\n      case 'url':\n        req = req.clone({\n          params: req.params.append(token_send_key!, token),\n        });\n        break;\n    }\n    return req;\n  }\n}\n","import { Inject, Injectable, Injector } from '@angular/core';\nimport { ActivatedRouteSnapshot, CanActivate, CanActivateChild, CanLoad, Route, RouterStateSnapshot, UrlSegment } from '@angular/router';\nimport { AlainAuthConfig } from '@delon/util/config';\nimport { CheckSimple, ToLogin } from '../helper';\nimport { DA_SERVICE_TOKEN, ITokenService } from '../interface';\nimport { SimpleTokenModel } from './simple.model';\n\n/**\n * Simple 路由守卫, [ACL Document](https://ng-alain.com/auth/guard).\n *\n * ```ts\n * data: {\n *  path: 'home',\n *  canActivate: [ SimpleGuard ]\n * },\n * {\n *   path: 'my',\n *   canActivateChild: [SimpleGuard],\n *   children: [\n *     { path: 'profile', component: MockComponent }\n *   ],\n * },\n * ```\n */\n@Injectable({ providedIn: 'root' })\nexport class SimpleGuard implements CanActivate, CanActivateChild, CanLoad {\n  private url?: string;\n\n  private get cog(): AlainAuthConfig {\n    return this.srv.options;\n  }\n\n  constructor(@Inject(DA_SERVICE_TOKEN) private srv: ITokenService, private injector: Injector) {}\n\n  private process(): boolean {\n    const res = CheckSimple(this.srv.get() as SimpleTokenModel);\n    if (!res) {\n      ToLogin(this.cog, this.injector, this.url);\n    }\n    return res;\n  }\n\n  // lazy loading\n  canLoad(route: Route, _segments: UrlSegment[]): boolean {\n    this.url = route.path;\n    return this.process();\n  }\n  // all children route\n  canActivateChild(_childRoute: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean {\n    this.url = state.url;\n    return this.process();\n  }\n  // route\n  canActivate(_route: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean {\n    this.url = state.url;\n    return this.process();\n  }\n}\n","import { NgModule } from '@angular/core';\n\n@NgModule({})\nexport class DelonAuthModule {}\n"]}